name: Lint

on:
  push:
    branches:
      - main
  pull_request:
    branches: [main]

jobs:
  check-unity-meta-files:
    name: Check Unity .meta files
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v6

      - name: Check for missing .meta files
        run: |
          echo "Unity .meta 파일 누락 검사 중..."
          echo ""

          # 체크할 디렉토리
          UNITY_DIRS="Editor Runtime WebGLTemplates"

          MISSING_FILES=()

          for dir in $UNITY_DIRS; do
            if [ -d "$dir" ]; then
              # .meta 파일, 숨김 파일, node_modules, ~ 접미사 폴더 제외하고 검사
              # ~ 접미사 폴더는 Unity가 무시하므로 .meta 파일이 필요하지 않음
              while IFS= read -r -d '' file; do
                # .meta 파일 존재 확인
                if [ ! -f "${file}.meta" ]; then
                  MISSING_FILES+=("$file")
                fi
              done < <(find "$dir" -type d \( -name "node_modules" -o -name "*~" \) -prune -o -type f ! -name ".*" ! -name "*.meta" ! -name ".DS_Store" ! -name "*.swp" ! -name "*.tmp" -print0)
            fi
          done

          if [ ${#MISSING_FILES[@]} -gt 0 ]; then
            echo "::error::Unity .meta 파일이 누락되었습니다!"
            echo ""
            echo "다음 파일들에 대한 .meta 파일이 없습니다:"
            for file in "${MISSING_FILES[@]}"; do
              echo "  - $file"
            done
            echo ""
            echo "해결 방법:"
            echo "  1. Unity Editor에서 프로젝트를 열어 자동으로 .meta 파일 생성"
            echo "  2. 또는 기존 .meta 파일을 참고하여 수동으로 생성 (GUID 포함)"
            exit 1
          fi

          echo "✓ 모든 Unity 파일에 .meta 파일이 있습니다."
