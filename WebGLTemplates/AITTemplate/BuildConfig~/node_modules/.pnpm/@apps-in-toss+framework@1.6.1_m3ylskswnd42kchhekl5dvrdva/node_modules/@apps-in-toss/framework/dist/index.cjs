"use strict";
var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __reExport = (target, mod, secondTarget) => (__copyProps(target, mod, "default"), secondTarget && __copyProps(secondTarget, mod, "default"));
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  // If the importer is in node compatibility mode or this is not an ESM
  // file that has been converted to a CommonJS file using a Babel-
  // compatible transform (i.e. "__esModule" has not been set), then set
  // "default" to the CommonJS "module.exports" for node compatibility.
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/index.ts
var src_exports = {};
__export(src_exports, {
  Analytics: () => Analytics2,
  AppsInToss: () => AppsInToss,
  INTERNAL__onVisibilityChangedByTransparentServiceWeb: () => INTERNAL__onVisibilityChangedByTransparentServiceWeb,
  OverlayProvider: () => import_private10.OverlayProvider,
  WebView: () => WebView,
  env: () => env,
  loadFullScreenAd: () => loadFullScreenAd,
  showFullScreenAd: () => showFullScreenAd,
  useCreateUserAgent: () => useCreateUserAgent,
  useGeolocation: () => useGeolocation,
  useOverlay: () => import_private10.useOverlay,
  useTopNavigation: () => useTopNavigation,
  useWaitForReturnNavigator: () => useWaitForReturnNavigator
});
module.exports = __toCommonJS(src_exports);
var import_analytics2 = require("@apps-in-toss/analytics");

// src/core/registerApp.tsx
var import_analytics = require("@apps-in-toss/analytics");
var import_native_modules13 = require("@apps-in-toss/native-modules");
var import_react_native23 = require("@granite-js/react-native");
var import_tds_react_native10 = require("@toss/tds-react-native");
var import_react_native24 = require("react-native");

// src/core/components/AppEvent.tsx
var import_native_modules2 = require("@apps-in-toss/native-modules");
var import_react_native4 = require("@granite-js/react-native");
var import_react3 = require("react");

// src/env.ts
var env = {
  getDeploymentId: () => __DEV__ ? "local" : global.__appsInToss?.deploymentId
};

// src/hooks/useCaptureExitLog.ts
var import_native_modules = require("@apps-in-toss/native-modules");
var import_react_native3 = require("@granite-js/react-native");
var import_react2 = require("react");

// src/core/hooks/useReferrer.ts
var import_react_native = require("@granite-js/react-native");
var import_react = require("react");
function useReferrer() {
  return (0, import_react.useMemo)(() => {
    try {
      return new URL((0, import_react_native.getSchemeUri)()).searchParams.get("referrer");
    } catch {
      return null;
    }
  }, []);
}

// src/utils/isPrivateScheme.ts
var import_react_native2 = require("@granite-js/react-native");
function isPrivateScheme() {
  try {
    return new URL((0, import_react_native2.getSchemeUri)()).protocol === "intoss-private:";
  } catch {
    return false;
  }
}

// src/hooks/useCaptureExitLog.ts
var EXIT_IMPRESSION_LOG_NAME = "appsintoss_app_visit__common_module::impression__stay_time";
var EXIT_IMPRESSION_SCHEMA_ID = 1631628;
function useCaptureExitLog() {
  const referrer = useReferrer();
  const visible = (0, import_react_native3.useVisibility)();
  const enterTime = (0, import_react2.useRef)(void 0);
  (0, import_react2.useEffect)(() => {
    if (visible === true) {
      enterTime.current = Date.now();
    }
  }, [visible]);
  const captureExitLog = (0, import_react2.useCallback)(
    (exitTime) => {
      if (enterTime.current == null) {
        return;
      }
      const stayTime = Math.floor(exitTime - enterTime.current);
      import_native_modules.INTERNAL__module.tossCoreEventLog({
        log_name: EXIT_IMPRESSION_LOG_NAME,
        log_type: "event",
        params: {
          schema_id: EXIT_IMPRESSION_SCHEMA_ID,
          event_type: "impression",
          referrer,
          deployment_id: env.getDeploymentId(),
          app_name: import_react_native3.Granite.appName,
          is_private: isPrivateScheme(),
          stay_time: stayTime.toString(),
          exit_time: exitTime.toString()
        }
      });
      enterTime.current = void 0;
    },
    [referrer]
  );
  return { captureExitLog };
}

// src/core/components/AppEvent.tsx
var ENTRY_APP_EVENT_SCHEMA_ID = 1562181;
function EntryAppEvent() {
  const referrer = useReferrer() ?? "";
  (0, import_react3.useEffect)(() => {
    import_native_modules2.INTERNAL__module.tossCoreEventLog({
      log_name: "appsintoss_app_visit::impression__enter_appsintoss",
      log_type: "info",
      params: {
        is_transform: true,
        schema_id: ENTRY_APP_EVENT_SCHEMA_ID,
        referrer,
        deployment_id: env.getDeploymentId(),
        app_name: import_react_native4.Granite.appName,
        is_private: isPrivateScheme()
      }
    });
  }, [referrer]);
  return null;
}
function SystemAppEvent({ ...initialProps }) {
  (0, import_react3.useEffect)(() => {
    import_native_modules2.INTERNAL__module.tossCoreEventLog({
      log_name: "AppsInTossInitialProps",
      log_type: "debug",
      params: {
        ...initialProps,
        schemeUri: (0, import_react_native4.getSchemeUri)(),
        deployment_id: env.getDeploymentId(),
        app_name: import_react_native4.Granite.appName,
        is_private: isPrivateScheme()
      }
    });
  }, [initialProps]);
  return null;
}
function StayTimeAppEvent() {
  const visible = (0, import_react_native4.useVisibility)();
  const { captureExitLog } = useCaptureExitLog();
  (0, import_react3.useEffect)(() => {
    if (visible === false) {
      captureExitLog(Date.now());
    }
  }, [visible, captureExitLog]);
  return null;
}
var AppEvent = {
  Entry: EntryAppEvent,
  System: SystemAppEvent,
  StayTime: StayTimeAppEvent
};

// src/core/components/AppUpdate.tsx
var import_react_native5 = require("@granite-js/react-native");
var import_react4 = require("react");
var import_jsx_runtime = require("react/jsx-runtime");
var UPDATE_SCHEME = "servicetoss://update/forced/j?updateType=required";
function AppUpdate() {
  (0, import_react4.useEffect)(() => {
    (0, import_react_native5.openURL)(`supertoss://closePage?url=${UPDATE_SCHEME}`);
  }, []);
  return /* @__PURE__ */ (0, import_jsx_runtime.jsx)(import_jsx_runtime.Fragment, {});
}

// src/core/context/NavigationBarContext.tsx
var import_react5 = require("react");

// src/core/utils/getAppsInTossGlobals.ts
function getAppsInTossGlobals() {
  if (global.__appsInToss == null) {
    throw new Error("invalid apps-in-toss globals");
  }
  return global.__appsInToss;
}

// src/core/utils/safeParseNavigationBar.ts
function safeParseNavigationBar(navigationBar) {
  if (typeof navigationBar === "object") {
    return navigationBar;
  }
  try {
    return JSON.parse(navigationBar);
  } catch {
    return null;
  }
}

// src/core/context/NavigationBarContext.tsx
var import_jsx_runtime2 = require("react/jsx-runtime");
var NavigationBarContext = (0, import_react5.createContext)(null);
function NavigationBarContextProvider({ children }) {
  const globals = getAppsInTossGlobals();
  const parsedNavigationBar = globals.navigationBar != null ? safeParseNavigationBar(globals.navigationBar) : null;
  const [navigationRightButton, setNavigationRightButton] = (0, import_react5.useState)(
    parsedNavigationBar?.initialAccessoryButton
  );
  const addNavigationRightButton = (button) => {
    setNavigationRightButton(button);
  };
  const removeNavigationRightButton = () => {
    setNavigationRightButton(void 0);
  };
  return /* @__PURE__ */ (0, import_jsx_runtime2.jsx)(
    NavigationBarContext.Provider,
    {
      value: { navigationRightButton, addNavigationRightButton, removeNavigationRightButton },
      children
    }
  );
}
function useNavigationBarContext() {
  const context = (0, import_react5.useContext)(NavigationBarContext);
  if (context == null) {
    throw Error("useNavigationBarContext must be used within NavigationBarContextProvider");
  }
  return context;
}

// src/components/RNAppContainer.tsx
var import_native_modules12 = require("@apps-in-toss/native-modules");
var import_react17 = require("react");
var import_react_native22 = require("react-native");

// src/components/GameInitializer.tsx
var import_native_modules6 = require("@apps-in-toss/native-modules");
var import_react_native10 = require("@granite-js/react-native");
var import_tds_react_native4 = require("@toss/tds-react-native");
var import_es_hangul = require("es-hangul");
var import_react11 = require("react");
var import_react_native11 = require("react-native");

// src/constant/game-center.ts
var GAME_PROFILE_WEBVIEW_URL = "servicetoss://game-center/profile";
var GAME_MIN_VERSION = {
  android: "5.232.0",
  ios: "5.232.0"
};

// src/hooks/useAppUpdateDialog.tsx
var import_native_modules3 = require("@apps-in-toss/native-modules");
var import_react_native7 = require("@granite-js/react-native");
var import_tds_react_native = require("@toss/tds-react-native");
var import_react6 = require("react");

// src/utils/market.ts
var import_react_native6 = require("react-native");
var PLAYSTORE_LINK = "https://play.google.com/store/apps/details?id=viva.republica.toss";
var APPSTORE_LINK = "https://itunes.apple.com/app/id839333328";
var getMarketLink = () => {
  return import_react_native6.Platform.OS === "android" ? PLAYSTORE_LINK : APPSTORE_LINK;
};

// src/hooks/useAppUpdateDialog.tsx
function useAppUpdateDialog() {
  const { openConfirm } = (0, import_tds_react_native.useDialog)();
  const logging = useAppUpdateDialogLogging();
  const openAppUpdateDialog = (0, import_react6.useCallback)(
    async ({
      title,
      description,
      leftButton = "\uB2EB\uAE30",
      rightButton = "\uC5C5\uB370\uC774\uD2B8\uD558\uAE30",
      onDismiss
    }) => {
      logging.show();
      const isConfirmed = await openConfirm({
        title,
        description,
        leftButton,
        rightButton,
        closeOnDimmerClick: true
      });
      if (!isConfirmed) {
        logging.close();
        onDismiss?.();
        return;
      }
      logging.update();
      const STORE_SCHEME = getMarketLink();
      (0, import_react_native7.openURL)(`supertoss://web?url=${STORE_SCHEME}&external=browser`);
    },
    [logging, openConfirm]
  );
  return {
    open: openAppUpdateDialog
  };
}
var UPDATE_DIALOG_SCHEMA_ID = 1634992;
var UPDATE_DIALOG_LOG_NAME = "appsintoss_app_visit__common_module::bottomsheet__app_update";
var UPDATE_DIALOG_CTA_CLICK_SCHEMA_ID = 1634996;
var UPDATE_DIALOG_CTA_CLICK_LOG_NAME = "appsintoss_app_visit__common_module::bottomsheet__app_update::click__cta";
function useAppUpdateDialogLogging() {
  const referrer = useReferrer();
  const baseParams = {
    referrer,
    app_name: import_react_native7.Granite.appName
  };
  const logUpdateClick = () => {
    import_native_modules3.INTERNAL__module.tossCoreEventLog({
      log_name: UPDATE_DIALOG_CTA_CLICK_LOG_NAME,
      log_type: "event",
      params: {
        ...baseParams,
        schema_id: UPDATE_DIALOG_CTA_CLICK_SCHEMA_ID,
        event_type: "click",
        button_type: "update"
      }
    });
  };
  const logCloseClick = () => {
    import_native_modules3.INTERNAL__module.tossCoreEventLog({
      log_name: UPDATE_DIALOG_CTA_CLICK_LOG_NAME,
      log_type: "event",
      params: {
        ...baseParams,
        schema_id: UPDATE_DIALOG_CTA_CLICK_SCHEMA_ID,
        event_type: "click",
        button_type: "close"
      }
    });
  };
  const logDialogShow = () => {
    import_native_modules3.INTERNAL__module.tossCoreEventLog({
      log_name: UPDATE_DIALOG_LOG_NAME,
      log_type: "popup",
      params: {
        ...baseParams,
        schema_id: UPDATE_DIALOG_SCHEMA_ID
      }
    });
  };
  return { update: logUpdateClick, close: logCloseClick, show: logDialogShow };
}

// src/hooks/useGameCenterProfile.ts
var import_native_modules5 = require("@apps-in-toss/native-modules");
var import_react10 = require("react");

// src/hooks/useErrorAlert.ts
var import_react_native8 = require("@granite-js/react-native");
var import_tds_react_native2 = require("@toss/tds-react-native");
var import_react7 = require("react");

// src/utils/error.ts
var DEFAULT_ERROR = {
  title: "\uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694",
  description: "\uBB38\uC81C\uAC00 \uACC4\uC18D\uB418\uBA74 \uD1A0\uC2A4 \uACE0\uAC1D\uC13C\uD130(1599-4905)\uB85C \uBB38\uC758\uD574\uC8FC\uC138\uC694."
};

// src/hooks/useErrorAlert.ts
var useErrorAlert = () => {
  const { openAlert } = (0, import_tds_react_native2.useDialog)();
  const openErrorAlert = (0, import_react7.useCallback)(async () => {
    await openAlert({
      title: DEFAULT_ERROR.title,
      description: DEFAULT_ERROR.description
    });
    (0, import_react_native8.closeView)();
  }, [openAlert]);
  return { open: openErrorAlert };
};

// src/hooks/useTransparentWebview.tsx
var import_react8 = require("react");

// src/utils/openTransparentWebView.ts
var import_react_native9 = require("@granite-js/react-native");

// src/private.ts
var import_native_modules4 = require("@apps-in-toss/native-modules");
var INTERNAL__onVisibilityChangedByTransparentServiceWeb = import_native_modules4.onVisibilityChangedByTransparentServiceWeb;

// src/utils/openTransparentWebView.ts
var openTransparentWebView = ({
  webUrl,
  cleanupWhenDismissed = true,
  onEvent,
  onError,
  callbackId = "fn",
  params
}) => {
  const url = new URL("supertoss://transparent-service-web");
  url.searchParams.set("url", webUrl);
  url.searchParams.set("onVisibilityChangeCallback", callbackId);
  Object.entries(params ?? {}).forEach(([key, value]) => {
    url.searchParams.set(key, value);
  });
  const cleanup = INTERNAL__onVisibilityChangedByTransparentServiceWeb({
    options: { callbackId },
    onError: (error) => {
      onError(error);
      cleanup();
    },
    onEvent: (value) => {
      onEvent(value);
      if (cleanupWhenDismissed && value === true) {
        cleanup();
      }
    }
  });
  (0, import_react_native9.openURL)(url.toString());
};

// src/hooks/useTransparentWebview.tsx
var useTransparentWebview = () => {
  const [isWebviewLoading, setIsWebviewLoading] = (0, import_react8.useState)(false);
  const { open: openErrorAlert } = useErrorAlert();
  const _openTransparentWebview = (0, import_react8.useCallback)(
    ({ webUrl, onClose, onError }) => {
      if (isWebviewLoading) {
        return;
      }
      setIsWebviewLoading(true);
      openTransparentWebView({
        webUrl,
        onEvent: async (isClosedTransparentWebView) => {
          if (isClosedTransparentWebView) {
            setIsWebviewLoading(false);
            onClose?.();
          }
        },
        onError: (error) => {
          setIsWebviewLoading(false);
          if (onError) {
            onError(error);
          } else {
            openErrorAlert();
          }
        }
      });
    },
    [isWebviewLoading, openErrorAlert]
  );
  return {
    open: _openTransparentWebview
  };
};

// src/components/GameProfileToast.tsx
var import_tds_react_native3 = require("@toss/tds-react-native");
var import_private2 = require("@toss/tds-react-native/private");
var import_react9 = require("react");
var import_jsx_runtime3 = require("react/jsx-runtime");
var useGameProfileToast = () => {
  const overlay = (0, import_private2.useOverlay)();
  const openGameProfileToast = (0, import_react9.useCallback)(
    (nickname, profileImageUri) => {
      return new Promise((resolve) => {
        overlay.open(({ isOpen, close, exit }) => {
          return /* @__PURE__ */ (0, import_jsx_runtime3.jsx)(import_private2.ColorPreferenceProvider, { colorPreference: "dark", children: /* @__PURE__ */ (0, import_jsx_runtime3.jsx)(import_private2.AdaptiveColorProvider, { children: /* @__PURE__ */ (0, import_jsx_runtime3.jsx)(
            import_tds_react_native3.Toast,
            {
              open: isOpen,
              onClose: () => {
                resolve();
                close();
              },
              onExited: exit,
              position: "top",
              text: `${nickname}\uB2D8 \uBC18\uAC00\uC6CC\uC694!`,
              icon: /* @__PURE__ */ (0, import_jsx_runtime3.jsx)(
                import_tds_react_native3.Asset.Image,
                {
                  style: { borderRadius: 64, overflow: "hidden" },
                  frameShape: import_tds_react_native3.Asset.frameShape.CleanW32,
                  source: { uri: profileImageUri }
                }
              )
            }
          ) }) });
        });
      });
    },
    [overlay]
  );
  return { openGameProfileToast };
};

// src/hooks/useGameCenterProfile.ts
var useGameCenterProfile = () => {
  const [profileData, setProfileData] = (0, import_react10.useState)(void 0);
  const [isProfileDataLoading, setIsProfileDataLoading] = (0, import_react10.useState)(true);
  const [isProfileDataRefetching, setIsProfileDataRefetching] = (0, import_react10.useState)(false);
  const shouldShowProfileLoadingOverlay = isProfileDataLoading || isProfileDataRefetching;
  const shouldShowProfileNotFoundOverlay = profileData?.statusCode === "PROFILE_NOT_FOUND" && !isProfileDataRefetching;
  const canShowBottomSheetOrToast = !isProfileDataLoading;
  const { openGameProfileToast } = useGameProfileToast();
  const { open: openErrorAlert } = useErrorAlert();
  const { open: openTransparentWebView2 } = useTransparentWebview();
  const fetchProfileData = (0, import_react10.useCallback)(async () => {
    try {
      const data = await (0, import_native_modules5.getGameCenterGameProfile)();
      setProfileData(data);
      setIsProfileDataLoading(false);
    } catch (_) {
      openErrorAlert();
      setIsProfileDataLoading(false);
    }
  }, [openErrorAlert]);
  const refetchProfileData = (0, import_react10.useCallback)(async () => {
    try {
      setIsProfileDataRefetching(true);
      const data = await (0, import_native_modules5.getGameCenterGameProfile)();
      setProfileData(data);
      setIsProfileDataRefetching(false);
      if (data?.statusCode === "SUCCESS") {
        openGameProfileToast(data.nickname, data.profileImageUri);
      }
    } catch (_) {
      setIsProfileDataRefetching(false);
      openErrorAlert();
    }
  }, [openErrorAlert, openGameProfileToast]);
  const openProfileWebview = (0, import_react10.useCallback)(() => {
    openTransparentWebView2({
      webUrl: `${GAME_PROFILE_WEBVIEW_URL}?appName=${getAppName()}&referrer=appsintoss.${getAppName()}`,
      onClose: async () => {
        refetchProfileData();
      }
    });
  }, [openTransparentWebView2, refetchProfileData]);
  return {
    profileData,
    isProfileDataLoading,
    shouldShowProfileLoadingOverlay,
    shouldShowProfileNotFoundOverlay,
    canShowBottomSheetOrToast,
    setIsProfileDataLoading,
    openProfileWebview,
    setProfileData,
    openErrorAlert,
    openGameProfileToast,
    fetchProfileData
  };
};

// src/utils/zIndex.ts
var Z_INDEX = {
  /* 게임 프로필을 위한 overlay
   */
  PROFILE_OVERLAY: 9998,
  // 게임을 종료할 수 있는 X 버튼
  CLOSE_BUTTON: 9999
};

// src/components/GameInitializer.tsx
var import_jsx_runtime4 = require("react/jsx-runtime");
var GameInitializer = ({ children }) => {
  const {
    profileData,
    shouldShowProfileLoadingOverlay,
    shouldShowProfileNotFoundOverlay,
    canShowBottomSheetOrToast,
    openProfileWebview,
    openGameProfileToast,
    fetchProfileData
  } = useGameCenterProfile();
  const isCompletedFlow = (0, import_react11.useRef)(false);
  const { open: openAppUpdateDialog } = useAppUpdateDialog();
  (0, import_react11.useEffect)(() => {
    fetchProfileData();
  }, []);
  (0, import_react11.useEffect)(() => {
    const handleGameProfileFlow = async () => {
      if (!canShowBottomSheetOrToast) {
        return;
      }
      if (isCompletedFlow.current) {
        return;
      }
      isCompletedFlow.current = true;
      if (!(0, import_native_modules6.isMinVersionSupported)(GAME_MIN_VERSION)) {
        openAppUpdateDialog({
          title: `${(0, import_es_hangul.josa)(getAppsInTossGlobals().brandDisplayName, "\uC744/\uB97C")} \uD558\uB824\uBA74 
\uC571\uC744 \uC5C5\uB370\uC774\uD2B8\uD574\uC8FC\uC138\uC694`,
          onDismiss: () => {
            (0, import_react_native10.closeView)();
          }
        });
        return;
      }
      if (profileData?.statusCode === "SUCCESS") {
        openGameProfileToast(profileData.nickname, profileData.profileImageUri);
        return;
      }
      if (profileData?.statusCode === "PROFILE_NOT_FOUND") {
        openProfileWebview();
      }
    };
    handleGameProfileFlow();
  }, [
    canShowBottomSheetOrToast,
    isCompletedFlow,
    openAppUpdateDialog,
    openGameProfileToast,
    openProfileWebview,
    profileData
  ]);
  if (!(0, import_native_modules6.isMinVersionSupported)(GAME_MIN_VERSION)) {
    return /* @__PURE__ */ (0, import_jsx_runtime4.jsxs)(import_jsx_runtime4.Fragment, { children: [
      /* @__PURE__ */ (0, import_jsx_runtime4.jsx)(import_react_native11.View, { style: { flex: 1, position: "relative" }, children }),
      /* @__PURE__ */ (0, import_jsx_runtime4.jsx)(
        import_react_native11.Pressable,
        {
          style: {
            ...overlayStyle
          },
          onPress: () => {
            openAppUpdateDialog({
              title: `${(0, import_es_hangul.josa)(getAppsInTossGlobals().brandDisplayName, "\uC744/\uB97C")} \uD558\uB824\uBA74 
\uC571\uC744 \uC5C5\uB370\uC774\uD2B8\uD574\uC8FC\uC138\uC694`,
              onDismiss: () => {
                (0, import_react_native10.closeView)();
              }
            });
          }
        }
      )
    ] });
  }
  if (shouldShowProfileLoadingOverlay) {
    return /* @__PURE__ */ (0, import_jsx_runtime4.jsxs)(import_jsx_runtime4.Fragment, { children: [
      /* @__PURE__ */ (0, import_jsx_runtime4.jsx)(import_react_native11.View, { style: { flex: 1, position: "relative" }, children }),
      /* @__PURE__ */ (0, import_jsx_runtime4.jsx)(
        import_react_native11.View,
        {
          style: {
            ...overlayStyle,
            justifyContent: "center",
            alignItems: "center",
            backgroundColor: "rgba(0, 0, 0, 0.2)"
          },
          children: /* @__PURE__ */ (0, import_jsx_runtime4.jsx)(import_tds_react_native4.Loader, { size: "large", type: "light" })
        }
      )
    ] });
  }
  if (shouldShowProfileNotFoundOverlay) {
    return /* @__PURE__ */ (0, import_jsx_runtime4.jsxs)(import_jsx_runtime4.Fragment, { children: [
      /* @__PURE__ */ (0, import_jsx_runtime4.jsx)(import_react_native11.View, { style: { flex: 1, position: "relative" }, children }),
      shouldShowProfileNotFoundOverlay && /* @__PURE__ */ (0, import_jsx_runtime4.jsx)(
        import_react_native11.Pressable,
        {
          style: {
            ...overlayStyle
          },
          onPress: () => {
            openProfileWebview();
          }
        }
      )
    ] });
  }
  return /* @__PURE__ */ (0, import_jsx_runtime4.jsx)(import_jsx_runtime4.Fragment, { children: /* @__PURE__ */ (0, import_jsx_runtime4.jsx)(import_react_native11.View, { style: { flex: 1, position: "relative" }, children }) });
};
var overlayStyle = {
  position: "absolute",
  top: 0,
  left: 0,
  right: 0,
  bottom: 0,
  zIndex: Z_INDEX.PROFILE_OVERLAY
};

// src/components/NavigationBar/RNNavigationBar/Default.tsx
var import_private5 = require("@toss/tds-react-native/private");

// src/components/NavigationBar/RNNavigationBar/hooks/useHardwareBackPress.ts
var import_react12 = require("react");
var import_react_native12 = require("react-native");
function useHardwareBackPress(handler) {
  (0, import_react12.useEffect)(() => {
    const handleBackPress = () => {
      handler();
      return true;
    };
    import_react_native12.BackHandler.addEventListener("hardwareBackPress", handleBackPress);
    return () => import_react_native12.BackHandler.removeEventListener("hardwareBackPress", handleBackPress);
  }, [handler]);
}

// src/components/NavigationBar/RNNavigationBar/hooks/useNavigationEvent.ts
var import_react_native14 = require("@granite-js/react-native");
var import_react14 = require("react");

// src/components/NavigationBar/RNNavigationBar/hooks/useCloseConfirm.ts
var import_tds_react_native5 = require("@toss/tds-react-native");
var import_es_hangul2 = require("es-hangul");
var import_react13 = require("react");
function useCloseConfirm() {
  const { brandDisplayName } = getAppsInTossGlobals();
  const { openConfirm } = (0, import_tds_react_native5.useDialog)();
  return (0, import_react13.useCallback)(
    async ({ onEntered }) => {
      return await openConfirm({
        title: `${(0, import_es_hangul2.josa)(brandDisplayName, "\uC744/\uB97C")} \uC885\uB8CC\uD560\uAE4C\uC694?`,
        leftButton: "\uCDE8\uC18C",
        rightButton: "\uC885\uB8CC\uD558\uAE30",
        closeOnDimmerClick: true,
        onEntered
      });
    },
    [brandDisplayName, openConfirm]
  );
}

// src/components/NavigationBar/common/useNavigationBarLogging.tsx
var import_native_modules7 = require("@apps-in-toss/native-modules");
var import_react_native13 = require("@granite-js/react-native");
var NAVI_BAR_IMPRESSION_SCHEMA_ID = 1596837;
var NAVI_BAR_IMPRESSION_LOG_NAME = "appsintoss_app_visit__common_module::impression__navigation_bar";
var CLOSE_POPUP_SHOW_SCHEMA_ID = 1644490;
var CLOSE_POPUP_SHOW_LOG_NAME = "appsintoss_app_visit__common_module::popup__close_app";
var CLOSE_BUTTON_CLICK_SCHEMA_ID = 1596831;
var CLOSE_BUTTON_CLICK_LOG_NAME = "appsintoss_app_visit__common_module::click__icon_close";
var CLOSE_POPUP_CTA_CLICK_SCHEMA_ID = 1644492;
var CLOSE_POPUP_CTA_CLICK_LOG_NAME = "appsintoss_app_visit__common_module::popup__close_app::click__cta";
var HOME_BUTTON_CLICK_SCHEMA_ID = 1596839;
var HOME_BUTTON_CLICK_LOG_NAME = "appsintoss_app_visit__common_module::click__icon_home";
function useNavigationBarLogging() {
  const referrer = useReferrer();
  const baseParams = {
    referrer,
    app_name: import_react_native13.Granite.appName
  };
  const logNavBarImpression = (naviBarConfig) => {
    import_native_modules7.INTERNAL__module.tossCoreEventLog({
      log_name: NAVI_BAR_IMPRESSION_LOG_NAME,
      log_type: "event",
      params: {
        ...naviBarConfig,
        ...baseParams,
        event_type: "impression",
        schema_id: NAVI_BAR_IMPRESSION_SCHEMA_ID
      }
    });
  };
  const logHomeButtonClick = () => {
    import_native_modules7.INTERNAL__module.tossCoreEventLog({
      log_name: HOME_BUTTON_CLICK_LOG_NAME,
      log_type: "event",
      params: {
        ...baseParams,
        event_type: "click",
        schema_id: HOME_BUTTON_CLICK_SCHEMA_ID
      }
    });
  };
  const logCloseButtonClick = () => {
    import_native_modules7.INTERNAL__module.tossCoreEventLog({
      log_name: CLOSE_BUTTON_CLICK_LOG_NAME,
      log_type: "event",
      params: {
        ...baseParams,
        event_type: "click",
        schema_id: CLOSE_BUTTON_CLICK_SCHEMA_ID
      }
    });
  };
  const logClosePopupShow = () => {
    import_native_modules7.INTERNAL__module.tossCoreEventLog({
      log_name: CLOSE_POPUP_SHOW_LOG_NAME,
      log_type: "popup",
      params: {
        ...baseParams,
        schema_id: CLOSE_POPUP_SHOW_SCHEMA_ID
      }
    });
  };
  const logClosePopupCtaClick = (confirm) => {
    import_native_modules7.INTERNAL__module.tossCoreEventLog({
      log_name: CLOSE_POPUP_CTA_CLICK_LOG_NAME,
      log_type: "event",
      params: {
        ...baseParams,
        close_yn: confirm ? "Y" : "N",
        schema_id: CLOSE_POPUP_CTA_CLICK_SCHEMA_ID,
        event_type: "click"
      }
    });
  };
  return {
    navBarImpression: logNavBarImpression,
    closePopupShow: logClosePopupShow,
    closePopupCtaClick: logClosePopupCtaClick,
    closeButtonClick: logCloseButtonClick,
    homeButtonClick: logHomeButtonClick
  };
}

// src/components/NavigationBar/RNNavigationBar/hooks/useNavigationEvent.ts
function useNavigationEvent() {
  const backEventContext = (0, import_react_native14.useBackEventContext)();
  const logging = useNavigationBarLogging();
  const navigation = (0, import_react_native14.useNavigation)();
  const closeConfirm = useCloseConfirm();
  const { captureExitLog } = useCaptureExitLog();
  return (0, import_react14.useMemo)(() => {
    const close = async () => {
      const hasConfirmed = await closeConfirm({
        onEntered: logging.closePopupShow
      });
      logging.closePopupCtaClick(hasConfirmed);
      if (hasConfirmed) {
        captureExitLog(Date.now());
        (0, import_react_native14.closeView)();
      }
    };
    return {
      handleBack: () => {
        if (backEventContext.hasBackEvent) {
          backEventContext.onBack();
        } else if (navigation.canGoBack()) {
          navigation.goBack();
        } else {
          close();
        }
      },
      handleHomeButtonClick: () => {
        logging.homeButtonClick();
        navigation.navigate("/");
      },
      handleCloseButtonClick: () => {
        logging.closeButtonClick();
        close();
      }
    };
  }, [backEventContext, navigation, closeConfirm, logging, captureExitLog]);
}

// src/core/hooks/useMoreButtonBottomSheet/index.tsx
var import_native_modules11 = require("@apps-in-toss/native-modules");
var import_react_native20 = require("@granite-js/react-native");
var import_tds_react_native8 = require("@toss/tds-react-native");
var import_private4 = require("@toss/tds-react-native/private");
var import_react15 = require("react");

// src/core/hooks/useMoreButtonBottomSheet/AppShareListMenu.tsx
var import_native_modules9 = require("@apps-in-toss/native-modules");
var import_react_native17 = require("@granite-js/react-native");
var import_tds_react_native7 = require("@toss/tds-react-native");
var import_react_native18 = require("react-native");

// src/core/hooks/useMoreButtonBottomSheet/Menu.tsx
var import_tds_react_native6 = require("@toss/tds-react-native");
var import_private3 = require("@toss/tds-react-native/private");
var import_react_native16 = require("react-native");

// src/core/hooks/useMoreButtonBottomSheet/useMoreButtonBottomSheetLogging.tsx
var import_native_modules8 = require("@apps-in-toss/native-modules");
var import_react_native15 = require("@granite-js/react-native");
var BOTTOM_SHEET_SCHEMA_ID = 1596825;
var BOTTOM_SHEET_LOG_NAME = "appsintoss_app_visit__common_module::bottomsheet__more";
var BOTTOM_SHEET_OPEN_SCHEMA_ID = 1596829;
var BOTTOM_SHEET_OPEN_LOG_NAME = "appsintoss_app_visit__common_module::click__icon_more";
var BOTTOM_SHEET_CLOSE_CLICK_SCHEMA_ID = 1596843;
var BOTTOM_SHEET_CLOSE_CLICK_LOG_NAME = "appsintoss_app_visit__common_module::bottomsheet__more::click__close";
var BOTTOM_SHEET_MENU_CLICK_SCHEMA_ID = 1596841;
var BOTTOM_SHEET_MENU_CLICK_LOG_NAME = "appsintoss_app_visit__common_module::bottomsheet__more::click__menu";
function useMoreButtonBottomSheetLogging() {
  const referrer = useReferrer();
  const baseParams = {
    referrer,
    app_name: import_react_native15.Granite.appName
  };
  const logBottomSheetShow = () => {
    import_native_modules8.INTERNAL__module.tossCoreEventLog({
      log_name: BOTTOM_SHEET_LOG_NAME,
      log_type: "popup",
      params: {
        ...baseParams,
        schema_id: BOTTOM_SHEET_SCHEMA_ID
      }
    });
  };
  const logBottomSheetOpen = () => {
    import_native_modules8.INTERNAL__module.tossCoreEventLog({
      log_name: BOTTOM_SHEET_OPEN_LOG_NAME,
      log_type: "event",
      params: {
        ...baseParams,
        schema_id: BOTTOM_SHEET_OPEN_SCHEMA_ID,
        event_type: "click"
      }
    });
  };
  const logBottomSheetCloseClick = () => {
    import_native_modules8.INTERNAL__module.tossCoreEventLog({
      log_name: BOTTOM_SHEET_CLOSE_CLICK_LOG_NAME,
      log_type: "event",
      params: {
        ...baseParams,
        schema_id: BOTTOM_SHEET_CLOSE_CLICK_SCHEMA_ID,
        event_type: "click"
      }
    });
  };
  const logBottomSheetMenuClick = ({ title }) => {
    import_native_modules8.INTERNAL__module.tossCoreEventLog({
      log_name: BOTTOM_SHEET_MENU_CLICK_LOG_NAME,
      log_type: "event",
      params: {
        ...baseParams,
        schema_id: BOTTOM_SHEET_MENU_CLICK_SCHEMA_ID,
        event_type: "click",
        item_title: title
      }
    });
  };
  return {
    show: logBottomSheetShow,
    open: logBottomSheetOpen,
    close: logBottomSheetCloseClick,
    menuClick: logBottomSheetMenuClick
  };
}

// src/core/hooks/useMoreButtonBottomSheet/Menu.tsx
var import_jsx_runtime5 = require("react/jsx-runtime");
function Menu({ title, iconURL, onPress }) {
  const globals = getAppsInTossGlobals();
  const adaptive = (0, import_private3.useAdaptive)();
  const iconName = getIconName(iconURL);
  const logging = useMoreButtonBottomSheetLogging();
  const brandPrimaryColorRGB = hexToRGB(globals.brandPrimaryColor);
  const iconBackgroundColor = brandPrimaryColorRGB ? `rgba(${brandPrimaryColorRGB.join(",")},0.1)` : adaptive.grey100;
  return /* @__PURE__ */ (0, import_jsx_runtime5.jsx)(
    import_tds_react_native6.ListRow,
    {
      left: /* @__PURE__ */ (0, import_jsx_runtime5.jsx)(
        import_react_native16.View,
        {
          style: {
            width: 30,
            height: 30,
            borderRadius: 10,
            flexDirection: "row",
            alignItems: "center",
            justifyContent: "center",
            marginRight: 16,
            backgroundColor: iconBackgroundColor
          },
          children: iconName ? /* @__PURE__ */ (0, import_jsx_runtime5.jsx)(import_tds_react_native6.Asset.Icon, { frameShape: { width: 20, height: 20 }, color: globals.brandPrimaryColor, name: iconName }) : /* @__PURE__ */ (0, import_jsx_runtime5.jsx)(import_tds_react_native6.Asset.Image, { frameShape: { width: 20, height: 20 }, source: { uri: iconURL } })
        }
      ),
      contents: /* @__PURE__ */ (0, import_jsx_runtime5.jsx)(import_tds_react_native6.ListRow.Texts, { type: "1RowTypeA", top: title, topProps: { color: adaptive.grey700 } }),
      verticalPadding: "extraSmall",
      onPress: () => {
        logging.menuClick({ title });
        onPress?.();
      }
    }
  );
}
var iconNameRegExp = /^(icon-|icn-(?!(car|sec|bank-(fill|square|horizontal))-))(.+)/i;
var iconURLRegExp = /^https:\/\/static\.toss\.im\/icons\/(png\/\dx|svg|pdf)\/((icon-|icn-(?!(car|sec|bank-(fill|square|horizontal))-))(.+))\.(png|svg|pdf)$/i;
function isIconUrl(url) {
  return iconNameRegExp.test(url) || iconURLRegExp.test(url);
}
function getIconName(url) {
  if (!isIconUrl(url)) {
    return null;
  }
  if (iconNameRegExp.test(url)) {
    return url;
  }
  return url.match(iconURLRegExp)?.[2];
}
function hexToRGB(hex) {
  const rgb = hex.toLowerCase().match(/[0-9,a-f]{2}/g)?.map((str) => parseInt(str, 16));
  return rgb?.length === 3 ? rgb : void 0;
}

// src/core/utils/url.ts
function addParamsToUrl(url, params) {
  const urlObj = new URL(url);
  for (const [key, value] of Object.entries(params)) {
    urlObj.searchParams.set(key, value);
  }
  return urlObj.toString();
}

// src/core/hooks/useMoreButtonBottomSheet/AppShareListMenu.tsx
var import_jsx_runtime6 = require("react/jsx-runtime");
var SHARE_SCHEME_REFERRER = "appsintoss.common_module_share";
var APP_SHARE_MENU_INFO = {
  contactItemName: "\uACF5\uC720\uD558\uAE30",
  contactIconUrl: "https://static.toss.im/icons/png/4x/icon-share-dots-mono.png"
};
function AppShareListMenu() {
  const initialScheme = (0, import_react_native17.getSchemeUri)();
  const isSandbox = (0, import_native_modules9.getOperationalEnvironment)() === "sandbox";
  const { openConfirm } = (0, import_tds_react_native7.useDialog)();
  const schemeForShare = addParamsToUrl(initialScheme, {
    referrer: SHARE_SCHEME_REFERRER
  });
  return /* @__PURE__ */ (0, import_jsx_runtime6.jsx)(
    Menu,
    {
      title: APP_SHARE_MENU_INFO.contactItemName,
      iconURL: APP_SHARE_MENU_INFO.contactIconUrl,
      onPress: () => {
        if (isSandbox) {
          openConfirm({
            title: "\uACF5\uC720\uD558\uAE30 \uAE30\uB2A5 \uBBF8\uC9C0\uC6D0",
            description: "\uC0CC\uB4DC\uBC15\uC2A4 \uD658\uACBD\uC5D0\uC11C\uB294 \uC0AC\uC6A9\uD560 \uC218 \uC5C6\uC5B4\uC694. \uCF58\uC194\uC744 \uD1B5\uD574 \uD1A0\uC2A4\uC571\uC5D0\uC11C \uD14C\uC2A4\uD2B8\uD574 \uC8FC\uC138\uC694.",
            rightButton: "\uD655\uC778",
            closeOnDimmerClick: true
          });
          return;
        }
        import_react_native18.NativeModules.AppsInTossModule.shareWithScheme({
          params: {
            schemeURL: schemeForShare
          }
        });
      }
    }
  );
}

// src/core/hooks/useMoreButtonBottomSheet/PermissionsMenu.tsx
var import_native_modules10 = require("@apps-in-toss/native-modules");
var import_react_native19 = require("@granite-js/react-native");
var import_jsx_runtime7 = require("react/jsx-runtime");
function PermissionsMenu() {
  const globals = getAppsInTossGlobals();
  if ((0, import_native_modules10.getOperationalEnvironment)() === "sandbox") {
    return null;
  }
  return /* @__PURE__ */ (0, import_jsx_runtime7.jsx)(
    Menu,
    {
      title: "\uAD8C\uD55C \uC124\uC815",
      iconURL: "https://static.toss.im/icons/png/4x/icon-setting-mono.png",
      onPress: () => (0, import_react_native19.openURL)(
        `servicetoss://apps-in-toss-menu/permissions?appName=${import_react_native19.Granite.appName}&displayAppName=${globals.brandDisplayName}`
      )
    }
  );
}

// src/core/utils/ensureValue.ts
function ensureValue(value, name) {
  if (value === void 0) {
    throw new Error(`${name} is required`);
  }
  return value;
}

// src/core/hooks/useMoreButtonBottomSheet/index.tsx
var import_jsx_runtime8 = require("react/jsx-runtime");
var APP_BRIDGE_METHOD_NAME = "getMiniAppsSupportContact";
var MIN_VERSION = {
  BOTTOM_SHEET: {
    android: "5.226.0",
    ios: "5.226.0"
  },
  SHARE_LIST_MENU: {
    android: "5.230.0",
    ios: "5.230.0"
  },
  PERMISSIONS_MENU: {
    android: "5.238.0",
    ios: "5.237.0"
  }
};
function useMoreButtonBottomSheet() {
  const globals = getAppsInTossGlobals();
  const adaptive = (0, import_private4.useAdaptive)();
  const [itemList, setItemList] = (0, import_react15.useState)([]);
  const appUpdateDialog = useAppUpdateDialog();
  const logging = useMoreButtonBottomSheetLogging();
  const overlay = (0, import_private4.useOverlay)();
  const title = ensureValue(globals.brandDisplayName, "displayName");
  const isBottomSheetSupported = (0, import_native_modules11.isMinVersionSupported)(MIN_VERSION.BOTTOM_SHEET);
  const isShareListMenuSupported = (0, import_native_modules11.isMinVersionSupported)(MIN_VERSION.SHARE_LIST_MENU);
  const [isPermissionsMenuSupported, setIsPermissionsMenuSupported] = (0, import_react15.useState)(false);
  (0, import_react15.useEffect)(() => {
    if (!isBottomSheetSupported) {
      return;
    }
    import_native_modules11.INTERNAL__appBridgeHandler.invokeAppBridgeMethod(
      APP_BRIDGE_METHOD_NAME,
      {},
      {
        onSuccess: ({ items }) => setItemList(items),
        onError: (error) => console.error("\uBA54\uB274 \uBAA9\uB85D\uC744 \uAC00\uC838\uC624\uB294 \uB370 \uC2E4\uD328\uD588\uC5B4\uC694:", error)
      }
    );
    if ((0, import_native_modules11.isMinVersionSupported)(MIN_VERSION.PERMISSIONS_MENU)) {
      import_native_modules11.INTERNAL__appBridgeHandler.invokeAppBridgeMethod(
        "getAllPermission",
        {},
        {
          onSuccess: (permissions) => setIsPermissionsMenuSupported(permissions.length > 0),
          onError: (error) => console.error("\uAD8C\uD55C \uBAA9\uB85D\uC744 \uAC00\uC838\uC624\uB294 \uB370 \uC2E4\uD328\uD588\uC5B4\uC694:", error)
        }
      );
    }
  }, [isBottomSheetSupported]);
  const onClickHandler = async () => {
    logging.open();
    if (!isBottomSheetSupported) {
      await appUpdateDialog.open({
        title: `\uC774 \uAE30\uB2A5\uC744 \uC4F0\uB824\uBA74 \uC571 \uC5C5\uB370\uC774\uD2B8\uAC00 \uD544\uC694\uD574\uC694`,
        description: `\uBB38\uC758, \uAD8C\uD55C \uC124\uC815, \uC2E0\uACE0 \uB4F1 \uAE30\uB2A5\uC744 \uC4F8 \uC218 \uC788\uC5B4\uC694`
      });
      return;
    }
    overlay.open(({ isOpen, exit, close }) => {
      const handleClose = () => {
        logging.close();
        close();
      };
      return /* @__PURE__ */ (0, import_jsx_runtime8.jsx)(BottomSheetImpressionArea, { children: /* @__PURE__ */ (0, import_jsx_runtime8.jsx)(
        import_tds_react_native8.BottomSheet.Root,
        {
          header: /* @__PURE__ */ (0, import_jsx_runtime8.jsx)(
            import_tds_react_native8.ListHeader,
            {
              title: /* @__PURE__ */ (0, import_jsx_runtime8.jsx)(import_tds_react_native8.ListHeader.TitleParagraph, { color: adaptive.grey800, fontWeight: "bold", typography: "t5", children: title })
            }
          ),
          open: isOpen,
          cta: /* @__PURE__ */ (0, import_jsx_runtime8.jsx)(
            import_tds_react_native8.BottomSheet.CTA,
            {
              size: "large",
              type: "dark",
              style: "weak",
              onPress: () => {
                handleClose();
              },
              children: "\uB2EB\uAE30"
            }
          ),
          onClose: handleClose,
          onExited: exit,
          children: /* @__PURE__ */ (0, import_jsx_runtime8.jsxs)(import_tds_react_native8.List, { rowSeparator: "none", children: [
            itemList.map((item) => /* @__PURE__ */ (0, import_jsx_runtime8.jsx)(
              Menu,
              {
                title: item.contactItemName,
                iconURL: item.contactIconUrl,
                onPress: () => (0, import_react_native20.openURL)(item.contactUri)
              },
              item.contactItemName
            )),
            isShareListMenuSupported && /* @__PURE__ */ (0, import_jsx_runtime8.jsx)(AppShareListMenu, {}),
            isPermissionsMenuSupported && /* @__PURE__ */ (0, import_jsx_runtime8.jsx)(PermissionsMenu, {})
          ] })
        }
      ) });
    });
  };
  return { open: onClickHandler };
}
function BottomSheetImpressionArea({ children }) {
  const logging = useMoreButtonBottomSheetLogging();
  (0, import_react15.useEffect)(() => {
    logging.show();
  }, [logging]);
  return /* @__PURE__ */ (0, import_jsx_runtime8.jsx)(import_jsx_runtime8.Fragment, { children });
}

// src/core/utils/toIcon.ts
function toIcon(source) {
  return source.startsWith("http") ? { source: { uri: source } } : { name: source };
}

// src/components/NavigationBar/common/NavigationBarImpressionArea.tsx
var import_react16 = require("react");
var import_jsx_runtime9 = require("react/jsx-runtime");
function NavigationBarImpressionArea({
  children,
  withHomeButton
}) {
  const hasLogged = (0, import_react16.useRef)(false);
  const logging = useNavigationBarLogging();
  (0, import_react16.useEffect)(() => {
    if (hasLogged.current === false) {
      logging.navBarImpression({ home_icon_yn: withHomeButton ? "Y" : "N" });
      hasLogged.current = true;
    }
  }, [logging, withHomeButton]);
  return /* @__PURE__ */ (0, import_jsx_runtime9.jsx)(import_jsx_runtime9.Fragment, { children });
}

// src/components/NavigationBar/RNNavigationBar/Default.tsx
var import_jsx_runtime10 = require("react/jsx-runtime");
function DefaultNavigationBar() {
  const globals = getAppsInTossGlobals();
  const { open: openMoreButtonBottomSheet } = useMoreButtonBottomSheet();
  const parsedNavigationBar = globals.navigationBar != null ? safeParseNavigationBar(globals.navigationBar) : null;
  const withHomeButton = parsedNavigationBar?.withHomeButton ?? false;
  const withBackButton = parsedNavigationBar?.withBackButton ?? true;
  const { navigationRightButton } = useNavigationBarContext();
  const navigationEvent = useNavigationEvent();
  useHardwareBackPress(navigationEvent.handleBack);
  return /* @__PURE__ */ (0, import_jsx_runtime10.jsx)(NavigationBarImpressionArea, { withHomeButton, children: /* @__PURE__ */ (0, import_jsx_runtime10.jsx)(
    import_private5.TopNavigation,
    {
      title: globals.brandDisplayName,
      icon: toIcon(globals.brandIcon),
      onPressDots: openMoreButtonBottomSheet,
      contentVisible: true,
      onPressTitle: withHomeButton ? navigationEvent.handleHomeButtonClick : void 0,
      onPressClose: navigationEvent.handleCloseButtonClick,
      withHome: withHomeButton,
      fixedRightButton: navigationRightButton,
      leftVisible: withBackButton,
      children: /* @__PURE__ */ (0, import_jsx_runtime10.jsx)(import_private5.NavigationLeft, { visible: withBackButton, children: /* @__PURE__ */ (0, import_jsx_runtime10.jsx)(import_private5.NavigationBackButton, { onPress: navigationEvent.handleBack, canGoBack: false }) })
    }
  ) });
}

// src/components/NavigationBar/RNNavigationBar/Game.tsx
var import_react_native_safe_area_context = require("@granite-js/native/react-native-safe-area-context");
var import_tds_react_native9 = require("@toss/tds-react-native");
var import_private6 = require("@toss/tds-react-native/private");
var import_react_native21 = require("react-native");
var import_jsx_runtime11 = require("react/jsx-runtime");
function GameNavigationBar() {
  const safeAreaTop = (0, import_private6.useSafeAreaTop)();
  const { open: openMoreButtonBottomSheet } = useMoreButtonBottomSheet();
  const navigationEvent = useNavigationEvent();
  const { navigationRightButton } = useNavigationBarContext();
  const { right: safeAreaRight } = (0, import_react_native_safe_area_context.useSafeAreaInsets)();
  useHardwareBackPress(navigationEvent.handleBack);
  return /* @__PURE__ */ (0, import_jsx_runtime11.jsxs)(import_jsx_runtime11.Fragment, { children: [
    /* @__PURE__ */ (0, import_jsx_runtime11.jsx)(import_tds_react_native9.PageNavbar, { preference: { type: "none" } }),
    /* @__PURE__ */ (0, import_jsx_runtime11.jsx)(
      import_react_native21.View,
      {
        style: {
          width: "100%",
          // TODO: UI관련 스타일 설정은 TDS로 이관
          height: import_react_native21.Platform.OS === "ios" ? 44 : 54,
          flexDirection: "row",
          alignItems: "center",
          justifyContent: "flex-end",
          position: "absolute",
          zIndex: Z_INDEX.CLOSE_BUTTON,
          marginTop: safeAreaTop,
          paddingRight: safeAreaRight + 10
        },
        pointerEvents: "box-none",
        children: /* @__PURE__ */ (0, import_jsx_runtime11.jsx)(
          import_private6.NavigationRightContent,
          {
            fixedRightButton: navigationRightButton,
            onPressDots: openMoreButtonBottomSheet,
            onPressClose: navigationEvent.handleCloseButtonClick,
            theme: "dark"
          }
        )
      }
    )
  ] });
}

// src/components/NavigationBar/RNNavigationBar/index.tsx
var RNNavigationBar = {
  Default: DefaultNavigationBar,
  Game: GameNavigationBar
};

// src/bridge-entry.ts
var bridge_entry_exports = {};
__reExport(bridge_entry_exports, require("@apps-in-toss/native-modules/async-bridges"));
__reExport(bridge_entry_exports, require("@apps-in-toss/native-modules/constant-bridges"));
__reExport(bridge_entry_exports, require("@apps-in-toss/native-modules/event-bridges"));

// src/components/RNAppContainer.tsx
var import_jsx_runtime12 = require("react/jsx-runtime");
function RNAppContainer({ children }) {
  const global2 = getAppsInTossGlobals();
  switch (global2.appType) {
    case "game":
      return /* @__PURE__ */ (0, import_jsx_runtime12.jsx)(GameAppContainer, { children });
    case "general":
    default:
      return /* @__PURE__ */ (0, import_jsx_runtime12.jsx)(GeneralAppContainer, { children });
  }
}
function GameAppContainer({ children }) {
  (0, import_react17.useEffect)(() => {
    if (import_react_native22.Platform.OS === "ios") {
      (0, import_native_modules12.setIosSwipeGestureEnabled)({ isEnabled: false });
      return () => {
        (0, import_native_modules12.setIosSwipeGestureEnabled)({ isEnabled: true });
      };
    }
    return;
  }, []);
  return /* @__PURE__ */ (0, import_jsx_runtime12.jsxs)(import_jsx_runtime12.Fragment, { children: [
    /* @__PURE__ */ (0, import_jsx_runtime12.jsx)(RNNavigationBar.Game, {}),
    (0, bridge_entry_exports.getOperationalEnvironment)() === "toss" ? /* @__PURE__ */ (0, import_jsx_runtime12.jsx)(GameInitializer, { children }) : children
  ] });
}
function GeneralAppContainer({ children }) {
  return /* @__PURE__ */ (0, import_jsx_runtime12.jsxs)(import_jsx_runtime12.Fragment, { children: [
    /* @__PURE__ */ (0, import_jsx_runtime12.jsx)(RNNavigationBar.Default, {}),
    children
  ] });
}

// src/core/registerApp.tsx
var import_jsx_runtime13 = require("react/jsx-runtime");
function AppsInTossContainer(Container, { children, ...initialProps }) {
  if (!(0, import_native_modules13.isMinVersionSupported)({
    android: "5.220.0",
    ios: "5.221.0"
  })) {
    return /* @__PURE__ */ (0, import_jsx_runtime13.jsxs)(import_jsx_runtime13.Fragment, { children: [
      /* @__PURE__ */ (0, import_jsx_runtime13.jsx)(AppEvent.Entry, {}),
      /* @__PURE__ */ (0, import_jsx_runtime13.jsx)(AppEvent.System, { ...initialProps }),
      /* @__PURE__ */ (0, import_jsx_runtime13.jsx)(AppUpdate, {})
    ] });
  }
  return /* @__PURE__ */ (0, import_jsx_runtime13.jsxs)(import_jsx_runtime13.Fragment, { children: [
    /* @__PURE__ */ (0, import_jsx_runtime13.jsx)(AppEvent.StayTime, {}),
    /* @__PURE__ */ (0, import_jsx_runtime13.jsx)(AppEvent.Entry, {}),
    /* @__PURE__ */ (0, import_jsx_runtime13.jsx)(AppEvent.System, { ...initialProps }),
    /* @__PURE__ */ (0, import_jsx_runtime13.jsx)(Container, { ...initialProps, children: /* @__PURE__ */ (0, import_jsx_runtime13.jsx)(import_tds_react_native10.TDSProvider, { colorPreference: "light", token: { color: { primary: getAppsInTossGlobals().brandPrimaryColor } }, children }) })
  ] });
}
function registerApp(container, { context, analytics }) {
  const appName = getAppName();
  const isRegistered = import_react_native24.AppRegistry.getAppKeys().includes(appName);
  if (!isRegistered) {
    import_analytics.Analytics.init({
      logger: (params) => void (0, import_native_modules13.eventLog)(params),
      debug: analytics?.debug ?? __DEV__
    });
    const App = import_react_native23.Granite.registerApp(AppsInTossContainer.bind(null, container), {
      appName,
      context,
      setIosSwipeGestureEnabled: import_native_modules13.setIosSwipeGestureEnabled,
      router: {
        screenContainer: AppsInTossScreenContainer,
        defaultScreenOption: {
          statusBarStyle: "dark"
        }
      }
    });
    global.Page = App;
  }
  return global.Page;
}
function AppsInTossScreenContainer({ children }) {
  const isRNApp = getAppsInTossGlobals().webViewType == null;
  return /* @__PURE__ */ (0, import_jsx_runtime13.jsx)(NavigationBarContextProvider, { children: /* @__PURE__ */ (0, import_jsx_runtime13.jsx)(import_analytics.Analytics.Screen, { children: isRNApp ? /* @__PURE__ */ (0, import_jsx_runtime13.jsx)(RNAppContainer, { children }) : children }) });
}
function getAppName() {
  try {
    return global.__granite.app.name;
  } catch (error) {
    console.error("unexpected error occurred while getting app name");
    throw error;
  }
}

// src/core/index.ts
var AppsInToss = {
  registerApp
};

// src/components/WebView.tsx
var import_native_modules23 = require("@apps-in-toss/native-modules");
var appsInTossAsyncBridges = __toESM(require("@apps-in-toss/native-modules/async-bridges"), 1);
var appsInTossConstantBridges = __toESM(require("@apps-in-toss/native-modules/constant-bridges"), 1);
var appsInTossEventBridges = __toESM(require("@apps-in-toss/native-modules/event-bridges"), 1);
var import_react_native_safe_area_context4 = require("@granite-js/native/react-native-safe-area-context");
var import_react_native38 = require("@granite-js/react-native");
var import_tds_react_native15 = require("@toss/tds-react-native");
var import_private9 = require("@toss/tds-react-native/private");
var import_react28 = require("react");
var import_react_native39 = require("react-native");

// src/components/GameWebView.tsx
var import_native_modules14 = require("@apps-in-toss/native-modules");
var import_react_native_webview = require("@granite-js/native/react-native-webview");
var import_react19 = require("react");
var import_react_native27 = require("react-native");

// src/components/NavigationBar/GameWebviewNavigationBar.tsx
var import_react_native_safe_area_context2 = require("@granite-js/native/react-native-safe-area-context");
var import_react_native25 = require("@granite-js/react-native");
var import_tds_react_native11 = require("@toss/tds-react-native");
var import_private7 = require("@toss/tds-react-native/private");
var import_es_hangul3 = require("es-hangul");
var import_react18 = require("react");
var import_react_native26 = require("react-native");
var import_jsx_runtime14 = require("react/jsx-runtime");
function GameWebviewNavigationBar() {
  const safeAreaTop = (0, import_private7.useSafeAreaTop)();
  const { openConfirm } = (0, import_tds_react_native11.useDialog)();
  const { captureExitLog } = useCaptureExitLog();
  const global2 = getAppsInTossGlobals();
  const logging = useNavigationBarLogging();
  const { open: openMoreButtonBottomSheet } = useMoreButtonBottomSheet();
  const { navigationRightButton } = useNavigationBarContext();
  const { right: safeAreaRight } = (0, import_react_native_safe_area_context2.useSafeAreaInsets)();
  const handleGameWebviewClose = (0, import_react18.useCallback)(async () => {
    logging.closeButtonClick();
    const isConfirmed = await openConfirm({
      title: `${(0, import_es_hangul3.josa)(global2.brandDisplayName, "\uC744/\uB97C")} \uC885\uB8CC\uD560\uAE4C\uC694?`,
      leftButton: "\uCDE8\uC18C",
      rightButton: "\uC885\uB8CC\uD558\uAE30",
      closeOnDimmerClick: true,
      onEntered: logging.closePopupShow
    });
    logging.closePopupCtaClick(isConfirmed);
    if (isConfirmed) {
      captureExitLog(Date.now());
      (0, import_react_native25.closeView)();
    }
  }, [captureExitLog, global2.brandDisplayName, logging, openConfirm]);
  return /* @__PURE__ */ (0, import_jsx_runtime14.jsxs)(import_jsx_runtime14.Fragment, { children: [
    /* @__PURE__ */ (0, import_jsx_runtime14.jsx)(import_tds_react_native11.PageNavbar, { preference: { type: "none" } }),
    /* @__PURE__ */ (0, import_jsx_runtime14.jsx)(
      import_react_native26.View,
      {
        style: {
          width: "100%",
          // TODO: UI관련 스타일 설정은 TDS로 이관
          height: import_react_native26.Platform.OS === "ios" ? 44 : 54,
          flexDirection: "row",
          alignItems: "center",
          justifyContent: "flex-end",
          position: "absolute",
          zIndex: Z_INDEX.CLOSE_BUTTON,
          marginTop: safeAreaTop,
          paddingRight: safeAreaRight + 10
        },
        pointerEvents: "box-none",
        children: /* @__PURE__ */ (0, import_jsx_runtime14.jsx)(
          import_private7.NavigationRightContent,
          {
            fixedRightButton: navigationRightButton,
            onPressDots: openMoreButtonBottomSheet,
            onPressClose: () => {
              handleGameWebviewClose();
            },
            theme: "dark"
          }
        )
      }
    )
  ] });
}

// src/components/GameWebView.tsx
var import_jsx_runtime15 = require("react/jsx-runtime");
var GameWebView = (0, import_react19.forwardRef)(function GameWebView2(props, ref) {
  (0, import_react19.useEffect)(() => {
    if (import_react_native27.Platform.OS === "ios") {
      (0, import_native_modules14.setIosSwipeGestureEnabled)({ isEnabled: false });
      return () => {
        (0, import_native_modules14.setIosSwipeGestureEnabled)({ isEnabled: true });
      };
    }
    return;
  }, []);
  return /* @__PURE__ */ (0, import_jsx_runtime15.jsxs)(import_jsx_runtime15.Fragment, { children: [
    /* @__PURE__ */ (0, import_jsx_runtime15.jsx)(GameWebviewNavigationBar, {}),
    (0, import_native_modules14.getOperationalEnvironment)() === "toss" ? /* @__PURE__ */ (0, import_jsx_runtime15.jsx)(GameInitializer, { children: /* @__PURE__ */ (0, import_jsx_runtime15.jsx)(import_react_native_webview.WebView, { ref, ...props }) }) : /* @__PURE__ */ (0, import_jsx_runtime15.jsx)(import_react_native_webview.WebView, { ref, ...props })
  ] });
});

// src/components/PartnerWebView.tsx
var import_react_native_webview2 = require("@granite-js/native/react-native-webview");
var import_react21 = require("react");

// src/components/NavigationBar/PartnerWebviewNavigationBar.tsx
var import_react_native28 = require("@granite-js/react-native");
var import_tds_react_native12 = require("@toss/tds-react-native");
var import_private8 = require("@toss/tds-react-native/private");
var import_es_hangul4 = require("es-hangul");
var import_react20 = require("react");
var import_jsx_runtime16 = require("react/jsx-runtime");
function PartnerWebviewNavigationBar({ onBackButtonClick, onHomeButtonClick }) {
  const globals = getAppsInTossGlobals();
  const { captureExitLog } = useCaptureExitLog();
  const logging = useNavigationBarLogging();
  const { openConfirm } = (0, import_tds_react_native12.useDialog)();
  const { open: openMoreButtonBottomSheet } = useMoreButtonBottomSheet();
  const parsedNavigationBar = globals.navigationBar != null ? safeParseNavigationBar(globals.navigationBar) : null;
  const withHomeButton = parsedNavigationBar?.withHomeButton ?? false;
  const withBackButton = parsedNavigationBar?.withBackButton ?? true;
  const { navigationRightButton } = useNavigationBarContext();
  const handleClose = (0, import_react20.useCallback)(async () => {
    logging.closeButtonClick();
    const isConfirmed = await openConfirm({
      title: `${(0, import_es_hangul4.josa)(globals.brandDisplayName, "\uC744/\uB97C")} \uC885\uB8CC\uD560\uAE4C\uC694?`,
      leftButton: "\uCDE8\uC18C",
      rightButton: "\uC885\uB8CC\uD558\uAE30",
      closeOnDimmerClick: true,
      onEntered: logging.closePopupShow
    });
    logging.closePopupCtaClick(isConfirmed);
    if (isConfirmed) {
      captureExitLog(Date.now());
      (0, import_react_native28.closeView)();
    }
  }, [captureExitLog, globals.brandDisplayName, logging, openConfirm]);
  return /* @__PURE__ */ (0, import_jsx_runtime16.jsx)(NavigationBarImpressionArea, { withHomeButton, children: /* @__PURE__ */ (0, import_jsx_runtime16.jsx)(
    import_private8.TopNavigation,
    {
      title: globals.brandDisplayName,
      icon: toIcon(globals.brandIcon),
      onPressDots: openMoreButtonBottomSheet,
      contentVisible: true,
      onPressTitle: withHomeButton ? onHomeButtonClick : void 0,
      onPressClose: handleClose,
      withHome: withHomeButton,
      fixedRightButton: navigationRightButton,
      leftVisible: withBackButton,
      children: /* @__PURE__ */ (0, import_jsx_runtime16.jsx)(import_private8.NavigationLeft, { visible: withBackButton, children: /* @__PURE__ */ (0, import_jsx_runtime16.jsx)(import_private8.NavigationBackButton, { onPress: onBackButtonClick, canGoBack: false }) })
    }
  ) });
}

// src/components/PartnerWebView.tsx
var import_jsx_runtime17 = require("react/jsx-runtime");
var PartnerWebView = (0, import_react21.forwardRef)(function PartnerWebViewScreen({ onBackButtonClick, onHomeButtonClick, ...webViewProps }, ref) {
  return /* @__PURE__ */ (0, import_jsx_runtime17.jsxs)(import_jsx_runtime17.Fragment, { children: [
    /* @__PURE__ */ (0, import_jsx_runtime17.jsx)(PartnerWebviewNavigationBar, { onBackButtonClick, onHomeButtonClick }),
    /* @__PURE__ */ (0, import_jsx_runtime17.jsx)(import_react_native_webview2.WebView, { ref, ...webViewProps, style: { flex: 1 } })
  ] });
});

// src/components/utils/url.ts
function convertIntentURL(url) {
  if (url.protocol !== "intent:") {
    return null;
  }
  const components = url.hash.replace("#Intent;", "").split(";").map((component) => component.split("="));
  const scheme = components.find(([key]) => key === "scheme")?.[1];
  if (!scheme) {
    return null;
  }
  return `${scheme}://${url.hostname}${url.pathname}${url.search}`;
}

// src/ads/fetchTossAd.ts
var import_native_modules15 = require("@apps-in-toss/native-modules");

// ../../../.yarn/cache/es-toolkit-npm-1.34.1-4cd6371dcb-aab6d07be3.zip/node_modules/es-toolkit/dist/function/noop.mjs
function noop() {
}

// src/ads/generateSessionId.ts
function generateSessionId() {
  return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
    const r = Math.random() * 16 | 0;
    const v = c === "x" ? r : r & 3 | 8;
    return v.toString(16);
  });
}

// src/ads/constants.ts
var sessionId = generateSessionId();

// src/ads/fetchTossAd.ts
var ANDROID_FETCH_TOSS_AD_SUPPORTED_VERSION = "5.241.0";
var IOS_FETCH_TOSS_AD_SUPPORTED_VERSION = "5.241.0";
var UNSUPPORTED_ERROR_MESSAGE = "This feature is not supported in the current environment";
var ENVIRONMENT = (0, import_native_modules15.getOperationalEnvironment)();
function fetchTossAd(params) {
  if (!fetchTossAd.isSupported()) {
    params.onError(new Error(UNSUPPORTED_ERROR_MESSAGE));
    return noop;
  }
  const { onEvent, onError, options } = params;
  const { adGroupId } = options;
  const unregisterCallbacks = import_native_modules15.INTERNAL__appBridgeHandler.invokeAppBridgeMethod(
    "fetchTossAd",
    { spaceUnitId: adGroupId, sessionId, sdkId: options.sdkId, availableStyleIds: options.availableStyleIds },
    {
      onSuccess: (response) => {
        onEvent(response);
      },
      onError: (error) => {
        onError(error);
      }
    }
  );
  return unregisterCallbacks;
}
fetchTossAd.isSupported = () => {
  if (ENVIRONMENT !== "toss") {
    return false;
  }
  return (0, import_native_modules15.isMinVersionSupported)({
    android: ANDROID_FETCH_TOSS_AD_SUPPORTED_VERSION,
    ios: IOS_FETCH_TOSS_AD_SUPPORTED_VERSION
  });
};

// src/ads/integratedAd.ts
var import_native_modules17 = require("@apps-in-toss/native-modules");

// src/ads/generateRequestId.ts
function generateRequestId() {
  const timestamp = Date.now().toString(36).toUpperCase();
  const random = Math.random().toString(36).substring(2, 7).toUpperCase();
  return `ait-${timestamp}${random}`;
}

// src/ads/getReferrer.ts
var import_react_native29 = require("@granite-js/react-native");
function getReferrer() {
  try {
    return new URL((0, import_react_native29.getSchemeUri)()).searchParams.get("referrer");
  } catch {
    return null;
  }
}

// src/ads/remotes.ts
var import_native_modules16 = require("@apps-in-toss/native-modules");

// src/ads/getIsDev.ts
var import_react_native30 = require("@granite-js/react-native");
function getIsDev() {
  try {
    return new URL((0, import_react_native30.getSchemeUri)()).searchParams.get("isDev") === "true";
  } catch {
    return false;
  }
}

// src/ads/remotes.ts
var OPERATIONAL_ENVIRONMENT = (0, import_native_modules16.getOperationalEnvironment)();
var OS = (0, import_native_modules16.getPlatformOS)();
var APP_VER = (0, import_native_modules16.getTossAppVersion)();
var ALPHA_EVENT_TRACKER_HTTP_ENDPOINT = "https://alpha-trillion.toss.im/trk/sdk-mediation/event";
var LIVE_EVENT_TRACKER_HTTP_ENDPOINT = "https://trillion.toss.im/trk/sdk-mediation/event";
function getPostEventTrackingUrl() {
  const isDev = getIsDev();
  if (OPERATIONAL_ENVIRONMENT === "sandbox" || isDev) {
    return ALPHA_EVENT_TRACKER_HTTP_ENDPOINT;
  }
  return LIVE_EVENT_TRACKER_HTTP_ENDPOINT;
}
function postEventTracking(params) {
  const endpoint = getPostEventTrackingUrl();
  const bodyJSON = JSON.stringify({
    ...params,
    os: OS,
    appVer: APP_VER,
    deviceIdType: "NONE",
    platform: "RN"
  });
  return fetch(endpoint, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: bodyJSON
  }).catch(noop);
}

// src/ads/integratedAd.ts
var INTEGRATED_AD_SDK_VERSION = "0.0.0";
var ANDROID_INTEGRATED_AD_SUPPORTED_VERSION = "5.241.0";
var IOS_INTEGRATED_AD_SUPPORTED_VERSION = "5.241.0";
var UNSUPPORTED_ERROR_MESSAGE2 = "This feature is not supported in the current environment";
var INTG_AD_ADM_FALLBACK_RID_MAP = {};
function integratedAdIsSupported() {
  return (0, import_native_modules17.isMinVersionSupported)({
    android: ANDROID_INTEGRATED_AD_SUPPORTED_VERSION,
    ios: IOS_INTEGRATED_AD_SUPPORTED_VERSION
  });
}
function generateLoadFullScreenAd(sdkId) {
  const fn = (params) => {
    if (!import_native_modules17.GoogleAdMob.loadAppsInTossAdMob.isSupported()) {
      params.onError(new Error(UNSUPPORTED_ERROR_MESSAGE2));
      return noop;
    }
    if (!integratedAdIsSupported()) {
      return import_native_modules17.GoogleAdMob.loadAppsInTossAdMob({
        ...params,
        onEvent: (event) => {
          if (event.type === "loaded") {
            const requestId = generateRequestId();
            INTG_AD_ADM_FALLBACK_RID_MAP[params.options.adGroupId] = requestId;
            postEventTracking({
              eventName: "LOAD",
              spaceUnitId: params.options.adGroupId,
              requestId,
              responseId: event.data.responseInfo.responseId,
              mediationType: "ADMOB",
              format: "",
              adSourceName: event.data.responseInfo.loadedAdNetworkInfo?.adSourceName ?? "",
              sdkVer: INTEGRATED_AD_SDK_VERSION
            });
          }
          return params.onEvent(event);
        },
        onError: (error) => {
          const requestId = INTG_AD_ADM_FALLBACK_RID_MAP[params.options.adGroupId] ?? "";
          postEventTracking({
            eventName: "FAILED_TO_LOAD",
            spaceUnitId: params.options.adGroupId,
            requestId,
            responseId: "",
            mediationType: "ADMOB",
            format: "",
            adSourceName: "",
            sdkVer: INTEGRATED_AD_SDK_VERSION
          });
          return params.onError(error);
        }
      });
    }
    const { onEvent, onError, options } = params;
    const { adGroupId } = options;
    const referrer = getReferrer();
    const unregisterCallbacks = import_native_modules17.INTERNAL__appBridgeHandler.invokeAppBridgeMethod(
      "loadTossAdOrAdmob",
      { spaceUnitId: adGroupId, referrer, sessionId, sdkId },
      {
        onSuccess: () => {
          onEvent({ type: "loaded" });
        },
        onError: (error) => {
          onError(error);
        }
      }
    );
    return unregisterCallbacks;
  };
  fn.isSupported = import_native_modules17.GoogleAdMob.loadAppsInTossAdMob.isSupported;
  return fn;
}
var loadFullScreenAd = generateLoadFullScreenAd("107");
var loadFullScreenAdForWeb = generateLoadFullScreenAd("107");
function showFullScreenAd(params) {
  if (!import_native_modules17.GoogleAdMob.showAppsInTossAdMob.isSupported()) {
    params.onError(new Error(UNSUPPORTED_ERROR_MESSAGE2));
    return noop;
  }
  if (!integratedAdIsSupported()) {
    return import_native_modules17.GoogleAdMob.showAppsInTossAdMob({
      ...params,
      onEvent: (event) => {
        const requestId = INTG_AD_ADM_FALLBACK_RID_MAP[params.options.adGroupId] ?? "";
        switch (event.type) {
          case "show":
            postEventTracking({
              eventName: "SHOW",
              spaceUnitId: params.options.adGroupId,
              requestId,
              responseId: "",
              mediationType: "ADMOB",
              format: "",
              adSourceName: "",
              sdkVer: INTEGRATED_AD_SDK_VERSION
            });
            break;
          case "failedToShow":
            postEventTracking({
              eventName: "FAILED_TO_SHOW",
              spaceUnitId: params.options.adGroupId,
              requestId,
              responseId: "",
              mediationType: "ADMOB",
              format: "",
              adSourceName: "",
              sdkVer: INTEGRATED_AD_SDK_VERSION
            });
            break;
          case "impression":
            postEventTracking({
              eventName: "IMP",
              spaceUnitId: params.options.adGroupId,
              requestId,
              responseId: "",
              mediationType: "ADMOB",
              format: "",
              adSourceName: "",
              sdkVer: INTEGRATED_AD_SDK_VERSION
            });
            break;
          case "clicked":
            postEventTracking({
              eventName: "CLICK",
              spaceUnitId: params.options.adGroupId,
              requestId,
              responseId: "",
              mediationType: "ADMOB",
              format: "",
              adSourceName: "",
              sdkVer: INTEGRATED_AD_SDK_VERSION
            });
            break;
          case "dismissed":
            postEventTracking({
              eventName: "DISMISS",
              spaceUnitId: params.options.adGroupId,
              requestId,
              responseId: "",
              mediationType: "ADMOB",
              format: "",
              adSourceName: "",
              sdkVer: INTEGRATED_AD_SDK_VERSION
            });
            break;
          case "userEarnedReward":
            postEventTracking({
              eventName: "USER_EARNED_REWARD",
              spaceUnitId: params.options.adGroupId,
              requestId,
              responseId: "",
              mediationType: "ADMOB",
              format: "",
              adSourceName: "",
              sdkVer: INTEGRATED_AD_SDK_VERSION
            });
            break;
        }
        return params.onEvent(event);
      },
      onError: (error) => {
        const requestId = INTG_AD_ADM_FALLBACK_RID_MAP[params.options.adGroupId] ?? "";
        postEventTracking({
          eventName: "FAILED_TO_SHOW",
          spaceUnitId: params.options.adGroupId,
          requestId,
          responseId: "",
          mediationType: "ADMOB",
          format: "",
          adSourceName: "",
          sdkVer: INTEGRATED_AD_SDK_VERSION
        });
        return params.onError(error);
      }
    });
  }
  const { onEvent, onError, options } = params;
  const { adGroupId } = options;
  const referrer = getReferrer();
  const unregisterCallbacks = import_native_modules17.INTERNAL__appBridgeHandler.invokeAppBridgeMethod(
    "showTossAdOrAdmob",
    { spaceUnitId: adGroupId, referrer, sessionId },
    {
      onAdClicked: () => {
        onEvent({ type: "clicked" });
      },
      onAdDismissed: () => {
        onEvent({ type: "dismissed" });
      },
      onAdFailedToShow: () => {
        onEvent({ type: "failedToShow" });
      },
      onAdImpression: () => {
        onEvent({ type: "impression" });
      },
      onAdShow: () => {
        onEvent({ type: "show" });
      },
      onUserEarnedReward: (data) => {
        onEvent({ type: "userEarnedReward", data });
      },
      onSuccess: () => {
        onEvent({ type: "requested" });
      },
      onError: (error) => {
        onError(error);
      }
    }
  );
  return unregisterCallbacks;
}
showFullScreenAd.isSupported = import_native_modules17.GoogleAdMob.showAppsInTossAdMob.isSupported;

// src/ads/tossAdEventLog.ts
var import_native_modules18 = require("@apps-in-toss/native-modules");
var import_react_native31 = require("@granite-js/react-native");
async function tossAdEventLog(params) {
  const referrer = getReferrer();
  const appName = import_react_native31.Granite.appName;
  const eventLogParams = {
    ...params,
    params: {
      ...params.params,
      referrer,
      app_name: appName
    }
  };
  return import_native_modules18.INTERNAL__module.tossCoreEventLog(eventLogParams);
}

// src/bridge-handler/useBridgeHandler.tsx
var import_react22 = require("react");
function serializeError(error) {
  return JSON.stringify(error, (_, value) => {
    if (value instanceof Error) {
      return {
        ...Object.entries(value).reduce((acc, [key, value2]) => {
          acc[key] = value2;
          return acc;
        }, {}),
        name: value.name,
        message: value.message,
        stack: value.stack,
        __isError: true
      };
    }
    return value;
  });
}
function methodHandler({
  args,
  eventId,
  functionName,
  handlerMap,
  injectJavaScript
}) {
  const func = handlerMap[functionName];
  if (!func) {
    console.error(`${functionName} is not a function`);
    return;
  }
  const wrappedFunc = async (...args2) => {
    const result = await func(...args2);
    return result;
  };
  wrappedFunc(...args).then((result) => {
    injectJavaScript?.(`
      window.__GRANITE_NATIVE_EMITTER.emit('${functionName}/resolve/${eventId}', ${JSON.stringify(result, null, 0)});
    `);
  }).catch((error) => {
    const serializedError = serializeError(error);
    injectJavaScript?.(`
      window.__GRANITE_NATIVE_EMITTER.emit('${functionName}/reject/${eventId}', ${serializedError});
    `);
  });
}
var globalEventListenerMap = /* @__PURE__ */ new Map();
function useBridgeHandler({
  onMessage,
  constantHandlerMap,
  asyncHandlerMap,
  eventListenerMap
}) {
  const ref = (0, import_react22.useRef)(null);
  const injectedJavaScript = (0, import_react22.useMemo)(
    () => `window.__CONSTANT_HANDLER_MAP = ${JSON.stringify(
      Object.entries(constantHandlerMap).reduce(
        (acc, [key, value]) => {
          acc[key] = typeof value === "function" ? value() : value;
          return acc;
        },
        {}
      )
    )};`,
    [constantHandlerMap]
  );
  (0, import_react22.useEffect)(() => {
    ref.current?.injectJavaScript(injectedJavaScript);
  }, [injectedJavaScript]);
  const createHandleOnEvent = (functionName, eventId) => (response) => {
    ref.current?.injectJavaScript(`
      window.__GRANITE_NATIVE_EMITTER.emit('${functionName}/onEvent/${eventId}', ${JSON.stringify(response, null, 0)});
    `);
  };
  const createHandleOnError = (functionName, eventId) => (error) => {
    const serializedError = serializeError(error);
    ref.current?.injectJavaScript(`
      window.__GRANITE_NATIVE_EMITTER.emit('${functionName}/onError/${eventId}', ${serializedError});
    `);
  };
  const $onMessage = (0, import_react22.useCallback)(
    async (e) => {
      onMessage?.(e);
      const data = parseNativeEventData(e.nativeEvent.data);
      if (typeof data !== "object" || data === null || typeof data.functionName !== "string" || typeof data.eventId !== "string" || typeof data.type !== "string" || !["addEventListener", "removeEventListener", "method"].includes(data.type)) {
        return;
      }
      switch (data.type) {
        case "addEventListener": {
          const handleOnEvent = createHandleOnEvent(data.functionName, data.eventId);
          const handleOnError = createHandleOnError(data.functionName, data.eventId);
          const remove = eventListenerMap[data.functionName]?.({
            onEvent: handleOnEvent,
            onError: handleOnError,
            options: data.args
          });
          if (remove) {
            globalEventListenerMap.set(`${data.functionName}/${data.eventId}`, remove);
          }
          break;
        }
        case "removeEventListener": {
          const key = `${data.functionName}/${data.eventId}`;
          const remove = globalEventListenerMap.get(key);
          remove?.();
          globalEventListenerMap.delete(key);
          break;
        }
        case "method": {
          methodHandler({
            args: data.args,
            eventId: data.eventId,
            functionName: data.functionName,
            handlerMap: asyncHandlerMap,
            injectJavaScript: ref.current?.injectJavaScript
          });
          break;
        }
      }
    },
    // eslint-disable-next-line react-hooks/exhaustive-deps
    [onMessage]
  );
  return {
    ref,
    injectedJavaScript,
    onMessage: $onMessage
  };
}
function parseNativeEventData(data) {
  try {
    return JSON.parse(data);
  } catch (error) {
    console.error(error);
    return null;
  }
}

// src/core/hooks/useSafeAreaInsetsEmitter.tsx
var import_react_native_safe_area_context3 = require("@granite-js/native/react-native-safe-area-context");
var import_react23 = require("react");
var EventEmitter = class {
  listeners = {};
  on(event, listener) {
    if (!this.listeners[event]) {
      this.listeners[event] = [];
    }
    this.listeners[event].push(listener);
  }
  emit(event, ...args) {
    if (!this.listeners[event]) {
      return;
    }
    this.listeners[event].forEach((listener) => listener(...args));
  }
  off(event, listener) {
    if (!this.listeners[event]) {
      return;
    }
    this.listeners[event] = this.listeners[event].filter((l) => l !== listener);
  }
};
function useSafeAreaInsetsEmitter() {
  const insets = (0, import_react_native_safe_area_context3.useSafeAreaInsets)();
  const emitter = (0, import_react23.useMemo)(() => new EventEmitter(), []);
  (0, import_react23.useEffect)(() => {
    emitter.emit("safeAreaInsetsChange", insets);
    return () => {
      emitter.off("safeAreaInsetsChange", (listener) => listener(insets));
    };
  }, [emitter, insets]);
  return emitter;
}

// src/core/hooks/useWebBackHandler.tsx
var import_react_native32 = require("@granite-js/react-native");
var import_tds_react_native13 = require("@toss/tds-react-native");
var import_es_hangul5 = require("es-hangul");
var import_react25 = require("react");

// src/hooks/useWebviewHistoryStack.tsx
var import_react24 = require("react");
var INITIAL_STATE = { stack: [], index: -1 };
function reducer(state, action) {
  switch (action.type) {
    case "NAVIGATION_CHANGE": {
      const { url, canGoForward } = action;
      if (state.stack.length === 0) {
        return { stack: [url], index: 0 };
      }
      const { stack, index } = state;
      const cur = stack[index];
      if (url === cur) {
        return state;
      }
      const prev = index > 0 ? stack[index - 1] : void 0;
      const next = index < stack.length - 1 ? stack[index + 1] : void 0;
      if (prev && url === prev && canGoForward) {
        return { ...state, index: index - 1 };
      }
      if (next && url === next) {
        return { ...state, index: index + 1 };
      }
      const base = stack.slice(0, index + 1);
      const nextStack = [...base, url];
      return { stack: nextStack, index: nextStack.length - 1 };
    }
    default:
      return state;
  }
}
function useWebViewHistory() {
  const [state, dispatch] = (0, import_react24.useReducer)(reducer, INITIAL_STATE);
  const onNavigationStateChange = (0, import_react24.useCallback)(({ url, canGoForward: canGoForward2 }) => {
    dispatch({ type: "NAVIGATION_CHANGE", url, canGoForward: canGoForward2 });
  }, []);
  const { canGoBack, canGoForward } = (0, import_react24.useMemo)(() => {
    const canBack = state.index > 0;
    const canFwd = state.index >= 0 && state.index < state.stack.length - 1;
    return { canGoBack: canBack, canGoForward: canFwd };
  }, [state.index, state.stack.length]);
  return { onNavigationStateChange, hasHistory: canGoBack, canGoForward };
}

// src/core/hooks/useWebBackHandler.tsx
var HISTORY_BACK_SCRIPT = `
(function() {
  window.history.back();
  true;
})();
`;
var HISTORY_HOME_SCRIPT = `
  (function() {
    window.location.href = '/';
    true;
  })();
`;
function useWebBackHandler(webViewRef) {
  const { captureExitLog } = useCaptureExitLog();
  const { hasHistory, onNavigationStateChange } = useWebViewHistory();
  const {
    handlersRef: webBackHandlersRef,
    hasBackEvent: hasWebBackEvent,
    addEventListener: addWebBackEventListener,
    removeEventListener: removeWebBackEventListener
  } = (0, import_react_native32.useBackEventState)();
  const logging = useNavigationBarLogging();
  const { openConfirm } = (0, import_tds_react_native13.useDialog)();
  const global2 = getAppsInTossGlobals();
  const addEventListener = (0, import_react25.useCallback)(
    (handler) => {
      addWebBackEventListener(handler);
    },
    [addWebBackEventListener]
  );
  const removeEventListener = (0, import_react25.useCallback)(
    (handler) => {
      removeWebBackEventListener(handler);
    },
    [removeWebBackEventListener]
  );
  const handleWebBack = (0, import_react25.useCallback)(async () => {
    if (hasWebBackEvent) {
      for (const handler of webBackHandlersRef) {
        handler();
      }
      return;
    }
    if (hasHistory) {
      webViewRef.current?.injectJavaScript(HISTORY_BACK_SCRIPT);
    } else {
      const isConfirmed = await openConfirm({
        title: `${(0, import_es_hangul5.josa)(global2.brandDisplayName, "\uC744/\uB97C")} \uC885\uB8CC\uD560\uAE4C\uC694?`,
        leftButton: "\uCDE8\uC18C",
        rightButton: "\uC885\uB8CC\uD558\uAE30",
        closeOnDimmerClick: true,
        onEntered: logging.closePopupShow
      });
      logging.closePopupCtaClick(isConfirmed);
      if (isConfirmed) {
        captureExitLog(Date.now());
        (0, import_react_native32.closeView)();
      }
    }
  }, [
    captureExitLog,
    global2.brandDisplayName,
    hasHistory,
    hasWebBackEvent,
    webBackHandlersRef,
    logging,
    openConfirm,
    webViewRef
  ]);
  const handleWebHome = (0, import_react25.useCallback)(() => {
    logging.homeButtonClick();
    if (hasWebBackEvent) {
      for (const handler of webBackHandlersRef) {
        handler();
      }
      return;
    }
    webViewRef.current?.injectJavaScript(HISTORY_HOME_SCRIPT);
  }, [hasWebBackEvent, webBackHandlersRef, logging, webViewRef]);
  return (0, import_react25.useMemo)(
    () => ({ addEventListener, removeEventListener, handleWebBack, handleWebHome, onNavigationStateChange }),
    [addEventListener, removeEventListener, handleWebBack, handleWebHome, onNavigationStateChange]
  );
}

// src/core/utils/mergeRefs.ts
function mergeRefs(...refs) {
  return (value) => {
    refs.forEach((ref) => {
      if (typeof ref === "function") {
        ref(value);
      } else if (ref != null) {
        ref.current = value;
      }
    });
  };
}

// src/hooks/useCreateUserAgent.ts
var import_native_modules19 = require("@apps-in-toss/native-modules");
var import_react_native33 = require("react-native");
var FontA11yCategory = {
  Large: "Large",
  xLarge: "xLarge",
  xxLarge: "xxLarge",
  xxxLarge: "xxxLarge",
  A11y_Medium: "A11y_Medium",
  A11y_Large: "A11y_Large",
  A11y_xLarge: "A11y_xLarge",
  A11y_xxLarge: "A11y_xxLarge",
  A11y_xxxLarge: "A11y_xxxLarge"
};
var androidFontScaleMap = {
  100: FontA11yCategory.Large,
  110: FontA11yCategory.xLarge,
  120: FontA11yCategory.xxLarge,
  135: FontA11yCategory.xxxLarge,
  160: FontA11yCategory.A11y_Medium,
  190: FontA11yCategory.A11y_Large,
  235: FontA11yCategory.A11y_xLarge,
  275: FontA11yCategory.A11y_xxLarge,
  310: FontA11yCategory.A11y_xxxLarge
};
var iosScaleToAndroidScale = {
  0.823: 100,
  0.882: 100,
  0.941: 100,
  1: 100,
  1.118: 110,
  1.235: 120,
  1.353: 135,
  1.786: 160,
  2.143: 190,
  2.643: 235,
  3.143: 275,
  3.571: 310
};
function convertToAndroidStyleScale(fontScale, platform) {
  if (platform === "android") {
    if (fontScale <= 1) {
      return 100;
    }
    const scaledValue = Math.round(fontScale * 100);
    const keys = Object.keys(androidFontScaleMap).map(Number).sort((a, b) => a - b);
    let closestKey = keys[0];
    let minDiff = Math.abs(scaledValue - closestKey);
    for (const key of keys) {
      const diff = Math.abs(scaledValue - key);
      if (diff < minDiff) {
        minDiff = diff;
        closestKey = key;
      }
    }
    return closestKey;
  } else {
    const iosScales = Object.keys(iosScaleToAndroidScale).map(Number);
    let closestScale = iosScales[0];
    let minDiff = Math.abs(fontScale - closestScale);
    for (const scale of iosScales) {
      const diff = Math.abs(fontScale - scale);
      if (diff < minDiff) {
        minDiff = diff;
        closestScale = scale;
      }
    }
    return iosScaleToAndroidScale[closestScale];
  }
}
function mapIOSFontScaleToCategory(fontScale) {
  if (fontScale < 1) {
    return FontA11yCategory.Large;
  }
  if (Math.abs(fontScale - 1) < 0.05) {
    return FontA11yCategory.Large;
  }
  if (Math.abs(fontScale - 1.118) < 0.05) {
    return FontA11yCategory.xLarge;
  }
  if (Math.abs(fontScale - 1.235) < 0.05) {
    return FontA11yCategory.xxLarge;
  }
  if (Math.abs(fontScale - 1.353) < 0.05) {
    return FontA11yCategory.xxxLarge;
  }
  if (Math.abs(fontScale - 1.786) < 0.05) {
    return FontA11yCategory.A11y_Medium;
  }
  if (Math.abs(fontScale - 2.143) < 0.05) {
    return FontA11yCategory.A11y_Large;
  }
  if (Math.abs(fontScale - 2.643) < 0.05) {
    return FontA11yCategory.A11y_xLarge;
  }
  if (Math.abs(fontScale - 3.143) < 0.05) {
    return FontA11yCategory.A11y_xxLarge;
  }
  if (Math.abs(fontScale - 3.571) < 0.05) {
    return FontA11yCategory.A11y_xxxLarge;
  }
  return FontA11yCategory.Large;
}
function mapAndroidFontScaleToCategory(fontScale) {
  if (fontScale <= 1) {
    return androidFontScaleMap[100];
  }
  const scaledValue = Math.round(fontScale * 100);
  const keys = Object.keys(androidFontScaleMap).map(Number).sort((a, b) => a - b);
  if (keys.length === 0) {
    return androidFontScaleMap[100];
  }
  let closestKey = keys[0];
  let minDiff = Math.abs(scaledValue - closestKey);
  for (const key of keys) {
    const diff = Math.abs(scaledValue - key);
    if (diff < minDiff) {
      minDiff = diff;
      closestKey = key;
    }
  }
  return androidFontScaleMap[closestKey];
}
function mapFontScaleToCategory(fontScale, platform) {
  return platform === "ios" ? mapIOSFontScaleToCategory(fontScale) : mapAndroidFontScaleToCategory(fontScale);
}
function useCreateUserAgent({
  batteryModePreference,
  colorPreference,
  locale,
  navbarPreference,
  pureSafeArea,
  safeArea,
  safeAreaBottomTransparency
}) {
  const platform = (0, import_native_modules19.getPlatformOS)();
  const appVersion = (0, import_native_modules19.getTossAppVersion)();
  const { fontScale } = (0, import_react_native33.useWindowDimensions)();
  const platformString = platform === "ios" ? "iPhone" : "Android phone";
  const fontA11y = mapFontScaleToCategory(fontScale, platform);
  const normalizedFontScale = convertToAndroidStyleScale(fontScale, platform);
  return [
    "AppsInToss",
    `TossApp/${appVersion}`,
    batteryModePreference && `TossBatteryModePreference/${batteryModePreference}`,
    colorPreference && `TossColorPreference/${colorPreference}`,
    `TossFontAccessibility/${fontA11y}`,
    `TossFontScale/${normalizedFontScale}`,
    locale && `TossLocale/${locale}`,
    navbarPreference && `TossNavbarPreference/${navbarPreference}`,
    pureSafeArea && `TossPureSafeArea/${pureSafeArea}`,
    safeArea && `TossSafeArea/${safeArea}`,
    safeAreaBottomTransparency && `TossSafeAreaBottomTransparency/${safeAreaBottomTransparency}`,
    platformString
  ].filter(Boolean).join(" ");
}

// src/hooks/useGeolocation.ts
var import_native_modules20 = require("@apps-in-toss/native-modules");
var import_react_native34 = require("@granite-js/react-native");
var import_react26 = require("react");
function useGeolocation({ accuracy, distanceInterval, timeInterval }) {
  const isVisible = (0, import_react_native34.useVisibility)();
  const [location, setLocation] = (0, import_react26.useState)(null);
  (0, import_react26.useEffect)(() => {
    if (!isVisible) {
      return;
    }
    return (0, import_native_modules20.startUpdateLocation)({
      options: {
        accuracy,
        distanceInterval,
        timeInterval
      },
      onEvent: setLocation,
      onError: console.error
    });
  }, [accuracy, distanceInterval, timeInterval, isVisible]);
  return location;
}

// src/hooks/useWaitForReturnNavigator.tsx
var import_react_native35 = require("@granite-js/react-native");
var import_react27 = require("react");
function useWaitForReturnNavigator() {
  const callbacks = (0, import_react27.useRef)([]).current;
  const navigation = (0, import_react_native35.useNavigation)();
  const startNavigating = (0, import_react27.useCallback)(
    (route, params) => {
      return new Promise((resolve) => {
        callbacks.push(resolve);
        navigation.navigate(route, params);
      });
    },
    [callbacks, navigation]
  );
  const handleVisibilityChange = (0, import_react27.useCallback)(
    (state) => {
      if (state === "visible" && callbacks.length > 0) {
        for (const callback of callbacks) {
          callback();
        }
        callbacks.splice(0, callbacks.length);
      }
    },
    [callbacks]
  );
  (0, import_react_native35.useVisibilityChange)(handleVisibilityChange);
  return startNavigating;
}

// src/hooks/useTopNavigation.tsx
function useTopNavigation() {
  const { addNavigationRightButton, removeNavigationRightButton } = useNavigationBarContext();
  return {
    addAccessoryButton: addNavigationRightButton,
    removeAccessoryButton: removeNavigationRightButton
  };
}

// src/hooks/useWebViewMemoryDebug.tsx
var import_native_modules21 = require("@apps-in-toss/native-modules");
var import_react_native36 = require("@granite-js/react-native");
var import_tds_react_native14 = require("@toss/tds-react-native");
function useHandleWebViewProcessDidTerminate(webViewRef) {
  const toast = (0, import_tds_react_native14.useToast)();
  return () => {
    webViewDebugLog("AppsInTossWebViewProcessDidTerminate", {});
    toast.open("\uBB38\uC81C\uAC00 \uC0DD\uACA8\uC11C \uBBF8\uB2C8\uC571\uC744 \uB2E4\uC2DC \uC2DC\uC791\uD588\uC5B4\uC694.", {
      type: "bottom",
      lottie: `https://static.toss.im/lotties-common/check-green-spot.json`
    });
    webViewRef.current?.reload();
  };
}
async function webViewMemoryDebugLog(params) {
  webViewDebugLog("AppsInTossWebViewMemoryDebug", params);
}
function webViewDebugLog(logName, params) {
  const global2 = getAppsInTossGlobals();
  const event = {
    log_name: logName,
    log_type: "debug",
    params: {
      ...params,
      app_name: import_react_native36.Granite.appName,
      deployment_id: global2.deploymentId
    }
  };
  if ((0, import_native_modules21.getOperationalEnvironment)() === "toss") {
    import_native_modules21.INTERNAL__module.tossCoreEventLog(event);
  } else {
    console.log("[webViewDebugLog]", event);
  }
}

// src/utils/log.ts
var import_native_modules22 = require("@apps-in-toss/native-modules");
var import_react_native37 = require("@granite-js/react-native");

// src/utils/extractDateFromUUIDv7.ts
var extractDateFromUUIDv7 = (uuid) => {
  const timestampHex = uuid.split("-").join("").slice(0, 12);
  const timestamp = Number.parseInt(timestampHex, 16);
  return new Date(timestamp);
};

// src/utils/log.ts
var getGroupId = (url) => {
  try {
    const urlObject = new URL(url);
    return {
      groupId: urlObject.pathname,
      search: urlObject.search.startsWith("?") ? urlObject.search.substring(1) : urlObject.search
    };
  } catch {
    return {
      groupId: "unknown",
      search: "unknown"
    };
  }
};
var getReferrer2 = () => {
  try {
    const referrer = new URL((0, import_react_native37.getSchemeUri)());
    return referrer.searchParams.get("referrer");
  } catch {
    return "";
  }
};
var trackScreen = (url) => {
  const { groupId, search } = getGroupId(url);
  const log = {
    log_type: "screen",
    log_name: `${groupId}::screen`,
    params: {
      search,
      referrer: getReferrer2(),
      deployment_id: env.getDeploymentId(),
      deployment_timestamp: extractDateFromUUIDv7(env.getDeploymentId()).getTime()
    }
  };
  return (0, import_native_modules22.eventLog)(log);
};

// src/components/WebView.tsx
var import_jsx_runtime18 = require("react/jsx-runtime");
var operationalEnvironment = appsInTossConstantBridges.getOperationalEnvironment();
var TYPES = ["partner", "external", "game"];
var WEBVIEW_TYPES = {
  partner: PartnerWebView,
  external: import_tds_react_native15.ExternalWebViewScreen,
  game: GameWebView
};
function mergeSchemeQueryParamsInto(url) {
  const baseUrl = new URL(url);
  const schemeUrl = new URL((0, import_react_native38.getSchemeUri)());
  baseUrl.pathname = schemeUrl.pathname;
  for (const [key, value] of schemeUrl.searchParams.entries()) {
    baseUrl.searchParams.set(key, value);
  }
  return baseUrl;
}
function getWebViewUri(local) {
  if (__DEV__) {
    const devUrl = `http://${local.host}:${local.port}`;
    return mergeSchemeQueryParamsInto(devUrl).toString();
  }
  const { url: rawUrl } = import_native_modules23.AppsInTossModule.getWebBundleURL({});
  const url = mergeSchemeQueryParamsInto(rawUrl);
  const deploymentId = env.getDeploymentId();
  if (deploymentId) {
    url.searchParams.set("_deploymentId", deploymentId);
  }
  return url.toString();
}
function WebView({ type, local, onMessage, ...props }) {
  if (!TYPES.includes(type)) {
    throw new Error(`Invalid WebView type: '${type}'`);
  }
  const webViewRef = (0, import_react28.useRef)(null);
  const webBackHandler = useWebBackHandler(webViewRef);
  const uri = (0, import_react28.useMemo)(() => getWebViewUri(local), [local]);
  const top = (0, import_private9.useSafeAreaTop)();
  const bottom = (0, import_private9.useSafeAreaBottom)();
  const insets = (0, import_react_native_safe_area_context4.useSafeAreaInsets)();
  const global2 = getAppsInTossGlobals();
  const navigationBarContext = useNavigationBarContext();
  const safeAreaInsetsEmitter = useSafeAreaInsetsEmitter();
  const [allowsBackForwardNavigationGestures, setAllowsBackForwardNavigationGestures] = (0, import_react28.useState)(
    props.allowsBackForwardNavigationGestures
  );
  const handler = useBridgeHandler({
    onMessage,
    eventListenerMap: {
      ...appsInTossEventBridges,
      navigationAccessoryEvent: ({ onEvent, onError }) => import_tds_react_native15.tdsEvent.addEventListener("navigationAccessoryEvent", { onEvent, onError }),
      backEvent: ({ onEvent }) => {
        webBackHandler.addEventListener(onEvent);
        return () => {
          webBackHandler.removeEventListener(onEvent);
        };
      },
      updateLocationEvent: ({ onEvent, onError, options }) => import_native_modules23.appsInTossEvent.addEventListener("updateLocationEvent", { onEvent, onError, options }),
      safeAreaInsetsChange: ({ onEvent }) => {
        safeAreaInsetsEmitter.on("safeAreaInsetsChange", onEvent);
        return () => {
          safeAreaInsetsEmitter.off("safeAreaInsetsChange", onEvent);
        };
      },
      /** @internal */
      appBridgeCallbackEvent: ({ onEvent, onError, options }) => import_native_modules23.appsInTossEvent.addEventListener("appBridgeCallbackEvent", { onEvent, onError, options }),
      /** AdMob */
      loadAdMobInterstitialAd: import_native_modules23.GoogleAdMob.loadAdMobInterstitialAd,
      showAdMobInterstitialAd: import_native_modules23.GoogleAdMob.showAdMobInterstitialAd,
      loadAdMobRewardedAd: import_native_modules23.GoogleAdMob.loadAdMobRewardedAd,
      showAdMobRewardedAd: import_native_modules23.GoogleAdMob.showAdMobRewardedAd,
      /** AdMobV2 */
      loadAppsInTossAdMob: import_native_modules23.GoogleAdMob.loadAppsInTossAdMob,
      showAppsInTossAdMob: import_native_modules23.GoogleAdMob.showAppsInTossAdMob,
      /** IntegratedAd */
      loadFullScreenAd: loadFullScreenAdForWeb,
      showFullScreenAd,
      /** TossAd */
      fetchTossAd,
      /** IAP */
      iapCreateOneTimePurchaseOrder: import_native_modules23.IAP.createOneTimePurchaseOrder,
      requestOneTimePurchase: import_native_modules23.requestOneTimePurchase
    },
    constantHandlerMap: {
      ...appsInTossConstantBridges,
      getSafeAreaTop: () => top,
      getSafeAreaBottom: () => bottom,
      getSafeAreaLeft: () => insets.left,
      getSafeAreaRight: () => insets.right,
      ...Object.fromEntries(Object.entries(global2).map(([key, value]) => [key, () => value])),
      /** AdMob */
      loadAdMobInterstitialAd_isSupported: import_native_modules23.GoogleAdMob.loadAdMobInterstitialAd.isSupported,
      showAdMobInterstitialAd_isSupported: import_native_modules23.GoogleAdMob.showAdMobInterstitialAd.isSupported,
      loadAdMobRewardedAd_isSupported: import_native_modules23.GoogleAdMob.loadAdMobRewardedAd.isSupported,
      showAdMobRewardedAd_isSupported: import_native_modules23.GoogleAdMob.showAdMobRewardedAd.isSupported,
      /** AdMobV2 */
      loadAppsInTossAdMob_isSupported: import_native_modules23.GoogleAdMob.loadAppsInTossAdMob.isSupported,
      showAppsInTossAdMob_isSupported: import_native_modules23.GoogleAdMob.showAppsInTossAdMob.isSupported,
      /** IntegratedAd */
      loadFullScreenAd_isSupported: loadFullScreenAdForWeb.isSupported,
      showFullScreenAd_isSupported: showFullScreenAd.isSupported,
      /** TossAd */
      fetchTossAd_isSupported: fetchTossAd.isSupported,
      /** env */
      getDeploymentId: env.getDeploymentId
    },
    asyncHandlerMap: {
      ...appsInTossAsyncBridges,
      setIosSwipeGestureEnabled: (options) => {
        setAllowsBackForwardNavigationGestures(options.isEnabled);
        return appsInTossAsyncBridges.setIosSwipeGestureEnabled(options);
      },
      addAccessoryButton: async (params) => navigationBarContext.addNavigationRightButton(params),
      removeAccessoryButton: async () => navigationBarContext.removeNavigationRightButton(),
      /** permissions */
      requestPermission: appsInTossAsyncBridges.requestPermission,
      openPermissionDialog: appsInTossAsyncBridges.openPermissionDialog,
      getPermission: appsInTossAsyncBridges.getPermission,
      getClipboardText: appsInTossAsyncBridges.getClipboardText,
      setClipboardText: appsInTossAsyncBridges.setClipboardText,
      fetchAlbumPhotos: appsInTossAsyncBridges.fetchAlbumPhotos,
      fetchContacts: appsInTossAsyncBridges.fetchContacts,
      getCurrentLocation: appsInTossAsyncBridges.getCurrentLocation,
      openCamera: appsInTossAsyncBridges.openCamera,
      /** Storage */
      getStorageItem: import_native_modules23.Storage.getItem,
      setStorageItem: import_native_modules23.Storage.setItem,
      removeStorageItem: import_native_modules23.Storage.removeItem,
      clearItems: import_native_modules23.Storage.clearItems,
      /** IAP */
      iapGetProductItemList: import_native_modules23.IAP.getProductItemList,
      iapCreateOneTimePurchaseOrder: import_native_modules23.iapCreateOneTimePurchaseOrder,
      processProductGrant: import_native_modules23.processProductGrant,
      getPendingOrders: import_native_modules23.IAP.getPendingOrders,
      getCompletedOrRefundedOrders: import_native_modules23.IAP.getCompletedOrRefundedOrders,
      completeProductGrant: import_native_modules23.IAP.completeProductGrant,
      /** Toss Ads */
      tossAdEventLog,
      /** Private */
      memoryDebugLog: webViewMemoryDebugLog
    }
  });
  const headerPropForExternalWebView = (0, import_react28.useMemo)(() => {
    const parsedNavigationBar = global2.navigationBar != null ? safeParseNavigationBar(global2.navigationBar) : null;
    const initialAccessoryButton = parsedNavigationBar?.initialAccessoryButton;
    const withBackButton = parsedNavigationBar?.withBackButton ?? true;
    if (type === "external" && initialAccessoryButton != null) {
      return {
        header: {
          withBackButton,
          title: initialAccessoryButton.title,
          icon: initialAccessoryButton.icon
        }
      };
    }
    return {};
  }, [global2.navigationBar, type]);
  const BaseWebView = WEBVIEW_TYPES[type];
  const webViewDebuggingEnabled = operationalEnvironment === "sandbox";
  const userAgent = useCreateUserAgent({
    colorPreference: "light"
  });
  const refs = mergeRefs(handler.ref, webViewRef);
  (0, import_react28.useEffect)(() => {
    const callback = () => {
      webBackHandler.handleWebBack();
      return true;
    };
    import_react_native39.BackHandler.addEventListener("hardwareBackPress", callback);
    return () => import_react_native39.BackHandler.removeEventListener("hardwareBackPress", callback);
  }, [webBackHandler]);
  const globalScripts = useGlobalScripts();
  const handleWebViewProcessDidTerminate = useHandleWebViewProcessDidTerminate(webViewRef);
  return /* @__PURE__ */ (0, import_jsx_runtime18.jsx)(
    BaseWebView,
    {
      ref: refs,
      ...props,
      ...headerPropForExternalWebView,
      source: {
        uri,
        // NOTE: https://github.com/react-native-webview/react-native-webview/pull/3133
        headers: {
          "User-Agent": userAgent
        }
      },
      onHomeButtonClick: webBackHandler.handleWebHome,
      onBackButtonClick: webBackHandler.handleWebBack,
      onNavigationStateChange: (event) => {
        if (event.url) {
          trackScreen(event.url);
        }
        props.onNavigationStateChange?.(event);
        webBackHandler.onNavigationStateChange(event);
      },
      userAgent: import_react_native39.Platform.OS === "ios" ? userAgent : void 0,
      sharedCookiesEnabled: true,
      webviewDebuggingEnabled: webViewDebuggingEnabled,
      thirdPartyCookiesEnabled: true,
      onMessage: handler.onMessage,
      injectedJavaScript: globalScripts.afterLoad,
      injectedJavaScriptBeforeContentLoaded: mergeScripts(handler.injectedJavaScript, globalScripts.beforeLoad),
      decelerationRate: import_react_native39.Platform.OS === "ios" ? 1 : void 0,
      allowsBackForwardNavigationGestures,
      onShouldStartLoadWithRequest: (event) => {
        try {
          const url = new URL(event.url);
          if (["https:", "http:"].includes(url.protocol)) {
            return true;
          } else {
            import_react_native39.Linking.openURL(convertIntentURL(url) ?? url.href);
            return false;
          }
        } catch (error) {
          console.error(error);
          return false;
        }
      },
      originWhitelist: [
        "https://*",
        "http://*",
        "intoss://*",
        "intoss-private://*",
        "servicetoss://*",
        "supertoss://*",
        "intent://*"
      ],
      onContentProcessDidTerminate: handleWebViewProcessDidTerminate,
      onRenderProcessGone: handleWebViewProcessDidTerminate
    }
  );
}
function useGlobalScripts() {
  const global2 = getAppsInTossGlobals();
  const disableTextSelectionCSS = `
    const style = document.createElement('style');
    style.textContent = '*:not(input):not(textarea) { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; -webkit-touch-callout: none; }';
    document.head.appendChild(style);
  `;
  const applyGameResourcesCache = `
    (function () {
      if (typeof caches === 'undefined') {
        return;
      }
      const cacheKeyPrefix = '@apps-in-toss/caches/';
      const cacheKey = \`\${cacheKeyPrefix}${global2.deploymentId}\`;
      window.addEventListener('load', async () => {
        const keys = await caches.keys();
        for (const key of keys) {
          if (key.startsWith(cacheKeyPrefix) && key !== cacheKey) {
            await caches.delete(key);
          }
        }
      });
      window.fetch = new Proxy(window.fetch, {
        async apply(originalFetch, thisArg, args) {
          const request = new Request(args[0], args[1]);
          if (!/\\.(data|wasm|framework\\.js)(?:\\.gz|\\.br|\\.unityweb)?$/.test(request.url)) {
            return await originalFetch.call(thisArg, request);
          }
          const cache = await caches.open(cacheKey);
          const cached = await cache.match(request);
          if (cached) {
            const eTag = cached.headers.get('ETag');
            const lastModified = cached.headers.get('Last-Modified');
            if (eTag) {
              request.headers.set('If-None-Match', eTag);
            }
            if (lastModified) {
              request.headers.set('If-Modified-Since', lastModified);
            }
            const revalidated = await originalFetch.call(thisArg, request);
            if (revalidated.status === 304) {
              return cached;
            }
            cache.put(request, revalidated.clone());
            return revalidated;
          }
          const response = await originalFetch.call(thisArg, request);
          cache.put(request, response.clone());
          return response;
        },
      });
    })();
  `;
  return {
    beforeLoad: mergeScripts(global2.webViewType === "game" && applyGameResourcesCache),
    afterLoad: mergeScripts(disableTextSelectionCSS)
  };
}
function mergeScripts(...scripts) {
  return scripts.filter((script) => typeof script === "string").join("\n");
}

// src/index.ts
__reExport(src_exports, require("@apps-in-toss/analytics"), module.exports);
var import_private10 = require("@toss/tds-react-native/private");
__reExport(src_exports, require("@apps-in-toss/native-modules"), module.exports);
__reExport(src_exports, require("@apps-in-toss/types"), module.exports);
var Analytics2 = {
  init: import_analytics2.Analytics.init,
  Impression: import_analytics2.Analytics.Impression,
  Press: import_analytics2.Analytics.Press,
  Area: import_analytics2.Analytics.Area
};
// Annotate the CommonJS export names for ESM import in node:
0 && (module.exports = {
  Analytics,
  AppsInToss,
  INTERNAL__onVisibilityChangedByTransparentServiceWeb,
  OverlayProvider,
  WebView,
  env,
  loadFullScreenAd,
  showFullScreenAd,
  useCreateUserAgent,
  useGeolocation,
  useOverlay,
  useTopNavigation,
  useWaitForReturnNavigator,
  ...require("@apps-in-toss/analytics"),
  ...require("@apps-in-toss/native-modules"),
  ...require("@apps-in-toss/types")
});
