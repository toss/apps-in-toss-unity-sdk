var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __reExport = (target, mod, secondTarget) => (__copyProps(target, mod, "default"), secondTarget && __copyProps(secondTarget, mod, "default"));

// src/index.ts
import { Analytics as InternalAnalytics } from "@apps-in-toss/analytics";

// src/core/registerApp.tsx
import { Analytics } from "@apps-in-toss/analytics";
import { isMinVersionSupported as isMinVersionSupported3, setIosSwipeGestureEnabled as setIosSwipeGestureEnabled2, eventLog } from "@apps-in-toss/native-modules";
import { Granite as Granite7 } from "@granite-js/react-native";
import { TDSProvider } from "@toss/tds-react-native";
import { AppRegistry } from "react-native";

// src/core/components/AppEvent.tsx
import { INTERNAL__module as INTERNAL__module2 } from "@apps-in-toss/native-modules";
import { Granite as Granite2, getSchemeUri as getSchemeUri3, useVisibility as useVisibility2 } from "@granite-js/react-native";
import { useEffect as useEffect2 } from "react";

// src/env.ts
var env = {
  getDeploymentId: () => __DEV__ ? "local" : global.__appsInToss?.deploymentId
};

// src/hooks/useCaptureExitLog.ts
import { INTERNAL__module } from "@apps-in-toss/native-modules";
import { Granite, useVisibility } from "@granite-js/react-native";
import { useCallback, useEffect, useRef } from "react";

// src/core/hooks/useReferrer.ts
import { getSchemeUri } from "@granite-js/react-native";
import { useMemo } from "react";
function useReferrer() {
  return useMemo(() => {
    try {
      return new URL(getSchemeUri()).searchParams.get("referrer");
    } catch {
      return null;
    }
  }, []);
}

// src/utils/isPrivateScheme.ts
import { getSchemeUri as getSchemeUri2 } from "@granite-js/react-native";
function isPrivateScheme() {
  try {
    return new URL(getSchemeUri2()).protocol === "intoss-private:";
  } catch {
    return false;
  }
}

// src/hooks/useCaptureExitLog.ts
var EXIT_IMPRESSION_LOG_NAME = "appsintoss_app_visit__common_module::impression__stay_time";
var EXIT_IMPRESSION_SCHEMA_ID = 1631628;
function useCaptureExitLog() {
  const referrer = useReferrer();
  const visible = useVisibility();
  const enterTime = useRef(void 0);
  useEffect(() => {
    if (visible === true) {
      enterTime.current = Date.now();
    }
  }, [visible]);
  const captureExitLog = useCallback(
    (exitTime) => {
      if (enterTime.current == null) {
        return;
      }
      const stayTime = Math.floor(exitTime - enterTime.current);
      INTERNAL__module.tossCoreEventLog({
        log_name: EXIT_IMPRESSION_LOG_NAME,
        log_type: "event",
        params: {
          schema_id: EXIT_IMPRESSION_SCHEMA_ID,
          event_type: "impression",
          referrer,
          deployment_id: env.getDeploymentId(),
          app_name: Granite.appName,
          is_private: isPrivateScheme(),
          stay_time: stayTime.toString(),
          exit_time: exitTime.toString()
        }
      });
      enterTime.current = void 0;
    },
    [referrer]
  );
  return { captureExitLog };
}

// src/core/components/AppEvent.tsx
var ENTRY_APP_EVENT_SCHEMA_ID = 1562181;
function EntryAppEvent() {
  const referrer = useReferrer() ?? "";
  useEffect2(() => {
    INTERNAL__module2.tossCoreEventLog({
      log_name: "appsintoss_app_visit::impression__enter_appsintoss",
      log_type: "info",
      params: {
        is_transform: true,
        schema_id: ENTRY_APP_EVENT_SCHEMA_ID,
        referrer,
        deployment_id: env.getDeploymentId(),
        app_name: Granite2.appName,
        is_private: isPrivateScheme()
      }
    });
  }, [referrer]);
  return null;
}
function SystemAppEvent({ ...initialProps }) {
  useEffect2(() => {
    INTERNAL__module2.tossCoreEventLog({
      log_name: "AppsInTossInitialProps",
      log_type: "debug",
      params: {
        ...initialProps,
        schemeUri: getSchemeUri3(),
        deployment_id: env.getDeploymentId(),
        app_name: Granite2.appName,
        is_private: isPrivateScheme()
      }
    });
  }, [initialProps]);
  return null;
}
function StayTimeAppEvent() {
  const visible = useVisibility2();
  const { captureExitLog } = useCaptureExitLog();
  useEffect2(() => {
    if (visible === false) {
      captureExitLog(Date.now());
    }
  }, [visible, captureExitLog]);
  return null;
}
var AppEvent = {
  Entry: EntryAppEvent,
  System: SystemAppEvent,
  StayTime: StayTimeAppEvent
};

// src/core/components/AppUpdate.tsx
import { openURL } from "@granite-js/react-native";
import { useEffect as useEffect3 } from "react";
import { Fragment, jsx } from "react/jsx-runtime";
var UPDATE_SCHEME = "servicetoss://update/forced/j?updateType=required";
function AppUpdate() {
  useEffect3(() => {
    openURL(`supertoss://closePage?url=${UPDATE_SCHEME}`);
  }, []);
  return /* @__PURE__ */ jsx(Fragment, {});
}

// src/core/context/NavigationBarContext.tsx
import { createContext, useContext, useState } from "react";

// src/core/utils/getAppsInTossGlobals.ts
function getAppsInTossGlobals() {
  if (global.__appsInToss == null) {
    throw new Error("invalid apps-in-toss globals");
  }
  return global.__appsInToss;
}

// src/core/utils/safeParseNavigationBar.ts
function safeParseNavigationBar(navigationBar) {
  if (typeof navigationBar === "object") {
    return navigationBar;
  }
  try {
    return JSON.parse(navigationBar);
  } catch {
    return null;
  }
}

// src/core/context/NavigationBarContext.tsx
import { jsx as jsx2 } from "react/jsx-runtime";
var NavigationBarContext = createContext(null);
function NavigationBarContextProvider({ children }) {
  const globals = getAppsInTossGlobals();
  const parsedNavigationBar = globals.navigationBar != null ? safeParseNavigationBar(globals.navigationBar) : null;
  const [navigationRightButton, setNavigationRightButton] = useState(
    parsedNavigationBar?.initialAccessoryButton
  );
  const addNavigationRightButton = (button) => {
    setNavigationRightButton(button);
  };
  const removeNavigationRightButton = () => {
    setNavigationRightButton(void 0);
  };
  return /* @__PURE__ */ jsx2(
    NavigationBarContext.Provider,
    {
      value: { navigationRightButton, addNavigationRightButton, removeNavigationRightButton },
      children
    }
  );
}
function useNavigationBarContext() {
  const context = useContext(NavigationBarContext);
  if (context == null) {
    throw Error("useNavigationBarContext must be used within NavigationBarContextProvider");
  }
  return context;
}

// src/components/RNAppContainer.tsx
import { setIosSwipeGestureEnabled } from "@apps-in-toss/native-modules";
import { useEffect as useEffect8 } from "react";
import { Platform as Platform3 } from "react-native";

// src/components/GameInitializer.tsx
import { isMinVersionSupported } from "@apps-in-toss/native-modules";
import { closeView as closeView2 } from "@granite-js/react-native";
import { Loader } from "@toss/tds-react-native";
import { josa } from "es-hangul";
import { useEffect as useEffect4, useRef as useRef2 } from "react";
import { Pressable, View } from "react-native";

// src/constant/game-center.ts
var GAME_PROFILE_WEBVIEW_URL = "servicetoss://game-center/profile";
var GAME_MIN_VERSION = {
  android: "5.232.0",
  ios: "5.232.0"
};

// src/hooks/useAppUpdateDialog.tsx
import { INTERNAL__module as INTERNAL__module3 } from "@apps-in-toss/native-modules";
import { Granite as Granite3, openURL as openURL2 } from "@granite-js/react-native";
import { useDialog } from "@toss/tds-react-native";
import { useCallback as useCallback2 } from "react";

// src/utils/market.ts
import { Platform } from "react-native";
var PLAYSTORE_LINK = "https://play.google.com/store/apps/details?id=viva.republica.toss";
var APPSTORE_LINK = "https://itunes.apple.com/app/id839333328";
var getMarketLink = () => {
  return Platform.OS === "android" ? PLAYSTORE_LINK : APPSTORE_LINK;
};

// src/hooks/useAppUpdateDialog.tsx
function useAppUpdateDialog() {
  const { openConfirm } = useDialog();
  const logging = useAppUpdateDialogLogging();
  const openAppUpdateDialog = useCallback2(
    async ({
      title,
      description,
      leftButton = "\uB2EB\uAE30",
      rightButton = "\uC5C5\uB370\uC774\uD2B8\uD558\uAE30",
      onDismiss
    }) => {
      logging.show();
      const isConfirmed = await openConfirm({
        title,
        description,
        leftButton,
        rightButton,
        closeOnDimmerClick: true
      });
      if (!isConfirmed) {
        logging.close();
        onDismiss?.();
        return;
      }
      logging.update();
      const STORE_SCHEME = getMarketLink();
      openURL2(`supertoss://web?url=${STORE_SCHEME}&external=browser`);
    },
    [logging, openConfirm]
  );
  return {
    open: openAppUpdateDialog
  };
}
var UPDATE_DIALOG_SCHEMA_ID = 1634992;
var UPDATE_DIALOG_LOG_NAME = "appsintoss_app_visit__common_module::bottomsheet__app_update";
var UPDATE_DIALOG_CTA_CLICK_SCHEMA_ID = 1634996;
var UPDATE_DIALOG_CTA_CLICK_LOG_NAME = "appsintoss_app_visit__common_module::bottomsheet__app_update::click__cta";
function useAppUpdateDialogLogging() {
  const referrer = useReferrer();
  const baseParams = {
    referrer,
    app_name: Granite3.appName
  };
  const logUpdateClick = () => {
    INTERNAL__module3.tossCoreEventLog({
      log_name: UPDATE_DIALOG_CTA_CLICK_LOG_NAME,
      log_type: "event",
      params: {
        ...baseParams,
        schema_id: UPDATE_DIALOG_CTA_CLICK_SCHEMA_ID,
        event_type: "click",
        button_type: "update"
      }
    });
  };
  const logCloseClick = () => {
    INTERNAL__module3.tossCoreEventLog({
      log_name: UPDATE_DIALOG_CTA_CLICK_LOG_NAME,
      log_type: "event",
      params: {
        ...baseParams,
        schema_id: UPDATE_DIALOG_CTA_CLICK_SCHEMA_ID,
        event_type: "click",
        button_type: "close"
      }
    });
  };
  const logDialogShow = () => {
    INTERNAL__module3.tossCoreEventLog({
      log_name: UPDATE_DIALOG_LOG_NAME,
      log_type: "popup",
      params: {
        ...baseParams,
        schema_id: UPDATE_DIALOG_SCHEMA_ID
      }
    });
  };
  return { update: logUpdateClick, close: logCloseClick, show: logDialogShow };
}

// src/hooks/useGameCenterProfile.ts
import { getGameCenterGameProfile } from "@apps-in-toss/native-modules";
import { useCallback as useCallback6, useState as useState3 } from "react";

// src/hooks/useErrorAlert.ts
import { closeView } from "@granite-js/react-native";
import { useDialog as useDialog2 } from "@toss/tds-react-native";
import { useCallback as useCallback3 } from "react";

// src/utils/error.ts
var DEFAULT_ERROR = {
  title: "\uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694",
  description: "\uBB38\uC81C\uAC00 \uACC4\uC18D\uB418\uBA74 \uD1A0\uC2A4 \uACE0\uAC1D\uC13C\uD130(1599-4905)\uB85C \uBB38\uC758\uD574\uC8FC\uC138\uC694."
};

// src/hooks/useErrorAlert.ts
var useErrorAlert = () => {
  const { openAlert } = useDialog2();
  const openErrorAlert = useCallback3(async () => {
    await openAlert({
      title: DEFAULT_ERROR.title,
      description: DEFAULT_ERROR.description
    });
    closeView();
  }, [openAlert]);
  return { open: openErrorAlert };
};

// src/hooks/useTransparentWebview.tsx
import { useCallback as useCallback4, useState as useState2 } from "react";

// src/utils/openTransparentWebView.ts
import { openURL as openURL3 } from "@granite-js/react-native";

// src/private.ts
import { onVisibilityChangedByTransparentServiceWeb } from "@apps-in-toss/native-modules";
var INTERNAL__onVisibilityChangedByTransparentServiceWeb = onVisibilityChangedByTransparentServiceWeb;

// src/utils/openTransparentWebView.ts
var openTransparentWebView = ({
  webUrl,
  cleanupWhenDismissed = true,
  onEvent,
  onError,
  callbackId = "fn",
  params
}) => {
  const url = new URL("supertoss://transparent-service-web");
  url.searchParams.set("url", webUrl);
  url.searchParams.set("onVisibilityChangeCallback", callbackId);
  Object.entries(params ?? {}).forEach(([key, value]) => {
    url.searchParams.set(key, value);
  });
  const cleanup = INTERNAL__onVisibilityChangedByTransparentServiceWeb({
    options: { callbackId },
    onError: (error) => {
      onError(error);
      cleanup();
    },
    onEvent: (value) => {
      onEvent(value);
      if (cleanupWhenDismissed && value === true) {
        cleanup();
      }
    }
  });
  openURL3(url.toString());
};

// src/hooks/useTransparentWebview.tsx
var useTransparentWebview = () => {
  const [isWebviewLoading, setIsWebviewLoading] = useState2(false);
  const { open: openErrorAlert } = useErrorAlert();
  const _openTransparentWebview = useCallback4(
    ({ webUrl, onClose, onError }) => {
      if (isWebviewLoading) {
        return;
      }
      setIsWebviewLoading(true);
      openTransparentWebView({
        webUrl,
        onEvent: async (isClosedTransparentWebView) => {
          if (isClosedTransparentWebView) {
            setIsWebviewLoading(false);
            onClose?.();
          }
        },
        onError: (error) => {
          setIsWebviewLoading(false);
          if (onError) {
            onError(error);
          } else {
            openErrorAlert();
          }
        }
      });
    },
    [isWebviewLoading, openErrorAlert]
  );
  return {
    open: _openTransparentWebview
  };
};

// src/components/GameProfileToast.tsx
import { Asset, Toast } from "@toss/tds-react-native";
import { AdaptiveColorProvider, ColorPreferenceProvider, useOverlay } from "@toss/tds-react-native/private";
import { useCallback as useCallback5 } from "react";
import { jsx as jsx3 } from "react/jsx-runtime";
var useGameProfileToast = () => {
  const overlay = useOverlay();
  const openGameProfileToast = useCallback5(
    (nickname, profileImageUri) => {
      return new Promise((resolve) => {
        overlay.open(({ isOpen, close, exit }) => {
          return /* @__PURE__ */ jsx3(ColorPreferenceProvider, { colorPreference: "dark", children: /* @__PURE__ */ jsx3(AdaptiveColorProvider, { children: /* @__PURE__ */ jsx3(
            Toast,
            {
              open: isOpen,
              onClose: () => {
                resolve();
                close();
              },
              onExited: exit,
              position: "top",
              text: `${nickname}\uB2D8 \uBC18\uAC00\uC6CC\uC694!`,
              icon: /* @__PURE__ */ jsx3(
                Asset.Image,
                {
                  style: { borderRadius: 64, overflow: "hidden" },
                  frameShape: Asset.frameShape.CleanW32,
                  source: { uri: profileImageUri }
                }
              )
            }
          ) }) });
        });
      });
    },
    [overlay]
  );
  return { openGameProfileToast };
};

// src/hooks/useGameCenterProfile.ts
var useGameCenterProfile = () => {
  const [profileData, setProfileData] = useState3(void 0);
  const [isProfileDataLoading, setIsProfileDataLoading] = useState3(true);
  const [isProfileDataRefetching, setIsProfileDataRefetching] = useState3(false);
  const shouldShowProfileLoadingOverlay = isProfileDataLoading || isProfileDataRefetching;
  const shouldShowProfileNotFoundOverlay = profileData?.statusCode === "PROFILE_NOT_FOUND" && !isProfileDataRefetching;
  const canShowBottomSheetOrToast = !isProfileDataLoading;
  const { openGameProfileToast } = useGameProfileToast();
  const { open: openErrorAlert } = useErrorAlert();
  const { open: openTransparentWebView2 } = useTransparentWebview();
  const fetchProfileData = useCallback6(async () => {
    try {
      const data = await getGameCenterGameProfile();
      setProfileData(data);
      setIsProfileDataLoading(false);
    } catch (_) {
      openErrorAlert();
      setIsProfileDataLoading(false);
    }
  }, [openErrorAlert]);
  const refetchProfileData = useCallback6(async () => {
    try {
      setIsProfileDataRefetching(true);
      const data = await getGameCenterGameProfile();
      setProfileData(data);
      setIsProfileDataRefetching(false);
      if (data?.statusCode === "SUCCESS") {
        openGameProfileToast(data.nickname, data.profileImageUri);
      }
    } catch (_) {
      setIsProfileDataRefetching(false);
      openErrorAlert();
    }
  }, [openErrorAlert, openGameProfileToast]);
  const openProfileWebview = useCallback6(() => {
    openTransparentWebView2({
      webUrl: `${GAME_PROFILE_WEBVIEW_URL}?appName=${getAppName()}&referrer=appsintoss.${getAppName()}`,
      onClose: async () => {
        refetchProfileData();
      }
    });
  }, [openTransparentWebView2, refetchProfileData]);
  return {
    profileData,
    isProfileDataLoading,
    shouldShowProfileLoadingOverlay,
    shouldShowProfileNotFoundOverlay,
    canShowBottomSheetOrToast,
    setIsProfileDataLoading,
    openProfileWebview,
    setProfileData,
    openErrorAlert,
    openGameProfileToast,
    fetchProfileData
  };
};

// src/utils/zIndex.ts
var Z_INDEX = {
  /* 게임 프로필을 위한 overlay
   */
  PROFILE_OVERLAY: 9998,
  // 게임을 종료할 수 있는 X 버튼
  CLOSE_BUTTON: 9999
};

// src/components/GameInitializer.tsx
import { Fragment as Fragment2, jsx as jsx4, jsxs } from "react/jsx-runtime";
var GameInitializer = ({ children }) => {
  const {
    profileData,
    shouldShowProfileLoadingOverlay,
    shouldShowProfileNotFoundOverlay,
    canShowBottomSheetOrToast,
    openProfileWebview,
    openGameProfileToast,
    fetchProfileData
  } = useGameCenterProfile();
  const isCompletedFlow = useRef2(false);
  const { open: openAppUpdateDialog } = useAppUpdateDialog();
  useEffect4(() => {
    fetchProfileData();
  }, []);
  useEffect4(() => {
    const handleGameProfileFlow = async () => {
      if (!canShowBottomSheetOrToast) {
        return;
      }
      if (isCompletedFlow.current) {
        return;
      }
      isCompletedFlow.current = true;
      if (!isMinVersionSupported(GAME_MIN_VERSION)) {
        openAppUpdateDialog({
          title: `${josa(getAppsInTossGlobals().brandDisplayName, "\uC744/\uB97C")} \uD558\uB824\uBA74 
\uC571\uC744 \uC5C5\uB370\uC774\uD2B8\uD574\uC8FC\uC138\uC694`,
          onDismiss: () => {
            closeView2();
          }
        });
        return;
      }
      if (profileData?.statusCode === "SUCCESS") {
        openGameProfileToast(profileData.nickname, profileData.profileImageUri);
        return;
      }
      if (profileData?.statusCode === "PROFILE_NOT_FOUND") {
        openProfileWebview();
      }
    };
    handleGameProfileFlow();
  }, [
    canShowBottomSheetOrToast,
    isCompletedFlow,
    openAppUpdateDialog,
    openGameProfileToast,
    openProfileWebview,
    profileData
  ]);
  if (!isMinVersionSupported(GAME_MIN_VERSION)) {
    return /* @__PURE__ */ jsxs(Fragment2, { children: [
      /* @__PURE__ */ jsx4(View, { style: { flex: 1, position: "relative" }, children }),
      /* @__PURE__ */ jsx4(
        Pressable,
        {
          style: {
            ...overlayStyle
          },
          onPress: () => {
            openAppUpdateDialog({
              title: `${josa(getAppsInTossGlobals().brandDisplayName, "\uC744/\uB97C")} \uD558\uB824\uBA74 
\uC571\uC744 \uC5C5\uB370\uC774\uD2B8\uD574\uC8FC\uC138\uC694`,
              onDismiss: () => {
                closeView2();
              }
            });
          }
        }
      )
    ] });
  }
  if (shouldShowProfileLoadingOverlay) {
    return /* @__PURE__ */ jsxs(Fragment2, { children: [
      /* @__PURE__ */ jsx4(View, { style: { flex: 1, position: "relative" }, children }),
      /* @__PURE__ */ jsx4(
        View,
        {
          style: {
            ...overlayStyle,
            justifyContent: "center",
            alignItems: "center",
            backgroundColor: "rgba(0, 0, 0, 0.2)"
          },
          children: /* @__PURE__ */ jsx4(Loader, { size: "large", type: "light" })
        }
      )
    ] });
  }
  if (shouldShowProfileNotFoundOverlay) {
    return /* @__PURE__ */ jsxs(Fragment2, { children: [
      /* @__PURE__ */ jsx4(View, { style: { flex: 1, position: "relative" }, children }),
      shouldShowProfileNotFoundOverlay && /* @__PURE__ */ jsx4(
        Pressable,
        {
          style: {
            ...overlayStyle
          },
          onPress: () => {
            openProfileWebview();
          }
        }
      )
    ] });
  }
  return /* @__PURE__ */ jsx4(Fragment2, { children: /* @__PURE__ */ jsx4(View, { style: { flex: 1, position: "relative" }, children }) });
};
var overlayStyle = {
  position: "absolute",
  top: 0,
  left: 0,
  right: 0,
  bottom: 0,
  zIndex: Z_INDEX.PROFILE_OVERLAY
};

// src/components/NavigationBar/RNNavigationBar/Default.tsx
import { NavigationBackButton, NavigationLeft, TopNavigation } from "@toss/tds-react-native/private";

// src/components/NavigationBar/RNNavigationBar/hooks/useHardwareBackPress.ts
import { useEffect as useEffect5 } from "react";
import { BackHandler } from "react-native";
function useHardwareBackPress(handler) {
  useEffect5(() => {
    const handleBackPress = () => {
      handler();
      return true;
    };
    BackHandler.addEventListener("hardwareBackPress", handleBackPress);
    return () => BackHandler.removeEventListener("hardwareBackPress", handleBackPress);
  }, [handler]);
}

// src/components/NavigationBar/RNNavigationBar/hooks/useNavigationEvent.ts
import { closeView as closeView3, useBackEventContext, useNavigation } from "@granite-js/react-native";
import { useMemo as useMemo2 } from "react";

// src/components/NavigationBar/RNNavigationBar/hooks/useCloseConfirm.ts
import { useDialog as useDialog3 } from "@toss/tds-react-native";
import { josa as josa2 } from "es-hangul";
import { useCallback as useCallback7 } from "react";
function useCloseConfirm() {
  const { brandDisplayName } = getAppsInTossGlobals();
  const { openConfirm } = useDialog3();
  return useCallback7(
    async ({ onEntered }) => {
      return await openConfirm({
        title: `${josa2(brandDisplayName, "\uC744/\uB97C")} \uC885\uB8CC\uD560\uAE4C\uC694?`,
        leftButton: "\uCDE8\uC18C",
        rightButton: "\uC885\uB8CC\uD558\uAE30",
        closeOnDimmerClick: true,
        onEntered
      });
    },
    [brandDisplayName, openConfirm]
  );
}

// src/components/NavigationBar/common/useNavigationBarLogging.tsx
import { INTERNAL__module as INTERNAL__module4 } from "@apps-in-toss/native-modules";
import { Granite as Granite4 } from "@granite-js/react-native";
var NAVI_BAR_IMPRESSION_SCHEMA_ID = 1596837;
var NAVI_BAR_IMPRESSION_LOG_NAME = "appsintoss_app_visit__common_module::impression__navigation_bar";
var CLOSE_POPUP_SHOW_SCHEMA_ID = 1644490;
var CLOSE_POPUP_SHOW_LOG_NAME = "appsintoss_app_visit__common_module::popup__close_app";
var CLOSE_BUTTON_CLICK_SCHEMA_ID = 1596831;
var CLOSE_BUTTON_CLICK_LOG_NAME = "appsintoss_app_visit__common_module::click__icon_close";
var CLOSE_POPUP_CTA_CLICK_SCHEMA_ID = 1644492;
var CLOSE_POPUP_CTA_CLICK_LOG_NAME = "appsintoss_app_visit__common_module::popup__close_app::click__cta";
var HOME_BUTTON_CLICK_SCHEMA_ID = 1596839;
var HOME_BUTTON_CLICK_LOG_NAME = "appsintoss_app_visit__common_module::click__icon_home";
function useNavigationBarLogging() {
  const referrer = useReferrer();
  const baseParams = {
    referrer,
    app_name: Granite4.appName
  };
  const logNavBarImpression = (naviBarConfig) => {
    INTERNAL__module4.tossCoreEventLog({
      log_name: NAVI_BAR_IMPRESSION_LOG_NAME,
      log_type: "event",
      params: {
        ...naviBarConfig,
        ...baseParams,
        event_type: "impression",
        schema_id: NAVI_BAR_IMPRESSION_SCHEMA_ID
      }
    });
  };
  const logHomeButtonClick = () => {
    INTERNAL__module4.tossCoreEventLog({
      log_name: HOME_BUTTON_CLICK_LOG_NAME,
      log_type: "event",
      params: {
        ...baseParams,
        event_type: "click",
        schema_id: HOME_BUTTON_CLICK_SCHEMA_ID
      }
    });
  };
  const logCloseButtonClick = () => {
    INTERNAL__module4.tossCoreEventLog({
      log_name: CLOSE_BUTTON_CLICK_LOG_NAME,
      log_type: "event",
      params: {
        ...baseParams,
        event_type: "click",
        schema_id: CLOSE_BUTTON_CLICK_SCHEMA_ID
      }
    });
  };
  const logClosePopupShow = () => {
    INTERNAL__module4.tossCoreEventLog({
      log_name: CLOSE_POPUP_SHOW_LOG_NAME,
      log_type: "popup",
      params: {
        ...baseParams,
        schema_id: CLOSE_POPUP_SHOW_SCHEMA_ID
      }
    });
  };
  const logClosePopupCtaClick = (confirm) => {
    INTERNAL__module4.tossCoreEventLog({
      log_name: CLOSE_POPUP_CTA_CLICK_LOG_NAME,
      log_type: "event",
      params: {
        ...baseParams,
        close_yn: confirm ? "Y" : "N",
        schema_id: CLOSE_POPUP_CTA_CLICK_SCHEMA_ID,
        event_type: "click"
      }
    });
  };
  return {
    navBarImpression: logNavBarImpression,
    closePopupShow: logClosePopupShow,
    closePopupCtaClick: logClosePopupCtaClick,
    closeButtonClick: logCloseButtonClick,
    homeButtonClick: logHomeButtonClick
  };
}

// src/components/NavigationBar/RNNavigationBar/hooks/useNavigationEvent.ts
function useNavigationEvent() {
  const backEventContext = useBackEventContext();
  const logging = useNavigationBarLogging();
  const navigation = useNavigation();
  const closeConfirm = useCloseConfirm();
  const { captureExitLog } = useCaptureExitLog();
  return useMemo2(() => {
    const close = async () => {
      const hasConfirmed = await closeConfirm({
        onEntered: logging.closePopupShow
      });
      logging.closePopupCtaClick(hasConfirmed);
      if (hasConfirmed) {
        captureExitLog(Date.now());
        closeView3();
      }
    };
    return {
      handleBack: () => {
        if (backEventContext.hasBackEvent) {
          backEventContext.onBack();
        } else if (navigation.canGoBack()) {
          navigation.goBack();
        } else {
          close();
        }
      },
      handleHomeButtonClick: () => {
        logging.homeButtonClick();
        navigation.navigate("/");
      },
      handleCloseButtonClick: () => {
        logging.closeButtonClick();
        close();
      }
    };
  }, [backEventContext, navigation, closeConfirm, logging, captureExitLog]);
}

// src/core/hooks/useMoreButtonBottomSheet/index.tsx
import { INTERNAL__appBridgeHandler, isMinVersionSupported as isMinVersionSupported2 } from "@apps-in-toss/native-modules";
import { openURL as openURL5 } from "@granite-js/react-native";
import { BottomSheet, List, ListHeader } from "@toss/tds-react-native";
import { useAdaptive as useAdaptive2, useOverlay as useOverlay2 } from "@toss/tds-react-native/private";
import { useEffect as useEffect6, useState as useState4 } from "react";

// src/core/hooks/useMoreButtonBottomSheet/AppShareListMenu.tsx
import { getOperationalEnvironment } from "@apps-in-toss/native-modules";
import { getSchemeUri as getSchemeUri4 } from "@granite-js/react-native";
import { useDialog as useDialog4 } from "@toss/tds-react-native";
import { NativeModules } from "react-native";

// src/core/hooks/useMoreButtonBottomSheet/Menu.tsx
import { ListRow, Asset as Asset2 } from "@toss/tds-react-native";
import { useAdaptive } from "@toss/tds-react-native/private";
import { View as View2 } from "react-native";

// src/core/hooks/useMoreButtonBottomSheet/useMoreButtonBottomSheetLogging.tsx
import { INTERNAL__module as INTERNAL__module5 } from "@apps-in-toss/native-modules";
import { Granite as Granite5 } from "@granite-js/react-native";
var BOTTOM_SHEET_SCHEMA_ID = 1596825;
var BOTTOM_SHEET_LOG_NAME = "appsintoss_app_visit__common_module::bottomsheet__more";
var BOTTOM_SHEET_OPEN_SCHEMA_ID = 1596829;
var BOTTOM_SHEET_OPEN_LOG_NAME = "appsintoss_app_visit__common_module::click__icon_more";
var BOTTOM_SHEET_CLOSE_CLICK_SCHEMA_ID = 1596843;
var BOTTOM_SHEET_CLOSE_CLICK_LOG_NAME = "appsintoss_app_visit__common_module::bottomsheet__more::click__close";
var BOTTOM_SHEET_MENU_CLICK_SCHEMA_ID = 1596841;
var BOTTOM_SHEET_MENU_CLICK_LOG_NAME = "appsintoss_app_visit__common_module::bottomsheet__more::click__menu";
function useMoreButtonBottomSheetLogging() {
  const referrer = useReferrer();
  const baseParams = {
    referrer,
    app_name: Granite5.appName
  };
  const logBottomSheetShow = () => {
    INTERNAL__module5.tossCoreEventLog({
      log_name: BOTTOM_SHEET_LOG_NAME,
      log_type: "popup",
      params: {
        ...baseParams,
        schema_id: BOTTOM_SHEET_SCHEMA_ID
      }
    });
  };
  const logBottomSheetOpen = () => {
    INTERNAL__module5.tossCoreEventLog({
      log_name: BOTTOM_SHEET_OPEN_LOG_NAME,
      log_type: "event",
      params: {
        ...baseParams,
        schema_id: BOTTOM_SHEET_OPEN_SCHEMA_ID,
        event_type: "click"
      }
    });
  };
  const logBottomSheetCloseClick = () => {
    INTERNAL__module5.tossCoreEventLog({
      log_name: BOTTOM_SHEET_CLOSE_CLICK_LOG_NAME,
      log_type: "event",
      params: {
        ...baseParams,
        schema_id: BOTTOM_SHEET_CLOSE_CLICK_SCHEMA_ID,
        event_type: "click"
      }
    });
  };
  const logBottomSheetMenuClick = ({ title }) => {
    INTERNAL__module5.tossCoreEventLog({
      log_name: BOTTOM_SHEET_MENU_CLICK_LOG_NAME,
      log_type: "event",
      params: {
        ...baseParams,
        schema_id: BOTTOM_SHEET_MENU_CLICK_SCHEMA_ID,
        event_type: "click",
        item_title: title
      }
    });
  };
  return {
    show: logBottomSheetShow,
    open: logBottomSheetOpen,
    close: logBottomSheetCloseClick,
    menuClick: logBottomSheetMenuClick
  };
}

// src/core/hooks/useMoreButtonBottomSheet/Menu.tsx
import { jsx as jsx5 } from "react/jsx-runtime";
function Menu({ title, iconURL, onPress }) {
  const globals = getAppsInTossGlobals();
  const adaptive = useAdaptive();
  const iconName = getIconName(iconURL);
  const logging = useMoreButtonBottomSheetLogging();
  const brandPrimaryColorRGB = hexToRGB(globals.brandPrimaryColor);
  const iconBackgroundColor = brandPrimaryColorRGB ? `rgba(${brandPrimaryColorRGB.join(",")},0.1)` : adaptive.grey100;
  return /* @__PURE__ */ jsx5(
    ListRow,
    {
      left: /* @__PURE__ */ jsx5(
        View2,
        {
          style: {
            width: 30,
            height: 30,
            borderRadius: 10,
            flexDirection: "row",
            alignItems: "center",
            justifyContent: "center",
            marginRight: 16,
            backgroundColor: iconBackgroundColor
          },
          children: iconName ? /* @__PURE__ */ jsx5(Asset2.Icon, { frameShape: { width: 20, height: 20 }, color: globals.brandPrimaryColor, name: iconName }) : /* @__PURE__ */ jsx5(Asset2.Image, { frameShape: { width: 20, height: 20 }, source: { uri: iconURL } })
        }
      ),
      contents: /* @__PURE__ */ jsx5(ListRow.Texts, { type: "1RowTypeA", top: title, topProps: { color: adaptive.grey700 } }),
      verticalPadding: "extraSmall",
      onPress: () => {
        logging.menuClick({ title });
        onPress?.();
      }
    }
  );
}
var iconNameRegExp = /^(icon-|icn-(?!(car|sec|bank-(fill|square|horizontal))-))(.+)/i;
var iconURLRegExp = /^https:\/\/static\.toss\.im\/icons\/(png\/\dx|svg|pdf)\/((icon-|icn-(?!(car|sec|bank-(fill|square|horizontal))-))(.+))\.(png|svg|pdf)$/i;
function isIconUrl(url) {
  return iconNameRegExp.test(url) || iconURLRegExp.test(url);
}
function getIconName(url) {
  if (!isIconUrl(url)) {
    return null;
  }
  if (iconNameRegExp.test(url)) {
    return url;
  }
  return url.match(iconURLRegExp)?.[2];
}
function hexToRGB(hex) {
  const rgb = hex.toLowerCase().match(/[0-9,a-f]{2}/g)?.map((str) => parseInt(str, 16));
  return rgb?.length === 3 ? rgb : void 0;
}

// src/core/utils/url.ts
function addParamsToUrl(url, params) {
  const urlObj = new URL(url);
  for (const [key, value] of Object.entries(params)) {
    urlObj.searchParams.set(key, value);
  }
  return urlObj.toString();
}

// src/core/hooks/useMoreButtonBottomSheet/AppShareListMenu.tsx
import { jsx as jsx6 } from "react/jsx-runtime";
var SHARE_SCHEME_REFERRER = "appsintoss.common_module_share";
var APP_SHARE_MENU_INFO = {
  contactItemName: "\uACF5\uC720\uD558\uAE30",
  contactIconUrl: "https://static.toss.im/icons/png/4x/icon-share-dots-mono.png"
};
function AppShareListMenu() {
  const initialScheme = getSchemeUri4();
  const isSandbox = getOperationalEnvironment() === "sandbox";
  const { openConfirm } = useDialog4();
  const schemeForShare = addParamsToUrl(initialScheme, {
    referrer: SHARE_SCHEME_REFERRER
  });
  return /* @__PURE__ */ jsx6(
    Menu,
    {
      title: APP_SHARE_MENU_INFO.contactItemName,
      iconURL: APP_SHARE_MENU_INFO.contactIconUrl,
      onPress: () => {
        if (isSandbox) {
          openConfirm({
            title: "\uACF5\uC720\uD558\uAE30 \uAE30\uB2A5 \uBBF8\uC9C0\uC6D0",
            description: "\uC0CC\uB4DC\uBC15\uC2A4 \uD658\uACBD\uC5D0\uC11C\uB294 \uC0AC\uC6A9\uD560 \uC218 \uC5C6\uC5B4\uC694. \uCF58\uC194\uC744 \uD1B5\uD574 \uD1A0\uC2A4\uC571\uC5D0\uC11C \uD14C\uC2A4\uD2B8\uD574 \uC8FC\uC138\uC694.",
            rightButton: "\uD655\uC778",
            closeOnDimmerClick: true
          });
          return;
        }
        NativeModules.AppsInTossModule.shareWithScheme({
          params: {
            schemeURL: schemeForShare
          }
        });
      }
    }
  );
}

// src/core/hooks/useMoreButtonBottomSheet/PermissionsMenu.tsx
import { getOperationalEnvironment as getOperationalEnvironment2 } from "@apps-in-toss/native-modules";
import { Granite as Granite6, openURL as openURL4 } from "@granite-js/react-native";
import { jsx as jsx7 } from "react/jsx-runtime";
function PermissionsMenu() {
  const globals = getAppsInTossGlobals();
  if (getOperationalEnvironment2() === "sandbox") {
    return null;
  }
  return /* @__PURE__ */ jsx7(
    Menu,
    {
      title: "\uAD8C\uD55C \uC124\uC815",
      iconURL: "https://static.toss.im/icons/png/4x/icon-setting-mono.png",
      onPress: () => openURL4(
        `servicetoss://apps-in-toss-menu/permissions?appName=${Granite6.appName}&displayAppName=${globals.brandDisplayName}`
      )
    }
  );
}

// src/core/utils/ensureValue.ts
function ensureValue(value, name) {
  if (value === void 0) {
    throw new Error(`${name} is required`);
  }
  return value;
}

// src/core/hooks/useMoreButtonBottomSheet/index.tsx
import { Fragment as Fragment3, jsx as jsx8, jsxs as jsxs2 } from "react/jsx-runtime";
var APP_BRIDGE_METHOD_NAME = "getMiniAppsSupportContact";
var MIN_VERSION = {
  BOTTOM_SHEET: {
    android: "5.226.0",
    ios: "5.226.0"
  },
  SHARE_LIST_MENU: {
    android: "5.230.0",
    ios: "5.230.0"
  },
  PERMISSIONS_MENU: {
    android: "5.238.0",
    ios: "5.237.0"
  }
};
function useMoreButtonBottomSheet() {
  const globals = getAppsInTossGlobals();
  const adaptive = useAdaptive2();
  const [itemList, setItemList] = useState4([]);
  const appUpdateDialog = useAppUpdateDialog();
  const logging = useMoreButtonBottomSheetLogging();
  const overlay = useOverlay2();
  const title = ensureValue(globals.brandDisplayName, "displayName");
  const isBottomSheetSupported = isMinVersionSupported2(MIN_VERSION.BOTTOM_SHEET);
  const isShareListMenuSupported = isMinVersionSupported2(MIN_VERSION.SHARE_LIST_MENU);
  const [isPermissionsMenuSupported, setIsPermissionsMenuSupported] = useState4(false);
  useEffect6(() => {
    if (!isBottomSheetSupported) {
      return;
    }
    INTERNAL__appBridgeHandler.invokeAppBridgeMethod(
      APP_BRIDGE_METHOD_NAME,
      {},
      {
        onSuccess: ({ items }) => setItemList(items),
        onError: (error) => console.error("\uBA54\uB274 \uBAA9\uB85D\uC744 \uAC00\uC838\uC624\uB294 \uB370 \uC2E4\uD328\uD588\uC5B4\uC694:", error)
      }
    );
    if (isMinVersionSupported2(MIN_VERSION.PERMISSIONS_MENU)) {
      INTERNAL__appBridgeHandler.invokeAppBridgeMethod(
        "getAllPermission",
        {},
        {
          onSuccess: (permissions) => setIsPermissionsMenuSupported(permissions.length > 0),
          onError: (error) => console.error("\uAD8C\uD55C \uBAA9\uB85D\uC744 \uAC00\uC838\uC624\uB294 \uB370 \uC2E4\uD328\uD588\uC5B4\uC694:", error)
        }
      );
    }
  }, [isBottomSheetSupported]);
  const onClickHandler = async () => {
    logging.open();
    if (!isBottomSheetSupported) {
      await appUpdateDialog.open({
        title: `\uC774 \uAE30\uB2A5\uC744 \uC4F0\uB824\uBA74 \uC571 \uC5C5\uB370\uC774\uD2B8\uAC00 \uD544\uC694\uD574\uC694`,
        description: `\uBB38\uC758, \uAD8C\uD55C \uC124\uC815, \uC2E0\uACE0 \uB4F1 \uAE30\uB2A5\uC744 \uC4F8 \uC218 \uC788\uC5B4\uC694`
      });
      return;
    }
    overlay.open(({ isOpen, exit, close }) => {
      const handleClose = () => {
        logging.close();
        close();
      };
      return /* @__PURE__ */ jsx8(BottomSheetImpressionArea, { children: /* @__PURE__ */ jsx8(
        BottomSheet.Root,
        {
          header: /* @__PURE__ */ jsx8(
            ListHeader,
            {
              title: /* @__PURE__ */ jsx8(ListHeader.TitleParagraph, { color: adaptive.grey800, fontWeight: "bold", typography: "t5", children: title })
            }
          ),
          open: isOpen,
          cta: /* @__PURE__ */ jsx8(
            BottomSheet.CTA,
            {
              size: "large",
              type: "dark",
              style: "weak",
              onPress: () => {
                handleClose();
              },
              children: "\uB2EB\uAE30"
            }
          ),
          onClose: handleClose,
          onExited: exit,
          children: /* @__PURE__ */ jsxs2(List, { rowSeparator: "none", children: [
            itemList.map((item) => /* @__PURE__ */ jsx8(
              Menu,
              {
                title: item.contactItemName,
                iconURL: item.contactIconUrl,
                onPress: () => openURL5(item.contactUri)
              },
              item.contactItemName
            )),
            isShareListMenuSupported && /* @__PURE__ */ jsx8(AppShareListMenu, {}),
            isPermissionsMenuSupported && /* @__PURE__ */ jsx8(PermissionsMenu, {})
          ] })
        }
      ) });
    });
  };
  return { open: onClickHandler };
}
function BottomSheetImpressionArea({ children }) {
  const logging = useMoreButtonBottomSheetLogging();
  useEffect6(() => {
    logging.show();
  }, [logging]);
  return /* @__PURE__ */ jsx8(Fragment3, { children });
}

// src/core/utils/toIcon.ts
function toIcon(source) {
  return source.startsWith("http") ? { source: { uri: source } } : { name: source };
}

// src/components/NavigationBar/common/NavigationBarImpressionArea.tsx
import { useEffect as useEffect7, useRef as useRef3 } from "react";
import { Fragment as Fragment4, jsx as jsx9 } from "react/jsx-runtime";
function NavigationBarImpressionArea({
  children,
  withHomeButton
}) {
  const hasLogged = useRef3(false);
  const logging = useNavigationBarLogging();
  useEffect7(() => {
    if (hasLogged.current === false) {
      logging.navBarImpression({ home_icon_yn: withHomeButton ? "Y" : "N" });
      hasLogged.current = true;
    }
  }, [logging, withHomeButton]);
  return /* @__PURE__ */ jsx9(Fragment4, { children });
}

// src/components/NavigationBar/RNNavigationBar/Default.tsx
import { jsx as jsx10 } from "react/jsx-runtime";
function DefaultNavigationBar() {
  const globals = getAppsInTossGlobals();
  const { open: openMoreButtonBottomSheet } = useMoreButtonBottomSheet();
  const parsedNavigationBar = globals.navigationBar != null ? safeParseNavigationBar(globals.navigationBar) : null;
  const withHomeButton = parsedNavigationBar?.withHomeButton ?? false;
  const withBackButton = parsedNavigationBar?.withBackButton ?? true;
  const { navigationRightButton } = useNavigationBarContext();
  const navigationEvent = useNavigationEvent();
  useHardwareBackPress(navigationEvent.handleBack);
  return /* @__PURE__ */ jsx10(NavigationBarImpressionArea, { withHomeButton, children: /* @__PURE__ */ jsx10(
    TopNavigation,
    {
      title: globals.brandDisplayName,
      icon: toIcon(globals.brandIcon),
      onPressDots: openMoreButtonBottomSheet,
      contentVisible: true,
      onPressTitle: withHomeButton ? navigationEvent.handleHomeButtonClick : void 0,
      onPressClose: navigationEvent.handleCloseButtonClick,
      withHome: withHomeButton,
      fixedRightButton: navigationRightButton,
      leftVisible: withBackButton,
      children: /* @__PURE__ */ jsx10(NavigationLeft, { visible: withBackButton, children: /* @__PURE__ */ jsx10(NavigationBackButton, { onPress: navigationEvent.handleBack, canGoBack: false }) })
    }
  ) });
}

// src/components/NavigationBar/RNNavigationBar/Game.tsx
import { useSafeAreaInsets } from "@granite-js/native/react-native-safe-area-context";
import { PageNavbar } from "@toss/tds-react-native";
import { NavigationRightContent, useSafeAreaTop } from "@toss/tds-react-native/private";
import { Platform as Platform2, View as View3 } from "react-native";
import { Fragment as Fragment5, jsx as jsx11, jsxs as jsxs3 } from "react/jsx-runtime";
function GameNavigationBar() {
  const safeAreaTop = useSafeAreaTop();
  const { open: openMoreButtonBottomSheet } = useMoreButtonBottomSheet();
  const navigationEvent = useNavigationEvent();
  const { navigationRightButton } = useNavigationBarContext();
  const { right: safeAreaRight } = useSafeAreaInsets();
  useHardwareBackPress(navigationEvent.handleBack);
  return /* @__PURE__ */ jsxs3(Fragment5, { children: [
    /* @__PURE__ */ jsx11(PageNavbar, { preference: { type: "none" } }),
    /* @__PURE__ */ jsx11(
      View3,
      {
        style: {
          width: "100%",
          // TODO: UI관련 스타일 설정은 TDS로 이관
          height: Platform2.OS === "ios" ? 44 : 54,
          flexDirection: "row",
          alignItems: "center",
          justifyContent: "flex-end",
          position: "absolute",
          zIndex: Z_INDEX.CLOSE_BUTTON,
          marginTop: safeAreaTop,
          paddingRight: safeAreaRight + 10
        },
        pointerEvents: "box-none",
        children: /* @__PURE__ */ jsx11(
          NavigationRightContent,
          {
            fixedRightButton: navigationRightButton,
            onPressDots: openMoreButtonBottomSheet,
            onPressClose: navigationEvent.handleCloseButtonClick,
            theme: "dark"
          }
        )
      }
    )
  ] });
}

// src/components/NavigationBar/RNNavigationBar/index.tsx
var RNNavigationBar = {
  Default: DefaultNavigationBar,
  Game: GameNavigationBar
};

// src/bridge-entry.ts
var bridge_entry_exports = {};
__reExport(bridge_entry_exports, async_bridges_star);
__reExport(bridge_entry_exports, constant_bridges_star);
__reExport(bridge_entry_exports, event_bridges_star);
import * as async_bridges_star from "@apps-in-toss/native-modules/async-bridges";
import * as constant_bridges_star from "@apps-in-toss/native-modules/constant-bridges";
import * as event_bridges_star from "@apps-in-toss/native-modules/event-bridges";

// src/components/RNAppContainer.tsx
import { Fragment as Fragment6, jsx as jsx12, jsxs as jsxs4 } from "react/jsx-runtime";
function RNAppContainer({ children }) {
  const global2 = getAppsInTossGlobals();
  switch (global2.appType) {
    case "game":
      return /* @__PURE__ */ jsx12(GameAppContainer, { children });
    case "general":
    default:
      return /* @__PURE__ */ jsx12(GeneralAppContainer, { children });
  }
}
function GameAppContainer({ children }) {
  useEffect8(() => {
    if (Platform3.OS === "ios") {
      setIosSwipeGestureEnabled({ isEnabled: false });
      return () => {
        setIosSwipeGestureEnabled({ isEnabled: true });
      };
    }
    return;
  }, []);
  return /* @__PURE__ */ jsxs4(Fragment6, { children: [
    /* @__PURE__ */ jsx12(RNNavigationBar.Game, {}),
    (0, bridge_entry_exports.getOperationalEnvironment)() === "toss" ? /* @__PURE__ */ jsx12(GameInitializer, { children }) : children
  ] });
}
function GeneralAppContainer({ children }) {
  return /* @__PURE__ */ jsxs4(Fragment6, { children: [
    /* @__PURE__ */ jsx12(RNNavigationBar.Default, {}),
    children
  ] });
}

// src/core/registerApp.tsx
import { Fragment as Fragment7, jsx as jsx13, jsxs as jsxs5 } from "react/jsx-runtime";
function AppsInTossContainer(Container, { children, ...initialProps }) {
  if (!isMinVersionSupported3({
    android: "5.220.0",
    ios: "5.221.0"
  })) {
    return /* @__PURE__ */ jsxs5(Fragment7, { children: [
      /* @__PURE__ */ jsx13(AppEvent.Entry, {}),
      /* @__PURE__ */ jsx13(AppEvent.System, { ...initialProps }),
      /* @__PURE__ */ jsx13(AppUpdate, {})
    ] });
  }
  return /* @__PURE__ */ jsxs5(Fragment7, { children: [
    /* @__PURE__ */ jsx13(AppEvent.StayTime, {}),
    /* @__PURE__ */ jsx13(AppEvent.Entry, {}),
    /* @__PURE__ */ jsx13(AppEvent.System, { ...initialProps }),
    /* @__PURE__ */ jsx13(Container, { ...initialProps, children: /* @__PURE__ */ jsx13(TDSProvider, { colorPreference: "light", token: { color: { primary: getAppsInTossGlobals().brandPrimaryColor } }, children }) })
  ] });
}
function registerApp(container, { context, analytics }) {
  const appName = getAppName();
  const isRegistered = AppRegistry.getAppKeys().includes(appName);
  if (!isRegistered) {
    Analytics.init({
      logger: (params) => void eventLog(params),
      debug: analytics?.debug ?? __DEV__
    });
    const App = Granite7.registerApp(AppsInTossContainer.bind(null, container), {
      appName,
      context,
      setIosSwipeGestureEnabled: setIosSwipeGestureEnabled2,
      router: {
        screenContainer: AppsInTossScreenContainer,
        defaultScreenOption: {
          statusBarStyle: "dark"
        }
      }
    });
    global.Page = App;
  }
  return global.Page;
}
function AppsInTossScreenContainer({ children }) {
  const isRNApp = getAppsInTossGlobals().webViewType == null;
  return /* @__PURE__ */ jsx13(NavigationBarContextProvider, { children: /* @__PURE__ */ jsx13(Analytics.Screen, { children: isRNApp ? /* @__PURE__ */ jsx13(RNAppContainer, { children }) : children }) });
}
function getAppName() {
  try {
    return global.__granite.app.name;
  } catch (error) {
    console.error("unexpected error occurred while getting app name");
    throw error;
  }
}

// src/core/index.ts
var AppsInToss = {
  registerApp
};

// src/components/WebView.tsx
import {
  AppsInTossModule,
  GoogleAdMob as GoogleAdMob2,
  IAP,
  Storage,
  appsInTossEvent,
  iapCreateOneTimePurchaseOrder,
  processProductGrant,
  requestOneTimePurchase
} from "@apps-in-toss/native-modules";
import * as appsInTossAsyncBridges from "@apps-in-toss/native-modules/async-bridges";
import * as appsInTossConstantBridges from "@apps-in-toss/native-modules/constant-bridges";
import * as appsInTossEventBridges from "@apps-in-toss/native-modules/event-bridges";
import { useSafeAreaInsets as useSafeAreaInsets4 } from "@granite-js/native/react-native-safe-area-context";
import { getSchemeUri as getSchemeUri8 } from "@granite-js/react-native";
import { ExternalWebViewScreen, tdsEvent } from "@toss/tds-react-native";
import { useSafeAreaBottom, useSafeAreaTop as useSafeAreaTop3 } from "@toss/tds-react-native/private";
import { useEffect as useEffect13, useMemo as useMemo7, useRef as useRef6, useState as useState6 } from "react";
import { BackHandler as BackHandler2, Linking, Platform as Platform6 } from "react-native";

// src/components/GameWebView.tsx
import { setIosSwipeGestureEnabled as setIosSwipeGestureEnabled3, getOperationalEnvironment as getOperationalEnvironment4 } from "@apps-in-toss/native-modules";
import {
  WebView as PlainWebView
} from "@granite-js/native/react-native-webview";
import { forwardRef, useEffect as useEffect9 } from "react";
import { Platform as Platform5 } from "react-native";

// src/components/NavigationBar/GameWebviewNavigationBar.tsx
import { useSafeAreaInsets as useSafeAreaInsets2 } from "@granite-js/native/react-native-safe-area-context";
import { closeView as closeView4 } from "@granite-js/react-native";
import { PageNavbar as PageNavbar2, useDialog as useDialog5 } from "@toss/tds-react-native";
import { NavigationRightContent as NavigationRightContent2, useSafeAreaTop as useSafeAreaTop2 } from "@toss/tds-react-native/private";
import { josa as josa3 } from "es-hangul";
import { useCallback as useCallback8 } from "react";
import { Platform as Platform4, View as View4 } from "react-native";
import { Fragment as Fragment8, jsx as jsx14, jsxs as jsxs6 } from "react/jsx-runtime";
function GameWebviewNavigationBar() {
  const safeAreaTop = useSafeAreaTop2();
  const { openConfirm } = useDialog5();
  const { captureExitLog } = useCaptureExitLog();
  const global2 = getAppsInTossGlobals();
  const logging = useNavigationBarLogging();
  const { open: openMoreButtonBottomSheet } = useMoreButtonBottomSheet();
  const { navigationRightButton } = useNavigationBarContext();
  const { right: safeAreaRight } = useSafeAreaInsets2();
  const handleGameWebviewClose = useCallback8(async () => {
    logging.closeButtonClick();
    const isConfirmed = await openConfirm({
      title: `${josa3(global2.brandDisplayName, "\uC744/\uB97C")} \uC885\uB8CC\uD560\uAE4C\uC694?`,
      leftButton: "\uCDE8\uC18C",
      rightButton: "\uC885\uB8CC\uD558\uAE30",
      closeOnDimmerClick: true,
      onEntered: logging.closePopupShow
    });
    logging.closePopupCtaClick(isConfirmed);
    if (isConfirmed) {
      captureExitLog(Date.now());
      closeView4();
    }
  }, [captureExitLog, global2.brandDisplayName, logging, openConfirm]);
  return /* @__PURE__ */ jsxs6(Fragment8, { children: [
    /* @__PURE__ */ jsx14(PageNavbar2, { preference: { type: "none" } }),
    /* @__PURE__ */ jsx14(
      View4,
      {
        style: {
          width: "100%",
          // TODO: UI관련 스타일 설정은 TDS로 이관
          height: Platform4.OS === "ios" ? 44 : 54,
          flexDirection: "row",
          alignItems: "center",
          justifyContent: "flex-end",
          position: "absolute",
          zIndex: Z_INDEX.CLOSE_BUTTON,
          marginTop: safeAreaTop,
          paddingRight: safeAreaRight + 10
        },
        pointerEvents: "box-none",
        children: /* @__PURE__ */ jsx14(
          NavigationRightContent2,
          {
            fixedRightButton: navigationRightButton,
            onPressDots: openMoreButtonBottomSheet,
            onPressClose: () => {
              handleGameWebviewClose();
            },
            theme: "dark"
          }
        )
      }
    )
  ] });
}

// src/components/GameWebView.tsx
import { Fragment as Fragment9, jsx as jsx15, jsxs as jsxs7 } from "react/jsx-runtime";
var GameWebView = forwardRef(function GameWebView2(props, ref) {
  useEffect9(() => {
    if (Platform5.OS === "ios") {
      setIosSwipeGestureEnabled3({ isEnabled: false });
      return () => {
        setIosSwipeGestureEnabled3({ isEnabled: true });
      };
    }
    return;
  }, []);
  return /* @__PURE__ */ jsxs7(Fragment9, { children: [
    /* @__PURE__ */ jsx15(GameWebviewNavigationBar, {}),
    getOperationalEnvironment4() === "toss" ? /* @__PURE__ */ jsx15(GameInitializer, { children: /* @__PURE__ */ jsx15(PlainWebView, { ref, ...props }) }) : /* @__PURE__ */ jsx15(PlainWebView, { ref, ...props })
  ] });
});

// src/components/PartnerWebView.tsx
import {
  WebView as PlainWebView2
} from "@granite-js/native/react-native-webview";
import { forwardRef as forwardRef2 } from "react";

// src/components/NavigationBar/PartnerWebviewNavigationBar.tsx
import { closeView as closeView5 } from "@granite-js/react-native";
import { useDialog as useDialog6 } from "@toss/tds-react-native";
import { NavigationBackButton as NavigationBackButton2, NavigationLeft as NavigationLeft2, TopNavigation as TopNavigation2 } from "@toss/tds-react-native/private";
import { josa as josa4 } from "es-hangul";
import { useCallback as useCallback9 } from "react";
import { jsx as jsx16 } from "react/jsx-runtime";
function PartnerWebviewNavigationBar({ onBackButtonClick, onHomeButtonClick }) {
  const globals = getAppsInTossGlobals();
  const { captureExitLog } = useCaptureExitLog();
  const logging = useNavigationBarLogging();
  const { openConfirm } = useDialog6();
  const { open: openMoreButtonBottomSheet } = useMoreButtonBottomSheet();
  const parsedNavigationBar = globals.navigationBar != null ? safeParseNavigationBar(globals.navigationBar) : null;
  const withHomeButton = parsedNavigationBar?.withHomeButton ?? false;
  const withBackButton = parsedNavigationBar?.withBackButton ?? true;
  const { navigationRightButton } = useNavigationBarContext();
  const handleClose = useCallback9(async () => {
    logging.closeButtonClick();
    const isConfirmed = await openConfirm({
      title: `${josa4(globals.brandDisplayName, "\uC744/\uB97C")} \uC885\uB8CC\uD560\uAE4C\uC694?`,
      leftButton: "\uCDE8\uC18C",
      rightButton: "\uC885\uB8CC\uD558\uAE30",
      closeOnDimmerClick: true,
      onEntered: logging.closePopupShow
    });
    logging.closePopupCtaClick(isConfirmed);
    if (isConfirmed) {
      captureExitLog(Date.now());
      closeView5();
    }
  }, [captureExitLog, globals.brandDisplayName, logging, openConfirm]);
  return /* @__PURE__ */ jsx16(NavigationBarImpressionArea, { withHomeButton, children: /* @__PURE__ */ jsx16(
    TopNavigation2,
    {
      title: globals.brandDisplayName,
      icon: toIcon(globals.brandIcon),
      onPressDots: openMoreButtonBottomSheet,
      contentVisible: true,
      onPressTitle: withHomeButton ? onHomeButtonClick : void 0,
      onPressClose: handleClose,
      withHome: withHomeButton,
      fixedRightButton: navigationRightButton,
      leftVisible: withBackButton,
      children: /* @__PURE__ */ jsx16(NavigationLeft2, { visible: withBackButton, children: /* @__PURE__ */ jsx16(NavigationBackButton2, { onPress: onBackButtonClick, canGoBack: false }) })
    }
  ) });
}

// src/components/PartnerWebView.tsx
import { Fragment as Fragment10, jsx as jsx17, jsxs as jsxs8 } from "react/jsx-runtime";
var PartnerWebView = forwardRef2(function PartnerWebViewScreen({ onBackButtonClick, onHomeButtonClick, ...webViewProps }, ref) {
  return /* @__PURE__ */ jsxs8(Fragment10, { children: [
    /* @__PURE__ */ jsx17(PartnerWebviewNavigationBar, { onBackButtonClick, onHomeButtonClick }),
    /* @__PURE__ */ jsx17(PlainWebView2, { ref, ...webViewProps, style: { flex: 1 } })
  ] });
});

// src/components/utils/url.ts
function convertIntentURL(url) {
  if (url.protocol !== "intent:") {
    return null;
  }
  const components = url.hash.replace("#Intent;", "").split(";").map((component) => component.split("="));
  const scheme = components.find(([key]) => key === "scheme")?.[1];
  if (!scheme) {
    return null;
  }
  return `${scheme}://${url.hostname}${url.pathname}${url.search}`;
}

// src/ads/fetchTossAd.ts
import {
  getOperationalEnvironment as getOperationalEnvironment5,
  INTERNAL__appBridgeHandler as INTERNAL__appBridgeHandler2,
  isMinVersionSupported as isMinVersionSupported4
} from "@apps-in-toss/native-modules";

// ../../../.yarn/cache/es-toolkit-npm-1.34.1-4cd6371dcb-aab6d07be3.zip/node_modules/es-toolkit/dist/function/noop.mjs
function noop() {
}

// src/ads/generateSessionId.ts
function generateSessionId() {
  return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
    const r = Math.random() * 16 | 0;
    const v = c === "x" ? r : r & 3 | 8;
    return v.toString(16);
  });
}

// src/ads/constants.ts
var sessionId = generateSessionId();

// src/ads/fetchTossAd.ts
var ANDROID_FETCH_TOSS_AD_SUPPORTED_VERSION = "5.241.0";
var IOS_FETCH_TOSS_AD_SUPPORTED_VERSION = "5.241.0";
var UNSUPPORTED_ERROR_MESSAGE = "This feature is not supported in the current environment";
var ENVIRONMENT = getOperationalEnvironment5();
function fetchTossAd(params) {
  if (!fetchTossAd.isSupported()) {
    params.onError(new Error(UNSUPPORTED_ERROR_MESSAGE));
    return noop;
  }
  const { onEvent, onError, options } = params;
  const { adGroupId } = options;
  const unregisterCallbacks = INTERNAL__appBridgeHandler2.invokeAppBridgeMethod(
    "fetchTossAd",
    { spaceUnitId: adGroupId, sessionId, sdkId: options.sdkId, availableStyleIds: options.availableStyleIds },
    {
      onSuccess: (response) => {
        onEvent(response);
      },
      onError: (error) => {
        onError(error);
      }
    }
  );
  return unregisterCallbacks;
}
fetchTossAd.isSupported = () => {
  if (ENVIRONMENT !== "toss") {
    return false;
  }
  return isMinVersionSupported4({
    android: ANDROID_FETCH_TOSS_AD_SUPPORTED_VERSION,
    ios: IOS_FETCH_TOSS_AD_SUPPORTED_VERSION
  });
};

// src/ads/integratedAd.ts
import { GoogleAdMob, INTERNAL__appBridgeHandler as INTERNAL__appBridgeHandler3, isMinVersionSupported as isMinVersionSupported5 } from "@apps-in-toss/native-modules";

// src/ads/generateRequestId.ts
function generateRequestId() {
  const timestamp = Date.now().toString(36).toUpperCase();
  const random = Math.random().toString(36).substring(2, 7).toUpperCase();
  return `ait-${timestamp}${random}`;
}

// src/ads/getReferrer.ts
import { getSchemeUri as getSchemeUri5 } from "@granite-js/react-native";
function getReferrer() {
  try {
    return new URL(getSchemeUri5()).searchParams.get("referrer");
  } catch {
    return null;
  }
}

// src/ads/remotes.ts
import { getOperationalEnvironment as getOperationalEnvironment6, getPlatformOS, getTossAppVersion } from "@apps-in-toss/native-modules";

// src/ads/getIsDev.ts
import { getSchemeUri as getSchemeUri6 } from "@granite-js/react-native";
function getIsDev() {
  try {
    return new URL(getSchemeUri6()).searchParams.get("isDev") === "true";
  } catch {
    return false;
  }
}

// src/ads/remotes.ts
var OPERATIONAL_ENVIRONMENT = getOperationalEnvironment6();
var OS = getPlatformOS();
var APP_VER = getTossAppVersion();
var ALPHA_EVENT_TRACKER_HTTP_ENDPOINT = "https://alpha-trillion.toss.im/trk/sdk-mediation/event";
var LIVE_EVENT_TRACKER_HTTP_ENDPOINT = "https://trillion.toss.im/trk/sdk-mediation/event";
function getPostEventTrackingUrl() {
  const isDev = getIsDev();
  if (OPERATIONAL_ENVIRONMENT === "sandbox" || isDev) {
    return ALPHA_EVENT_TRACKER_HTTP_ENDPOINT;
  }
  return LIVE_EVENT_TRACKER_HTTP_ENDPOINT;
}
function postEventTracking(params) {
  const endpoint = getPostEventTrackingUrl();
  const bodyJSON = JSON.stringify({
    ...params,
    os: OS,
    appVer: APP_VER,
    deviceIdType: "NONE",
    platform: "RN"
  });
  return fetch(endpoint, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: bodyJSON
  }).catch(noop);
}

// src/ads/integratedAd.ts
var INTEGRATED_AD_SDK_VERSION = "0.0.0";
var ANDROID_INTEGRATED_AD_SUPPORTED_VERSION = "5.241.0";
var IOS_INTEGRATED_AD_SUPPORTED_VERSION = "5.241.0";
var UNSUPPORTED_ERROR_MESSAGE2 = "This feature is not supported in the current environment";
var INTG_AD_ADM_FALLBACK_RID_MAP = {};
function integratedAdIsSupported() {
  return isMinVersionSupported5({
    android: ANDROID_INTEGRATED_AD_SUPPORTED_VERSION,
    ios: IOS_INTEGRATED_AD_SUPPORTED_VERSION
  });
}
function generateLoadFullScreenAd(sdkId) {
  const fn = (params) => {
    if (!GoogleAdMob.loadAppsInTossAdMob.isSupported()) {
      params.onError(new Error(UNSUPPORTED_ERROR_MESSAGE2));
      return noop;
    }
    if (!integratedAdIsSupported()) {
      return GoogleAdMob.loadAppsInTossAdMob({
        ...params,
        onEvent: (event) => {
          if (event.type === "loaded") {
            const requestId = generateRequestId();
            INTG_AD_ADM_FALLBACK_RID_MAP[params.options.adGroupId] = requestId;
            postEventTracking({
              eventName: "LOAD",
              spaceUnitId: params.options.adGroupId,
              requestId,
              responseId: event.data.responseInfo.responseId,
              mediationType: "ADMOB",
              format: "",
              adSourceName: event.data.responseInfo.loadedAdNetworkInfo?.adSourceName ?? "",
              sdkVer: INTEGRATED_AD_SDK_VERSION
            });
          }
          return params.onEvent(event);
        },
        onError: (error) => {
          const requestId = INTG_AD_ADM_FALLBACK_RID_MAP[params.options.adGroupId] ?? "";
          postEventTracking({
            eventName: "FAILED_TO_LOAD",
            spaceUnitId: params.options.adGroupId,
            requestId,
            responseId: "",
            mediationType: "ADMOB",
            format: "",
            adSourceName: "",
            sdkVer: INTEGRATED_AD_SDK_VERSION
          });
          return params.onError(error);
        }
      });
    }
    const { onEvent, onError, options } = params;
    const { adGroupId } = options;
    const referrer = getReferrer();
    const unregisterCallbacks = INTERNAL__appBridgeHandler3.invokeAppBridgeMethod(
      "loadTossAdOrAdmob",
      { spaceUnitId: adGroupId, referrer, sessionId, sdkId },
      {
        onSuccess: () => {
          onEvent({ type: "loaded" });
        },
        onError: (error) => {
          onError(error);
        }
      }
    );
    return unregisterCallbacks;
  };
  fn.isSupported = GoogleAdMob.loadAppsInTossAdMob.isSupported;
  return fn;
}
var loadFullScreenAd = generateLoadFullScreenAd("107");
var loadFullScreenAdForWeb = generateLoadFullScreenAd("107");
function showFullScreenAd(params) {
  if (!GoogleAdMob.showAppsInTossAdMob.isSupported()) {
    params.onError(new Error(UNSUPPORTED_ERROR_MESSAGE2));
    return noop;
  }
  if (!integratedAdIsSupported()) {
    return GoogleAdMob.showAppsInTossAdMob({
      ...params,
      onEvent: (event) => {
        const requestId = INTG_AD_ADM_FALLBACK_RID_MAP[params.options.adGroupId] ?? "";
        switch (event.type) {
          case "show":
            postEventTracking({
              eventName: "SHOW",
              spaceUnitId: params.options.adGroupId,
              requestId,
              responseId: "",
              mediationType: "ADMOB",
              format: "",
              adSourceName: "",
              sdkVer: INTEGRATED_AD_SDK_VERSION
            });
            break;
          case "failedToShow":
            postEventTracking({
              eventName: "FAILED_TO_SHOW",
              spaceUnitId: params.options.adGroupId,
              requestId,
              responseId: "",
              mediationType: "ADMOB",
              format: "",
              adSourceName: "",
              sdkVer: INTEGRATED_AD_SDK_VERSION
            });
            break;
          case "impression":
            postEventTracking({
              eventName: "IMP",
              spaceUnitId: params.options.adGroupId,
              requestId,
              responseId: "",
              mediationType: "ADMOB",
              format: "",
              adSourceName: "",
              sdkVer: INTEGRATED_AD_SDK_VERSION
            });
            break;
          case "clicked":
            postEventTracking({
              eventName: "CLICK",
              spaceUnitId: params.options.adGroupId,
              requestId,
              responseId: "",
              mediationType: "ADMOB",
              format: "",
              adSourceName: "",
              sdkVer: INTEGRATED_AD_SDK_VERSION
            });
            break;
          case "dismissed":
            postEventTracking({
              eventName: "DISMISS",
              spaceUnitId: params.options.adGroupId,
              requestId,
              responseId: "",
              mediationType: "ADMOB",
              format: "",
              adSourceName: "",
              sdkVer: INTEGRATED_AD_SDK_VERSION
            });
            break;
          case "userEarnedReward":
            postEventTracking({
              eventName: "USER_EARNED_REWARD",
              spaceUnitId: params.options.adGroupId,
              requestId,
              responseId: "",
              mediationType: "ADMOB",
              format: "",
              adSourceName: "",
              sdkVer: INTEGRATED_AD_SDK_VERSION
            });
            break;
        }
        return params.onEvent(event);
      },
      onError: (error) => {
        const requestId = INTG_AD_ADM_FALLBACK_RID_MAP[params.options.adGroupId] ?? "";
        postEventTracking({
          eventName: "FAILED_TO_SHOW",
          spaceUnitId: params.options.adGroupId,
          requestId,
          responseId: "",
          mediationType: "ADMOB",
          format: "",
          adSourceName: "",
          sdkVer: INTEGRATED_AD_SDK_VERSION
        });
        return params.onError(error);
      }
    });
  }
  const { onEvent, onError, options } = params;
  const { adGroupId } = options;
  const referrer = getReferrer();
  const unregisterCallbacks = INTERNAL__appBridgeHandler3.invokeAppBridgeMethod(
    "showTossAdOrAdmob",
    { spaceUnitId: adGroupId, referrer, sessionId },
    {
      onAdClicked: () => {
        onEvent({ type: "clicked" });
      },
      onAdDismissed: () => {
        onEvent({ type: "dismissed" });
      },
      onAdFailedToShow: () => {
        onEvent({ type: "failedToShow" });
      },
      onAdImpression: () => {
        onEvent({ type: "impression" });
      },
      onAdShow: () => {
        onEvent({ type: "show" });
      },
      onUserEarnedReward: (data) => {
        onEvent({ type: "userEarnedReward", data });
      },
      onSuccess: () => {
        onEvent({ type: "requested" });
      },
      onError: (error) => {
        onError(error);
      }
    }
  );
  return unregisterCallbacks;
}
showFullScreenAd.isSupported = GoogleAdMob.showAppsInTossAdMob.isSupported;

// src/ads/tossAdEventLog.ts
import { INTERNAL__module as INTERNAL__module6 } from "@apps-in-toss/native-modules";
import { Granite as Granite8 } from "@granite-js/react-native";
async function tossAdEventLog(params) {
  const referrer = getReferrer();
  const appName = Granite8.appName;
  const eventLogParams = {
    ...params,
    params: {
      ...params.params,
      referrer,
      app_name: appName
    }
  };
  return INTERNAL__module6.tossCoreEventLog(eventLogParams);
}

// src/bridge-handler/useBridgeHandler.tsx
import { useCallback as useCallback10, useEffect as useEffect10, useMemo as useMemo3, useRef as useRef4 } from "react";
function serializeError(error) {
  return JSON.stringify(error, (_, value) => {
    if (value instanceof Error) {
      return {
        ...Object.entries(value).reduce((acc, [key, value2]) => {
          acc[key] = value2;
          return acc;
        }, {}),
        name: value.name,
        message: value.message,
        stack: value.stack,
        __isError: true
      };
    }
    return value;
  });
}
function methodHandler({
  args,
  eventId,
  functionName,
  handlerMap,
  injectJavaScript
}) {
  const func = handlerMap[functionName];
  if (!func) {
    console.error(`${functionName} is not a function`);
    return;
  }
  const wrappedFunc = async (...args2) => {
    const result = await func(...args2);
    return result;
  };
  wrappedFunc(...args).then((result) => {
    injectJavaScript?.(`
      window.__GRANITE_NATIVE_EMITTER.emit('${functionName}/resolve/${eventId}', ${JSON.stringify(result, null, 0)});
    `);
  }).catch((error) => {
    const serializedError = serializeError(error);
    injectJavaScript?.(`
      window.__GRANITE_NATIVE_EMITTER.emit('${functionName}/reject/${eventId}', ${serializedError});
    `);
  });
}
var globalEventListenerMap = /* @__PURE__ */ new Map();
function useBridgeHandler({
  onMessage,
  constantHandlerMap,
  asyncHandlerMap,
  eventListenerMap
}) {
  const ref = useRef4(null);
  const injectedJavaScript = useMemo3(
    () => `window.__CONSTANT_HANDLER_MAP = ${JSON.stringify(
      Object.entries(constantHandlerMap).reduce(
        (acc, [key, value]) => {
          acc[key] = typeof value === "function" ? value() : value;
          return acc;
        },
        {}
      )
    )};`,
    [constantHandlerMap]
  );
  useEffect10(() => {
    ref.current?.injectJavaScript(injectedJavaScript);
  }, [injectedJavaScript]);
  const createHandleOnEvent = (functionName, eventId) => (response) => {
    ref.current?.injectJavaScript(`
      window.__GRANITE_NATIVE_EMITTER.emit('${functionName}/onEvent/${eventId}', ${JSON.stringify(response, null, 0)});
    `);
  };
  const createHandleOnError = (functionName, eventId) => (error) => {
    const serializedError = serializeError(error);
    ref.current?.injectJavaScript(`
      window.__GRANITE_NATIVE_EMITTER.emit('${functionName}/onError/${eventId}', ${serializedError});
    `);
  };
  const $onMessage = useCallback10(
    async (e) => {
      onMessage?.(e);
      const data = parseNativeEventData(e.nativeEvent.data);
      if (typeof data !== "object" || data === null || typeof data.functionName !== "string" || typeof data.eventId !== "string" || typeof data.type !== "string" || !["addEventListener", "removeEventListener", "method"].includes(data.type)) {
        return;
      }
      switch (data.type) {
        case "addEventListener": {
          const handleOnEvent = createHandleOnEvent(data.functionName, data.eventId);
          const handleOnError = createHandleOnError(data.functionName, data.eventId);
          const remove = eventListenerMap[data.functionName]?.({
            onEvent: handleOnEvent,
            onError: handleOnError,
            options: data.args
          });
          if (remove) {
            globalEventListenerMap.set(`${data.functionName}/${data.eventId}`, remove);
          }
          break;
        }
        case "removeEventListener": {
          const key = `${data.functionName}/${data.eventId}`;
          const remove = globalEventListenerMap.get(key);
          remove?.();
          globalEventListenerMap.delete(key);
          break;
        }
        case "method": {
          methodHandler({
            args: data.args,
            eventId: data.eventId,
            functionName: data.functionName,
            handlerMap: asyncHandlerMap,
            injectJavaScript: ref.current?.injectJavaScript
          });
          break;
        }
      }
    },
    // eslint-disable-next-line react-hooks/exhaustive-deps
    [onMessage]
  );
  return {
    ref,
    injectedJavaScript,
    onMessage: $onMessage
  };
}
function parseNativeEventData(data) {
  try {
    return JSON.parse(data);
  } catch (error) {
    console.error(error);
    return null;
  }
}

// src/core/hooks/useSafeAreaInsetsEmitter.tsx
import { useSafeAreaInsets as useSafeAreaInsets3 } from "@granite-js/native/react-native-safe-area-context";
import { useEffect as useEffect11, useMemo as useMemo4 } from "react";
var EventEmitter = class {
  listeners = {};
  on(event, listener) {
    if (!this.listeners[event]) {
      this.listeners[event] = [];
    }
    this.listeners[event].push(listener);
  }
  emit(event, ...args) {
    if (!this.listeners[event]) {
      return;
    }
    this.listeners[event].forEach((listener) => listener(...args));
  }
  off(event, listener) {
    if (!this.listeners[event]) {
      return;
    }
    this.listeners[event] = this.listeners[event].filter((l) => l !== listener);
  }
};
function useSafeAreaInsetsEmitter() {
  const insets = useSafeAreaInsets3();
  const emitter = useMemo4(() => new EventEmitter(), []);
  useEffect11(() => {
    emitter.emit("safeAreaInsetsChange", insets);
    return () => {
      emitter.off("safeAreaInsetsChange", (listener) => listener(insets));
    };
  }, [emitter, insets]);
  return emitter;
}

// src/core/hooks/useWebBackHandler.tsx
import { closeView as closeView6, useBackEventState } from "@granite-js/react-native";
import { useDialog as useDialog7 } from "@toss/tds-react-native";
import { josa as josa5 } from "es-hangul";
import { useCallback as useCallback12, useMemo as useMemo6 } from "react";

// src/hooks/useWebviewHistoryStack.tsx
import { useCallback as useCallback11, useMemo as useMemo5, useReducer } from "react";
var INITIAL_STATE = { stack: [], index: -1 };
function reducer(state, action) {
  switch (action.type) {
    case "NAVIGATION_CHANGE": {
      const { url, canGoForward } = action;
      if (state.stack.length === 0) {
        return { stack: [url], index: 0 };
      }
      const { stack, index } = state;
      const cur = stack[index];
      if (url === cur) {
        return state;
      }
      const prev = index > 0 ? stack[index - 1] : void 0;
      const next = index < stack.length - 1 ? stack[index + 1] : void 0;
      if (prev && url === prev && canGoForward) {
        return { ...state, index: index - 1 };
      }
      if (next && url === next) {
        return { ...state, index: index + 1 };
      }
      const base = stack.slice(0, index + 1);
      const nextStack = [...base, url];
      return { stack: nextStack, index: nextStack.length - 1 };
    }
    default:
      return state;
  }
}
function useWebViewHistory() {
  const [state, dispatch] = useReducer(reducer, INITIAL_STATE);
  const onNavigationStateChange = useCallback11(({ url, canGoForward: canGoForward2 }) => {
    dispatch({ type: "NAVIGATION_CHANGE", url, canGoForward: canGoForward2 });
  }, []);
  const { canGoBack, canGoForward } = useMemo5(() => {
    const canBack = state.index > 0;
    const canFwd = state.index >= 0 && state.index < state.stack.length - 1;
    return { canGoBack: canBack, canGoForward: canFwd };
  }, [state.index, state.stack.length]);
  return { onNavigationStateChange, hasHistory: canGoBack, canGoForward };
}

// src/core/hooks/useWebBackHandler.tsx
var HISTORY_BACK_SCRIPT = `
(function() {
  window.history.back();
  true;
})();
`;
var HISTORY_HOME_SCRIPT = `
  (function() {
    window.location.href = '/';
    true;
  })();
`;
function useWebBackHandler(webViewRef) {
  const { captureExitLog } = useCaptureExitLog();
  const { hasHistory, onNavigationStateChange } = useWebViewHistory();
  const {
    handlersRef: webBackHandlersRef,
    hasBackEvent: hasWebBackEvent,
    addEventListener: addWebBackEventListener,
    removeEventListener: removeWebBackEventListener
  } = useBackEventState();
  const logging = useNavigationBarLogging();
  const { openConfirm } = useDialog7();
  const global2 = getAppsInTossGlobals();
  const addEventListener = useCallback12(
    (handler) => {
      addWebBackEventListener(handler);
    },
    [addWebBackEventListener]
  );
  const removeEventListener = useCallback12(
    (handler) => {
      removeWebBackEventListener(handler);
    },
    [removeWebBackEventListener]
  );
  const handleWebBack = useCallback12(async () => {
    if (hasWebBackEvent) {
      for (const handler of webBackHandlersRef) {
        handler();
      }
      return;
    }
    if (hasHistory) {
      webViewRef.current?.injectJavaScript(HISTORY_BACK_SCRIPT);
    } else {
      const isConfirmed = await openConfirm({
        title: `${josa5(global2.brandDisplayName, "\uC744/\uB97C")} \uC885\uB8CC\uD560\uAE4C\uC694?`,
        leftButton: "\uCDE8\uC18C",
        rightButton: "\uC885\uB8CC\uD558\uAE30",
        closeOnDimmerClick: true,
        onEntered: logging.closePopupShow
      });
      logging.closePopupCtaClick(isConfirmed);
      if (isConfirmed) {
        captureExitLog(Date.now());
        closeView6();
      }
    }
  }, [
    captureExitLog,
    global2.brandDisplayName,
    hasHistory,
    hasWebBackEvent,
    webBackHandlersRef,
    logging,
    openConfirm,
    webViewRef
  ]);
  const handleWebHome = useCallback12(() => {
    logging.homeButtonClick();
    if (hasWebBackEvent) {
      for (const handler of webBackHandlersRef) {
        handler();
      }
      return;
    }
    webViewRef.current?.injectJavaScript(HISTORY_HOME_SCRIPT);
  }, [hasWebBackEvent, webBackHandlersRef, logging, webViewRef]);
  return useMemo6(
    () => ({ addEventListener, removeEventListener, handleWebBack, handleWebHome, onNavigationStateChange }),
    [addEventListener, removeEventListener, handleWebBack, handleWebHome, onNavigationStateChange]
  );
}

// src/core/utils/mergeRefs.ts
function mergeRefs(...refs) {
  return (value) => {
    refs.forEach((ref) => {
      if (typeof ref === "function") {
        ref(value);
      } else if (ref != null) {
        ref.current = value;
      }
    });
  };
}

// src/hooks/useCreateUserAgent.ts
import { getPlatformOS as getPlatformOS2, getTossAppVersion as getTossAppVersion2 } from "@apps-in-toss/native-modules";
import { useWindowDimensions } from "react-native";
var FontA11yCategory = {
  Large: "Large",
  xLarge: "xLarge",
  xxLarge: "xxLarge",
  xxxLarge: "xxxLarge",
  A11y_Medium: "A11y_Medium",
  A11y_Large: "A11y_Large",
  A11y_xLarge: "A11y_xLarge",
  A11y_xxLarge: "A11y_xxLarge",
  A11y_xxxLarge: "A11y_xxxLarge"
};
var androidFontScaleMap = {
  100: FontA11yCategory.Large,
  110: FontA11yCategory.xLarge,
  120: FontA11yCategory.xxLarge,
  135: FontA11yCategory.xxxLarge,
  160: FontA11yCategory.A11y_Medium,
  190: FontA11yCategory.A11y_Large,
  235: FontA11yCategory.A11y_xLarge,
  275: FontA11yCategory.A11y_xxLarge,
  310: FontA11yCategory.A11y_xxxLarge
};
var iosScaleToAndroidScale = {
  0.823: 100,
  0.882: 100,
  0.941: 100,
  1: 100,
  1.118: 110,
  1.235: 120,
  1.353: 135,
  1.786: 160,
  2.143: 190,
  2.643: 235,
  3.143: 275,
  3.571: 310
};
function convertToAndroidStyleScale(fontScale, platform) {
  if (platform === "android") {
    if (fontScale <= 1) {
      return 100;
    }
    const scaledValue = Math.round(fontScale * 100);
    const keys = Object.keys(androidFontScaleMap).map(Number).sort((a, b) => a - b);
    let closestKey = keys[0];
    let minDiff = Math.abs(scaledValue - closestKey);
    for (const key of keys) {
      const diff = Math.abs(scaledValue - key);
      if (diff < minDiff) {
        minDiff = diff;
        closestKey = key;
      }
    }
    return closestKey;
  } else {
    const iosScales = Object.keys(iosScaleToAndroidScale).map(Number);
    let closestScale = iosScales[0];
    let minDiff = Math.abs(fontScale - closestScale);
    for (const scale of iosScales) {
      const diff = Math.abs(fontScale - scale);
      if (diff < minDiff) {
        minDiff = diff;
        closestScale = scale;
      }
    }
    return iosScaleToAndroidScale[closestScale];
  }
}
function mapIOSFontScaleToCategory(fontScale) {
  if (fontScale < 1) {
    return FontA11yCategory.Large;
  }
  if (Math.abs(fontScale - 1) < 0.05) {
    return FontA11yCategory.Large;
  }
  if (Math.abs(fontScale - 1.118) < 0.05) {
    return FontA11yCategory.xLarge;
  }
  if (Math.abs(fontScale - 1.235) < 0.05) {
    return FontA11yCategory.xxLarge;
  }
  if (Math.abs(fontScale - 1.353) < 0.05) {
    return FontA11yCategory.xxxLarge;
  }
  if (Math.abs(fontScale - 1.786) < 0.05) {
    return FontA11yCategory.A11y_Medium;
  }
  if (Math.abs(fontScale - 2.143) < 0.05) {
    return FontA11yCategory.A11y_Large;
  }
  if (Math.abs(fontScale - 2.643) < 0.05) {
    return FontA11yCategory.A11y_xLarge;
  }
  if (Math.abs(fontScale - 3.143) < 0.05) {
    return FontA11yCategory.A11y_xxLarge;
  }
  if (Math.abs(fontScale - 3.571) < 0.05) {
    return FontA11yCategory.A11y_xxxLarge;
  }
  return FontA11yCategory.Large;
}
function mapAndroidFontScaleToCategory(fontScale) {
  if (fontScale <= 1) {
    return androidFontScaleMap[100];
  }
  const scaledValue = Math.round(fontScale * 100);
  const keys = Object.keys(androidFontScaleMap).map(Number).sort((a, b) => a - b);
  if (keys.length === 0) {
    return androidFontScaleMap[100];
  }
  let closestKey = keys[0];
  let minDiff = Math.abs(scaledValue - closestKey);
  for (const key of keys) {
    const diff = Math.abs(scaledValue - key);
    if (diff < minDiff) {
      minDiff = diff;
      closestKey = key;
    }
  }
  return androidFontScaleMap[closestKey];
}
function mapFontScaleToCategory(fontScale, platform) {
  return platform === "ios" ? mapIOSFontScaleToCategory(fontScale) : mapAndroidFontScaleToCategory(fontScale);
}
function useCreateUserAgent({
  batteryModePreference,
  colorPreference,
  locale,
  navbarPreference,
  pureSafeArea,
  safeArea,
  safeAreaBottomTransparency
}) {
  const platform = getPlatformOS2();
  const appVersion = getTossAppVersion2();
  const { fontScale } = useWindowDimensions();
  const platformString = platform === "ios" ? "iPhone" : "Android phone";
  const fontA11y = mapFontScaleToCategory(fontScale, platform);
  const normalizedFontScale = convertToAndroidStyleScale(fontScale, platform);
  return [
    "AppsInToss",
    `TossApp/${appVersion}`,
    batteryModePreference && `TossBatteryModePreference/${batteryModePreference}`,
    colorPreference && `TossColorPreference/${colorPreference}`,
    `TossFontAccessibility/${fontA11y}`,
    `TossFontScale/${normalizedFontScale}`,
    locale && `TossLocale/${locale}`,
    navbarPreference && `TossNavbarPreference/${navbarPreference}`,
    pureSafeArea && `TossPureSafeArea/${pureSafeArea}`,
    safeArea && `TossSafeArea/${safeArea}`,
    safeAreaBottomTransparency && `TossSafeAreaBottomTransparency/${safeAreaBottomTransparency}`,
    platformString
  ].filter(Boolean).join(" ");
}

// src/hooks/useGeolocation.ts
import { startUpdateLocation } from "@apps-in-toss/native-modules";
import { useVisibility as useVisibility3 } from "@granite-js/react-native";
import { useEffect as useEffect12, useState as useState5 } from "react";
function useGeolocation({ accuracy, distanceInterval, timeInterval }) {
  const isVisible = useVisibility3();
  const [location, setLocation] = useState5(null);
  useEffect12(() => {
    if (!isVisible) {
      return;
    }
    return startUpdateLocation({
      options: {
        accuracy,
        distanceInterval,
        timeInterval
      },
      onEvent: setLocation,
      onError: console.error
    });
  }, [accuracy, distanceInterval, timeInterval, isVisible]);
  return location;
}

// src/hooks/useWaitForReturnNavigator.tsx
import { useNavigation as useNavigation2, useVisibilityChange } from "@granite-js/react-native";
import { useCallback as useCallback13, useRef as useRef5 } from "react";
function useWaitForReturnNavigator() {
  const callbacks = useRef5([]).current;
  const navigation = useNavigation2();
  const startNavigating = useCallback13(
    (route, params) => {
      return new Promise((resolve) => {
        callbacks.push(resolve);
        navigation.navigate(route, params);
      });
    },
    [callbacks, navigation]
  );
  const handleVisibilityChange = useCallback13(
    (state) => {
      if (state === "visible" && callbacks.length > 0) {
        for (const callback of callbacks) {
          callback();
        }
        callbacks.splice(0, callbacks.length);
      }
    },
    [callbacks]
  );
  useVisibilityChange(handleVisibilityChange);
  return startNavigating;
}

// src/hooks/useTopNavigation.tsx
function useTopNavigation() {
  const { addNavigationRightButton, removeNavigationRightButton } = useNavigationBarContext();
  return {
    addAccessoryButton: addNavigationRightButton,
    removeAccessoryButton: removeNavigationRightButton
  };
}

// src/hooks/useWebViewMemoryDebug.tsx
import { getOperationalEnvironment as getOperationalEnvironment7, INTERNAL__module as INTERNAL__module7 } from "@apps-in-toss/native-modules";
import { Granite as Granite9 } from "@granite-js/react-native";
import { useToast } from "@toss/tds-react-native";
function useHandleWebViewProcessDidTerminate(webViewRef) {
  const toast = useToast();
  return () => {
    webViewDebugLog("AppsInTossWebViewProcessDidTerminate", {});
    toast.open("\uBB38\uC81C\uAC00 \uC0DD\uACA8\uC11C \uBBF8\uB2C8\uC571\uC744 \uB2E4\uC2DC \uC2DC\uC791\uD588\uC5B4\uC694.", {
      type: "bottom",
      lottie: `https://static.toss.im/lotties-common/check-green-spot.json`
    });
    webViewRef.current?.reload();
  };
}
async function webViewMemoryDebugLog(params) {
  webViewDebugLog("AppsInTossWebViewMemoryDebug", params);
}
function webViewDebugLog(logName, params) {
  const global2 = getAppsInTossGlobals();
  const event = {
    log_name: logName,
    log_type: "debug",
    params: {
      ...params,
      app_name: Granite9.appName,
      deployment_id: global2.deploymentId
    }
  };
  if (getOperationalEnvironment7() === "toss") {
    INTERNAL__module7.tossCoreEventLog(event);
  } else {
    console.log("[webViewDebugLog]", event);
  }
}

// src/utils/log.ts
import { eventLog as eventLogNative } from "@apps-in-toss/native-modules";
import { getSchemeUri as getSchemeUri7 } from "@granite-js/react-native";

// src/utils/extractDateFromUUIDv7.ts
var extractDateFromUUIDv7 = (uuid) => {
  const timestampHex = uuid.split("-").join("").slice(0, 12);
  const timestamp = Number.parseInt(timestampHex, 16);
  return new Date(timestamp);
};

// src/utils/log.ts
var getGroupId = (url) => {
  try {
    const urlObject = new URL(url);
    return {
      groupId: urlObject.pathname,
      search: urlObject.search.startsWith("?") ? urlObject.search.substring(1) : urlObject.search
    };
  } catch {
    return {
      groupId: "unknown",
      search: "unknown"
    };
  }
};
var getReferrer2 = () => {
  try {
    const referrer = new URL(getSchemeUri7());
    return referrer.searchParams.get("referrer");
  } catch {
    return "";
  }
};
var trackScreen = (url) => {
  const { groupId, search } = getGroupId(url);
  const log = {
    log_type: "screen",
    log_name: `${groupId}::screen`,
    params: {
      search,
      referrer: getReferrer2(),
      deployment_id: env.getDeploymentId(),
      deployment_timestamp: extractDateFromUUIDv7(env.getDeploymentId()).getTime()
    }
  };
  return eventLogNative(log);
};

// src/components/WebView.tsx
import { jsx as jsx18 } from "react/jsx-runtime";
var operationalEnvironment = appsInTossConstantBridges.getOperationalEnvironment();
var TYPES = ["partner", "external", "game"];
var WEBVIEW_TYPES = {
  partner: PartnerWebView,
  external: ExternalWebViewScreen,
  game: GameWebView
};
function mergeSchemeQueryParamsInto(url) {
  const baseUrl = new URL(url);
  const schemeUrl = new URL(getSchemeUri8());
  baseUrl.pathname = schemeUrl.pathname;
  for (const [key, value] of schemeUrl.searchParams.entries()) {
    baseUrl.searchParams.set(key, value);
  }
  return baseUrl;
}
function getWebViewUri(local) {
  if (__DEV__) {
    const devUrl = `http://${local.host}:${local.port}`;
    return mergeSchemeQueryParamsInto(devUrl).toString();
  }
  const { url: rawUrl } = AppsInTossModule.getWebBundleURL({});
  const url = mergeSchemeQueryParamsInto(rawUrl);
  const deploymentId = env.getDeploymentId();
  if (deploymentId) {
    url.searchParams.set("_deploymentId", deploymentId);
  }
  return url.toString();
}
function WebView({ type, local, onMessage, ...props }) {
  if (!TYPES.includes(type)) {
    throw new Error(`Invalid WebView type: '${type}'`);
  }
  const webViewRef = useRef6(null);
  const webBackHandler = useWebBackHandler(webViewRef);
  const uri = useMemo7(() => getWebViewUri(local), [local]);
  const top = useSafeAreaTop3();
  const bottom = useSafeAreaBottom();
  const insets = useSafeAreaInsets4();
  const global2 = getAppsInTossGlobals();
  const navigationBarContext = useNavigationBarContext();
  const safeAreaInsetsEmitter = useSafeAreaInsetsEmitter();
  const [allowsBackForwardNavigationGestures, setAllowsBackForwardNavigationGestures] = useState6(
    props.allowsBackForwardNavigationGestures
  );
  const handler = useBridgeHandler({
    onMessage,
    eventListenerMap: {
      ...appsInTossEventBridges,
      navigationAccessoryEvent: ({ onEvent, onError }) => tdsEvent.addEventListener("navigationAccessoryEvent", { onEvent, onError }),
      backEvent: ({ onEvent }) => {
        webBackHandler.addEventListener(onEvent);
        return () => {
          webBackHandler.removeEventListener(onEvent);
        };
      },
      updateLocationEvent: ({ onEvent, onError, options }) => appsInTossEvent.addEventListener("updateLocationEvent", { onEvent, onError, options }),
      safeAreaInsetsChange: ({ onEvent }) => {
        safeAreaInsetsEmitter.on("safeAreaInsetsChange", onEvent);
        return () => {
          safeAreaInsetsEmitter.off("safeAreaInsetsChange", onEvent);
        };
      },
      /** @internal */
      appBridgeCallbackEvent: ({ onEvent, onError, options }) => appsInTossEvent.addEventListener("appBridgeCallbackEvent", { onEvent, onError, options }),
      /** AdMob */
      loadAdMobInterstitialAd: GoogleAdMob2.loadAdMobInterstitialAd,
      showAdMobInterstitialAd: GoogleAdMob2.showAdMobInterstitialAd,
      loadAdMobRewardedAd: GoogleAdMob2.loadAdMobRewardedAd,
      showAdMobRewardedAd: GoogleAdMob2.showAdMobRewardedAd,
      /** AdMobV2 */
      loadAppsInTossAdMob: GoogleAdMob2.loadAppsInTossAdMob,
      showAppsInTossAdMob: GoogleAdMob2.showAppsInTossAdMob,
      /** IntegratedAd */
      loadFullScreenAd: loadFullScreenAdForWeb,
      showFullScreenAd,
      /** TossAd */
      fetchTossAd,
      /** IAP */
      iapCreateOneTimePurchaseOrder: IAP.createOneTimePurchaseOrder,
      requestOneTimePurchase
    },
    constantHandlerMap: {
      ...appsInTossConstantBridges,
      getSafeAreaTop: () => top,
      getSafeAreaBottom: () => bottom,
      getSafeAreaLeft: () => insets.left,
      getSafeAreaRight: () => insets.right,
      ...Object.fromEntries(Object.entries(global2).map(([key, value]) => [key, () => value])),
      /** AdMob */
      loadAdMobInterstitialAd_isSupported: GoogleAdMob2.loadAdMobInterstitialAd.isSupported,
      showAdMobInterstitialAd_isSupported: GoogleAdMob2.showAdMobInterstitialAd.isSupported,
      loadAdMobRewardedAd_isSupported: GoogleAdMob2.loadAdMobRewardedAd.isSupported,
      showAdMobRewardedAd_isSupported: GoogleAdMob2.showAdMobRewardedAd.isSupported,
      /** AdMobV2 */
      loadAppsInTossAdMob_isSupported: GoogleAdMob2.loadAppsInTossAdMob.isSupported,
      showAppsInTossAdMob_isSupported: GoogleAdMob2.showAppsInTossAdMob.isSupported,
      /** IntegratedAd */
      loadFullScreenAd_isSupported: loadFullScreenAdForWeb.isSupported,
      showFullScreenAd_isSupported: showFullScreenAd.isSupported,
      /** TossAd */
      fetchTossAd_isSupported: fetchTossAd.isSupported,
      /** env */
      getDeploymentId: env.getDeploymentId
    },
    asyncHandlerMap: {
      ...appsInTossAsyncBridges,
      setIosSwipeGestureEnabled: (options) => {
        setAllowsBackForwardNavigationGestures(options.isEnabled);
        return appsInTossAsyncBridges.setIosSwipeGestureEnabled(options);
      },
      addAccessoryButton: async (params) => navigationBarContext.addNavigationRightButton(params),
      removeAccessoryButton: async () => navigationBarContext.removeNavigationRightButton(),
      /** permissions */
      requestPermission: appsInTossAsyncBridges.requestPermission,
      openPermissionDialog: appsInTossAsyncBridges.openPermissionDialog,
      getPermission: appsInTossAsyncBridges.getPermission,
      getClipboardText: appsInTossAsyncBridges.getClipboardText,
      setClipboardText: appsInTossAsyncBridges.setClipboardText,
      fetchAlbumPhotos: appsInTossAsyncBridges.fetchAlbumPhotos,
      fetchContacts: appsInTossAsyncBridges.fetchContacts,
      getCurrentLocation: appsInTossAsyncBridges.getCurrentLocation,
      openCamera: appsInTossAsyncBridges.openCamera,
      /** Storage */
      getStorageItem: Storage.getItem,
      setStorageItem: Storage.setItem,
      removeStorageItem: Storage.removeItem,
      clearItems: Storage.clearItems,
      /** IAP */
      iapGetProductItemList: IAP.getProductItemList,
      iapCreateOneTimePurchaseOrder,
      processProductGrant,
      getPendingOrders: IAP.getPendingOrders,
      getCompletedOrRefundedOrders: IAP.getCompletedOrRefundedOrders,
      completeProductGrant: IAP.completeProductGrant,
      /** Toss Ads */
      tossAdEventLog,
      /** Private */
      memoryDebugLog: webViewMemoryDebugLog
    }
  });
  const headerPropForExternalWebView = useMemo7(() => {
    const parsedNavigationBar = global2.navigationBar != null ? safeParseNavigationBar(global2.navigationBar) : null;
    const initialAccessoryButton = parsedNavigationBar?.initialAccessoryButton;
    const withBackButton = parsedNavigationBar?.withBackButton ?? true;
    if (type === "external" && initialAccessoryButton != null) {
      return {
        header: {
          withBackButton,
          title: initialAccessoryButton.title,
          icon: initialAccessoryButton.icon
        }
      };
    }
    return {};
  }, [global2.navigationBar, type]);
  const BaseWebView = WEBVIEW_TYPES[type];
  const webViewDebuggingEnabled = operationalEnvironment === "sandbox";
  const userAgent = useCreateUserAgent({
    colorPreference: "light"
  });
  const refs = mergeRefs(handler.ref, webViewRef);
  useEffect13(() => {
    const callback = () => {
      webBackHandler.handleWebBack();
      return true;
    };
    BackHandler2.addEventListener("hardwareBackPress", callback);
    return () => BackHandler2.removeEventListener("hardwareBackPress", callback);
  }, [webBackHandler]);
  const globalScripts = useGlobalScripts();
  const handleWebViewProcessDidTerminate = useHandleWebViewProcessDidTerminate(webViewRef);
  return /* @__PURE__ */ jsx18(
    BaseWebView,
    {
      ref: refs,
      ...props,
      ...headerPropForExternalWebView,
      source: {
        uri,
        // NOTE: https://github.com/react-native-webview/react-native-webview/pull/3133
        headers: {
          "User-Agent": userAgent
        }
      },
      onHomeButtonClick: webBackHandler.handleWebHome,
      onBackButtonClick: webBackHandler.handleWebBack,
      onNavigationStateChange: (event) => {
        if (event.url) {
          trackScreen(event.url);
        }
        props.onNavigationStateChange?.(event);
        webBackHandler.onNavigationStateChange(event);
      },
      userAgent: Platform6.OS === "ios" ? userAgent : void 0,
      sharedCookiesEnabled: true,
      webviewDebuggingEnabled: webViewDebuggingEnabled,
      thirdPartyCookiesEnabled: true,
      onMessage: handler.onMessage,
      injectedJavaScript: globalScripts.afterLoad,
      injectedJavaScriptBeforeContentLoaded: mergeScripts(handler.injectedJavaScript, globalScripts.beforeLoad),
      decelerationRate: Platform6.OS === "ios" ? 1 : void 0,
      allowsBackForwardNavigationGestures,
      onShouldStartLoadWithRequest: (event) => {
        try {
          const url = new URL(event.url);
          if (["https:", "http:"].includes(url.protocol)) {
            return true;
          } else {
            Linking.openURL(convertIntentURL(url) ?? url.href);
            return false;
          }
        } catch (error) {
          console.error(error);
          return false;
        }
      },
      originWhitelist: [
        "https://*",
        "http://*",
        "intoss://*",
        "intoss-private://*",
        "servicetoss://*",
        "supertoss://*",
        "intent://*"
      ],
      onContentProcessDidTerminate: handleWebViewProcessDidTerminate,
      onRenderProcessGone: handleWebViewProcessDidTerminate
    }
  );
}
function useGlobalScripts() {
  const global2 = getAppsInTossGlobals();
  const disableTextSelectionCSS = `
    const style = document.createElement('style');
    style.textContent = '*:not(input):not(textarea) { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; -webkit-touch-callout: none; }';
    document.head.appendChild(style);
  `;
  const applyGameResourcesCache = `
    (function () {
      if (typeof caches === 'undefined') {
        return;
      }
      const cacheKeyPrefix = '@apps-in-toss/caches/';
      const cacheKey = \`\${cacheKeyPrefix}${global2.deploymentId}\`;
      window.addEventListener('load', async () => {
        const keys = await caches.keys();
        for (const key of keys) {
          if (key.startsWith(cacheKeyPrefix) && key !== cacheKey) {
            await caches.delete(key);
          }
        }
      });
      window.fetch = new Proxy(window.fetch, {
        async apply(originalFetch, thisArg, args) {
          const request = new Request(args[0], args[1]);
          if (!/\\.(data|wasm|framework\\.js)(?:\\.gz|\\.br|\\.unityweb)?$/.test(request.url)) {
            return await originalFetch.call(thisArg, request);
          }
          const cache = await caches.open(cacheKey);
          const cached = await cache.match(request);
          if (cached) {
            const eTag = cached.headers.get('ETag');
            const lastModified = cached.headers.get('Last-Modified');
            if (eTag) {
              request.headers.set('If-None-Match', eTag);
            }
            if (lastModified) {
              request.headers.set('If-Modified-Since', lastModified);
            }
            const revalidated = await originalFetch.call(thisArg, request);
            if (revalidated.status === 304) {
              return cached;
            }
            cache.put(request, revalidated.clone());
            return revalidated;
          }
          const response = await originalFetch.call(thisArg, request);
          cache.put(request, response.clone());
          return response;
        },
      });
    })();
  `;
  return {
    beforeLoad: mergeScripts(global2.webViewType === "game" && applyGameResourcesCache),
    afterLoad: mergeScripts(disableTextSelectionCSS)
  };
}
function mergeScripts(...scripts) {
  return scripts.filter((script) => typeof script === "string").join("\n");
}

// src/index.ts
export * from "@apps-in-toss/analytics";
import { useOverlay as useOverlay3, OverlayProvider } from "@toss/tds-react-native/private";
export * from "@apps-in-toss/native-modules";
export * from "@apps-in-toss/types";
var Analytics2 = {
  init: InternalAnalytics.init,
  Impression: InternalAnalytics.Impression,
  Press: InternalAnalytics.Press,
  Area: InternalAnalytics.Area
};
export {
  Analytics2 as Analytics,
  AppsInToss,
  INTERNAL__onVisibilityChangedByTransparentServiceWeb,
  OverlayProvider,
  WebView,
  env,
  loadFullScreenAd,
  showFullScreenAd,
  useCreateUserAgent,
  useGeolocation,
  useOverlay3 as useOverlay,
  useTopNavigation,
  useWaitForReturnNavigator
};
