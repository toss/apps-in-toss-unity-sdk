"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FixedFloatingDropdown=FixedFloatingDropdown;const jsx_runtime_1=require("react/jsx-runtime"),tds_easings_1=require("@toss/tds-easings"),react_1=require("react"),react_native_1=require("react-native"),core_1=require("../../../core"),rally_1=require("../../../interactions/rally"),z_index_1=require("../constants/z-index"),DropdownContext_1=require("../contexts/DropdownContext"),mergeRefs_1=require("../utils/mergeRefs");function FixedFloatingDropdown({children:s,onOpen:f,onClose:n,open:o,dropdown:c,containerStyle:r}){const{placement:g}=(0,DropdownContext_1.useDropdown)(),i=(0,react_1.useRef)(null),d=(0,react_1.useRef)(null),l=(0,react_1.useRef)(null),x=s.ref,R=(0,react_1.cloneElement)(s,{...s.props,ref:x!=null?(0,mergeRefs_1.mergeRefs)(x,i):i,onPress:()=>{o?n?.():f?.(),s.props?.onPress?.()}}),m=(0,core_1.useGlobalEvent)();(0,react_1.useEffect)(()=>{const t=a=>{const e=a.nativeEvent.pageX,u=a.nativeEvent.pageY;l?.current&&l.current.measure((v,y,p,w,E,_)=>{e>=E&&e<=E+p&&u>=_&&u<=_+w||n?.()})};return m.addEventListener("touchEnd",t),()=>{m.removeEventListener("touchEnd",t)}},[l,m,n,i]);const h=(0,core_1.useOverlay)();return(0,react_1.useEffect)(()=>{if(!o){h.close();return}i.current==null||d.current==null||i.current.measure((...t)=>{d.current?.measure((...a)=>{const e={x:0,y:1,width:2,height:3,pageX:4,pageY:5};h.open(({isOpen:u,exit:v,close:y})=>{const p=g==="bottom-start"?{top:(t[e.pageY]??0)+(t[e.height]??0),left:t[e.pageX]}:{top:(t[e.pageY]??0)+(t[e.height]??0),left:(t[e.pageX]??0)+(t[e.width]??0)-(a[e.width]??0)};return(0,jsx_runtime_1.jsx)(react_native_1.Pressable,{onPress:()=>{y(),n?.()},style:[{flex:1,position:"absolute",width:"100%",height:"100%",zIndex:z_index_1.MENU_Z_INDEX},r],children:(0,jsx_runtime_1.jsx)(rally_1.AnimateRallyPresence,{onExitEnd:v,children:u?(0,jsx_runtime_1.jsx)(FloatingOverlay,{ref:l,style:[p],placement:g,children:c}):void 0})})})})})},[o]),(0,jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment,{children:[R,(0,jsx_runtime_1.jsx)(react_native_1.View,{ref:d,style:{opacity:0,position:"absolute",zIndex:-1},pointerEvents:"none",accessibilityElementsHidden:!0,importantForAccessibility:"no-hide-descendants",children:c})]})}const FloatingOverlay=(0,react_1.forwardRef)(function({style:f,children:n,placement:o},c){const r=o==="bottom-start"?"left":"right";return(0,jsx_runtime_1.jsx)(rally_1.Rally,{ref:c,style:[{zIndex:9e3,position:"absolute"},f],exit:{opacity:{from:1,to:0},scale:{from:1,to:0},transformOriginX:{from:r,to:r},transformOriginY:{from:"top",to:"top"},easing:tds_easings_1.spring.medium},motion:{opacity:{from:0,to:1},scale:{from:0,to:1},transformOriginX:{from:r,to:r},transformOriginY:{from:"top",to:"top"},easing:tds_easings_1.spring.medium},children:n})});
