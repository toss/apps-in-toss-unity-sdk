"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Trigger=Trigger;const jsx_runtime_1=require("react/jsx-runtime"),tds_easings_1=require("@toss/tds-easings"),react_1=require("react"),react_native_1=require("react-native"),core_1=require("../../../core"),rally_1=require("../../../interactions/rally"),z_index_1=require("../constants/z-index"),DropdownContext_1=require("../contexts/DropdownContext"),mergeRefs_1=require("../utils/mergeRefs"),FixedFloatingDropdown_1=require("./FixedFloatingDropdown");function ControlledTrigger({children:e,placement:t="bottom-start",strategy:r="absolute",...n}){const o=r==="fixed"?FixedFloatingDropdown_1.FixedFloatingDropdown:AbsoluteFloatingDropdown;return(0,jsx_runtime_1.jsx)(DropdownContext_1.DropdownProvider,{placement:t,children:(0,jsx_runtime_1.jsx)(o,{...n,children:e})})}function AbsoluteFloatingDropdown({children:e,onOpen:t,onClose:r,open:n,dropdown:o,containerStyle:l}){const{targetRef:i,dropdownBaseRef:a}=(0,DropdownContext_1.useDropdown)(),u=e.ref,d=(0,react_1.cloneElement)(e,{...e.props,ref:u!=null?(0,mergeRefs_1.mergeRefs)(u,i):i,onPress:()=>{n?r?.():t?.(),e.props?.onPress?.()}}),s=(0,core_1.useGlobalEvent)();return(0,react_1.useEffect)(()=>{const f=(c,g)=>{a?.current==null||c.target==null||!g&&!isInsideComponent(c.target,a.current)&&!isInsideComponent(c.target,i?.current)&&r?.()};return s.addEventListener("touchEnd",f),()=>{s.removeEventListener("touchEnd",f)}},[a,s,r,i]),(0,jsx_runtime_1.jsxs)(react_native_1.View,{style:[{position:"relative",zIndex:z_index_1.MENU_Z_INDEX},l],children:[d,(0,jsx_runtime_1.jsx)(rally_1.AnimateRallyPresence,{children:n?(0,jsx_runtime_1.jsx)(FloatingOverlay,{children:o}):void 0})]})}function FloatingOverlay({style:e,children:t,...r}){const{targetRef:n,dropdownBaseRef:o,placement:l}=(0,DropdownContext_1.useDropdown)(),[i,a]=(0,react_1.useState)(null),[u,d]=(0,react_1.useState)(null);if((0,react_1.useEffect)(()=>{n?.current!=null&&o?.current!=null&&n.current.measureInWindow((f,c,g,p)=>{o?.current?.measureInWindow((x,h,m,_)=>{a({width:g,height:p}),d({width:m,height:_})})})},[o,n]),u==null||i==null)return(0,jsx_runtime_1.jsx)(react_native_1.View,{style:{opacity:0,position:"absolute",alignSelf:"flex-start"},children:t});const s=l==="bottom-start"?"left":"right";return(0,jsx_runtime_1.jsx)(jsx_runtime_1.Fragment,{children:(0,jsx_runtime_1.jsx)(rally_1.Rally,{style:[{zIndex:9e3,position:"absolute",top:i.height},l==="bottom-start"?{left:0}:{right:0},e],exit:{opacity:{from:1,to:0},scale:{from:1,to:0},transformOriginX:{from:s,to:s},transformOriginY:{from:"top",to:"top"},easing:tds_easings_1.spring.medium},motion:{opacity:{from:0,to:1},scale:{from:0,to:1},transformOriginX:{from:s,to:s},transformOriginY:{from:"top",to:"top"},easing:tds_easings_1.spring.medium},...r,children:t})})}function UnControlledTrigger({defaultOpen:e=!1,onOpen:t,onClose:r,...n}){const[o,l]=(0,react_1.useState)(e),i=(0,react_1.useCallback)(()=>{t?.(),l(!0)},[t]),a=(0,react_1.useCallback)(()=>{r?.(),l(!1)},[r]);return(0,jsx_runtime_1.jsx)(ControlledTrigger,{open:o,onOpen:i,onClose:a,...n})}function Trigger(e){return e.open!=null?(0,jsx_runtime_1.jsx)(ControlledTrigger,{...e}):(0,jsx_runtime_1.jsx)(UnControlledTrigger,{...e})}Trigger.zIndex=z_index_1.MENU_Z_INDEX;const isInsideComponent=(e,t)=>{if(e&&t&&e._nativeTag===t._nativeTag)return!0;if(t._children&&t._children.length>0){for(let r=0;r<=t._children.length-1;r++)if(isInsideComponent(e,t._children[r]))return!0}return!1};
