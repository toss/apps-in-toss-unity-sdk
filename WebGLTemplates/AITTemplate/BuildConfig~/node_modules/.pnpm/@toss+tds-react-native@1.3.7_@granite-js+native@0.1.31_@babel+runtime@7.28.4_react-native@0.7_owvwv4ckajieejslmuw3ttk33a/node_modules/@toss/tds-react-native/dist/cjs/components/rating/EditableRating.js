"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EditableRating=void 0;const jsx_runtime_1=require("react/jsx-runtime"),react_native_svg_1=require("@granite-js/native/react-native-svg"),tds_easings_1=require("@toss/tds-easings"),react_1=require("react"),react_native_1=require("react-native"),core_1=require("../../core"),animated_1=require("../../interactions/animated"),generateHapticFeedback_1=require("../../native/generateHapticFeedback"),private_1=require("../icon/private"),useA11yMode_1=require("./useA11yMode"),AnimatedIcon=animated_1.Animated.createAnimatedComponent(private_1.SvgIcon),EditableRatingItem=(0,react_1.forwardRef)(function({size:r,name:v,active:y,disabledColor:i,idleColor:A,activeColor:c,disabled:M,forwardedRef:h,style:p,...R},k){const a=(0,react_1.useRef)(new animated_1.Animated.Value(1)).current,o=(0,react_1.useRef)(new animated_1.Animated.Value(0)).current,f=(0,react_1.useRef)(new animated_1.Animated.Value(1)).current,l=(0,react_1.useRef)(new animated_1.Animated.Value(0)).current,u=(0,react_1.useRef)(new animated_1.Animated.Value(y?1:0)).current,w=u.interpolate({inputRange:[0,1],outputRange:[A,c]});(0,react_1.useEffect)(()=>{animated_1.Animated.spring(u,{toValue:y?1:0,useNativeDriver:!1,...tds_easings_1.spring.rapid}).start()},[y,u]);const d=(0,react_1.useCallback)(()=>{a.setValue(1),animated_1.Animated.sequence([animated_1.Animated.spring(a,{toValue:1.1,useNativeDriver:!1,...tds_easings_1.spring.rapid}),animated_1.Animated.spring(a,{toValue:1,useNativeDriver:!1,...tds_easings_1.spring.quick})]).start()},[a]),g=(0,react_1.useCallback)(()=>{a.setValue(1),animated_1.Animated.spring(a,{toValue:.9,useNativeDriver:!1,...tds_easings_1.spring.rapid}).start()},[a]),V=(0,react_1.useCallback)(()=>{animated_1.Animated.spring(u,{toValue:0,useNativeDriver:!1,...tds_easings_1.spring.rapid}).start(),animated_1.Animated.spring(l,{toValue:0,useNativeDriver:!1,...tds_easings_1.spring.quick}).start()},[u,l]),x=(0,react_1.useCallback)(()=>{animated_1.Animated.spring(l,{toValue:1,useNativeDriver:!1,...tds_easings_1.spring.rapid}).start(),animated_1.Animated.spring(u,{toValue:1,useNativeDriver:!1,...tds_easings_1.spring.rapid}).start()},[u,l]),S=(0,react_1.useCallback)(()=>{animated_1.Animated.spring(o,{toValue:0,useNativeDriver:!1,...tds_easings_1.spring.quick}).start()},[o]),m=(0,react_1.useCallback)(()=>{f.setValue(1),animated_1.Animated.sequence([animated_1.Animated.spring(f,{toValue:1.1,useNativeDriver:!1,...tds_easings_1.spring.rapid}),animated_1.Animated.spring(f,{toValue:1,useNativeDriver:!1,...tds_easings_1.spring.quick})]).start(),animated_1.Animated.sequence([animated_1.Animated.spring(o,{toValue:.5,useNativeDriver:!1,...tds_easings_1.spring.rapid}),animated_1.Animated.spring(o,{toValue:0,useNativeDriver:!1,...tds_easings_1.spring.quick})]).start(),animated_1.Animated.spring(l,{toValue:0,useNativeDriver:!1,...tds_easings_1.spring.quick}).start()},[f,o,l]);return(0,react_1.useImperativeHandle)(k,()=>({expandMotion:d,shrinkMotion:g,activeMotion:x,inactiveMotion:V,touchDownMotion:S,touchUpMotion:m}),[x,d,V,g,S,m]),y&&M?(0,jsx_runtime_1.jsx)(react_native_1.View,{ref:h,pointerEvents:"none",style:[{opacity:.3},p],...R,children:(0,jsx_runtime_1.jsx)(AnimatedIcon,{name:v,size:r,color:c})}):M?(0,jsx_runtime_1.jsx)(react_native_1.View,{ref:h,pointerEvents:"none",style:p,...R,children:(0,jsx_runtime_1.jsx)(private_1.SvgIcon,{name:v,size:r,color:i})}):(0,jsx_runtime_1.jsxs)(animated_1.Animated.View,{ref:h,pointerEvents:"none",style:[Position.relative,{transform:[{scale:a}]},p],...R,children:[(0,jsx_runtime_1.jsx)(animated_1.Animated.View,{style:[ZIndex[1],Position.overlap,{opacity:o,width:r,height:r,transform:[{scale:f}]}],children:(0,jsx_runtime_1.jsxs)(react_native_svg_1.Svg,{height:r,width:r,children:[(0,jsx_runtime_1.jsx)(react_native_svg_1.Defs,{children:(0,jsx_runtime_1.jsxs)(react_native_svg_1.RadialGradient,{id:"grad",cx:"50%",cy:"50%",rx:"50%",ry:"50%",fx:"50%",fy:"50%",children:[(0,jsx_runtime_1.jsx)(react_native_svg_1.Stop,{offset:"0%",stopColor:c,stopOpacity:"1"}),(0,jsx_runtime_1.jsx)(react_native_svg_1.Stop,{offset:"100%",stopColor:c,stopOpacity:"0"})]})}),(0,jsx_runtime_1.jsx)(react_native_svg_1.Circle,{cx:r/2,cy:r/2,r:r/2,fill:"url(#grad)"})]})}),(0,jsx_runtime_1.jsx)(AnimatedIcon,{name:v,size:r,color:w,style:ZIndex[2]}),(0,jsx_runtime_1.jsx)(AnimatedIcon,{name:v,size:r,color:"rgba(0,0,0,0.1)",style:[ZIndex[3],Position.overlap,{opacity:l}]})]})}),GapBySize={medium:8,large:6,big:4},ItemSizeBySize={medium:24,large:32,big:40};exports.EditableRating=(0,react_1.forwardRef)(function({max:b=5,size:r="large",gap:v=GapBySize[r],activeColor:y,value:i,onValueChange:A,disabled:c=!1,style:M,accessibilityLabel:h="\uBCC4\uC810\uD3C9\uAC00",accessibilityValueText:p=`${b}\uC810 \uB9CC\uC810 \uC911 ${i}\uC810`,...R},k){const a=(0,useA11yMode_1.useScreenReaderMode)(),o=(0,core_1.useAdaptive)(),f=y??o.yellow400,l=o.greyOpacity200,u=o.greyOpacity100,w="icon-star-mono",d=(0,react_1.useRef)([]),g=(0,react_1.useRef)([]).current,V=ItemSizeBySize[r],x=(0,react_1.useRef)(i);x.current=i;const S=(t,e)=>{const{x:n,width:s}=t.nativeEvent.layout;g[e]={x:n,width:s}},m=(0,react_1.useCallback)(t=>{const{locationX:e}=t.nativeEvent;let n=0;for(let s=0;s<g.length;s++){const{x:C,width:q}=g[s];if(e>=C&&e<=C+q){n=s+1;break}else e>C+q?n=s+1:e<0&&(n=0)}return n},[g]),j=(0,react_1.useCallback)(t=>{const e=m(t);A?.(e),d.current.forEach((n,s)=>{s<e?n.activeMotion():n.inactiveMotion()})},[m,A]),D=(0,react_1.useCallback)(t=>{j(t),(0,generateHapticFeedback_1.generateHapticFeedback)({type:"tickMedium"});const e=m(t);d.current.forEach((n,s)=>{n.shrinkMotion(),s<e&&n.touchDownMotion()})},[m,j]),E=(0,react_1.useCallback)(()=>{d.current.forEach((t,e)=>{t.expandMotion(),e<x.current&&t.touchUpMotion()})},[]),_=(0,react_1.useRef)(react_native_1.PanResponder.create({onStartShouldSetPanResponder:()=>!0,onPanResponderGrant:D,onPanResponderMove:j,onPanResponderRelease:E,onPanResponderTerminate:E})).current,I={accessibilityRole:"text","aria-disabled":c,accessibilityHint:"\uBCC0\uACBD\uD560 \uC218 \uC5C6\uC5B4\uC694"},N={accessibilityRole:"adjustable",accessibilityActions:[{name:"increment",label:"\uBCC4\uC810 \uC62C\uB9AC\uAE30"},{name:"decrement",label:"\uBCC4\uC810 \uB0B4\uB9AC\uAE30"}],onAccessibilityAction:t=>{let e;switch(t.nativeEvent.actionName){case"increment":e=i!==b?i+1:i;break;case"decrement":e=i!==0?i-1:i;break;default:e=i;break}react_native_1.AccessibilityInfo.announceForAccessibility?.(`${e}\uC810\uC774 \uC120\uD0DD\uB418\uC5C8\uC2B5\uB2C8\uB2E4`),A?.(e)}};return(0,react_1.useEffect)(()=>{a&&d.current.forEach((t,e)=>{e<i?(t.activeMotion(),t.touchUpMotion()):t.inactiveMotion()})},[a,i]),(0,jsx_runtime_1.jsx)(react_native_1.View,{ref:k,accessible:!0,accessibilityLabel:h,accessibilityValue:{text:typeof p=="function"?p(b,i):p},...c?I:N,...c||a?{}:_.panHandlers,style:[Flex.rowCenter,{gap:v},M],testID:"rating",...R,children:Array.from({length:b},(t,e)=>(0,jsx_runtime_1.jsx)(EditableRatingItem,{ref:n=>{n&&(d.current[e]=n)},forwardedRef:k,size:V,onLayout:n=>S(n,e),active:e<i,activeColor:f,idleColor:l,disabledColor:u,disabled:c,name:w},e))})});const Position=react_native_1.StyleSheet.create({relative:{position:"relative"},overlap:{position:"absolute",top:0,left:0}}),ZIndex=react_native_1.StyleSheet.create({1:{zIndex:1},2:{zIndex:2},3:{zIndex:3}}),Flex=react_native_1.StyleSheet.create({rowCenter:{flexDirection:"row",alignItems:"center"}});
