"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(r,e,o,t){t===void 0&&(t=o);var n=Object.getOwnPropertyDescriptor(e,o);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[o]}}),Object.defineProperty(r,t,n)}:function(r,e,o,t){t===void 0&&(t=o),r[t]=e[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),__importStar=this&&this.__importStar||function(){var r=function(e){return r=Object.getOwnPropertyNames||function(o){var t=[];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[t.length]=n);return t},r(e)};return function(e){if(e&&e.__esModule)return e;var o={};if(e!=null)for(var t=r(e),n=0;n<t.length;n++)t[n]!=="default"&&__createBinding(o,e,t[n]);return __setModuleDefault(o,e),o}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.FloatingTooltip=void 0;const jsx_runtime_1=require("react/jsx-runtime"),rally_1=require("../../../../interactions/rally"),core_1=require("../../../../core"),Paragraph=__importStar(require("../../../paragraph")),react_1=require("react"),react_native_1=require("react-native"),TooltipContext_1=require("../../contexts/TooltipContext"),useAnchorPosition_1=require("../../hooks/useAnchorPosition"),useOnPressOutside_1=require("../../hooks/useOnPressOutside"),mergeRefs_1=require("../../utils/mergeRefs"),Anchor_1=require("./Anchor"),TooltipBase_1=require("./TooltipBase");function measure(r){return new Promise(e=>{r.measure((o,t,n,s)=>{e({width:n,height:s})})})}exports.FloatingTooltip=(0,react_1.forwardRef)(function({open:e,children:o,...t},n){const{targetRef:s}=(0,TooltipContext_1.useTooltip)(),a=o.ref,l=(0,react_1.cloneElement)(o,{...o.props,collapsable:!1,onPress:()=>{t.onChildrenPress?.(),o.props?.onPress?.()},ref:a!=null?(0,mergeRefs_1.mergeRefs)(a,s):s});return(0,jsx_runtime_1.jsxs)(react_native_1.View,{style:{position:"relative",zIndex:9e3},children:[l,(0,jsx_runtime_1.jsx)(rally_1.AnimateRallyPresence,{children:e&&(0,jsx_runtime_1.jsx)(react_native_1.View,{style:[react_native_1.StyleSheet.absoluteFill,{width:react_native_1.Dimensions.get("window").width}],pointerEvents:"box-none",children:(0,jsx_runtime_1.jsx)(FloatingTooltipContent,{ref:n,...t})})})]})});const FloatingTooltipContent=(0,react_1.forwardRef)(function({message:e,messageAlign:o,placement:t,contentPositionByRatio:n,size:s="medium",motion:a,onPress:l,onPressOutside:P},b){const c=(0,react_1.useRef)(null),p=(0,core_1.useAdaptive)(),{targetRef:g,offset:u}=(0,TooltipContext_1.useTooltip)(),[f,w]=(0,react_1.useState)(null),[h,x]=(0,react_1.useState)(null),i=(0,react_1.useMemo)(()=>(0,TooltipBase_1.getTooltipStyle)(s),[s]),v=(0,mergeRefs_1.mergeRefs)(b,c),j=(0,useAnchorPosition_1.useAnchorPosition)({anchorPositionByRatio:n,anchorWidth:i.anchorWidth,tooltipWidth:h?.width??0,size:s});return(0,useOnPressOutside_1.useOnPressOutside)({ref:c,onPressOutside:P}),(0,react_1.useEffect)(()=>{function d(){const _=g?.current,y=c.current;_!=null&&y!=null&&u!=null&&(async()=>{const{width:m,height:O}=await measure(_),{width:R,height:T}=await measure(y),q=m/2-R/2,A=t==="top"?-T-u-i.anchorHeight:O+i.anchorHeight+u;w({left:q,top:A})})()}requestAnimationFrame(()=>{d()})},[g,t,i,u]),f==null||h==null?(0,jsx_runtime_1.jsx)(react_native_1.Pressable,{ref:v,collapsable:!1,pointerEvents:"box-only",style:{opacity:0,position:"absolute",backgroundColor:p.floatBackground,borderRadius:i.borderRadius,paddingHorizontal:i.paddingHorizontal/2,paddingVertical:i.paddingVertical/2},onLayout:d=>{x(d.nativeEvent.layout)},onPress:l,children:(0,jsx_runtime_1.jsxs)(react_native_1.View,{children:[(0,jsx_runtime_1.jsx)(react_native_1.View,{style:{position:"absolute",width:i.anchorWidth,height:i.anchorHeight},children:(0,jsx_runtime_1.jsx)(Anchor_1.Anchor,{size:s})}),(0,jsx_runtime_1.jsx)(Paragraph.Text,{typography:i.typography,color:p.grey800,fontWeight:i.fontWeight,children:e})]})}):(0,jsx_runtime_1.jsx)(TooltipBase_1.TooltipBase,{ref:c,size:s,placement:t,messageAlign:o,message:e,motion:a,left:f.left,top:f.top,contentHeight:h.height,anchorMarginLeft:j,onPress:l})});
