"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bridge=Bridge;const jsx_runtime_1=require("react/jsx-runtime"),tds_easings_1=require("@toss/tds-easings"),es_hangul_1=require("es-hangul"),react_1=require("react"),react_native_1=require("react-native"),usePreservedCallback_1=require("../../components/bottom-sheet/utils/usePreservedCallback"),gradient_1=require("../../components/gradient"),txt_1=require("../../components/txt"),ThemeProvider_1=require("../../core/theme/ThemeProvider"),Animated_1=require("../../interactions/animated/Animated"),components_1=require("./components"),utils_1=require("./utils"),BRIDGE_TOUCHABLE_DELAY=600,BRIDGE_CLOSE_DELAY=400;function Bridge({style:i,icon:d,open:a,colorMode:c="basic",onClose:r,onExited:u,variant:p,serviceName:s,amount:n,...g}){const{token:e}=(0,ThemeProvider_1.useTheme)(),l=c==="basic",b=(0,usePreservedCallback_1.usePreservedCallback)(r??noop),C=(0,usePreservedCallback_1.usePreservedCallback)(u??noop),[v,x]=(0,react_1.useState)(!1),f=(0,react_1.useRef)(null),A=(0,react_1.useCallback)(()=>{f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{b?.(),f.current=null},BRIDGE_CLOSE_DELAY)},[b]);(0,react_1.useEffect)(()=>()=>{f.current&&clearTimeout(f.current)},[]),(0,react_1.useEffect)(()=>{const o=setTimeout(()=>{x(!0)},BRIDGE_TOUCHABLE_DELAY);return()=>{clearTimeout(o)}},[]);const m={large:412.5,small:375},t=useBridgeAnimation();(0,react_1.useEffect)(()=>{if(a)return t.controller.open().start(),()=>{b?.(),t.controller.close().start(()=>{C?.()})}},[t.controller,b,C,a]);const G=p==="point"?[{type:"strong",text:s},{type:"default",text:es_hangul_1.josa.pick(s,"\uC73C\uB85C/\uB85C")+` \uC774\uB3D9\uD558\uACE0
`},{type:"strong",text:`${n.toLocaleString()}\uC6D0`},{type:"default",text:" \uBC1B\uC558\uC5B4\uC694"}]:[{type:"strong",text:s},{type:"default",text:es_hangul_1.josa.pick(s,"\uC73C\uB85C/\uB85C")+" \uC774\uB3D9\uD588\uC5B4\uC694"}],[y,V]=(0,react_1.useState)(null),[h,T]=(0,react_1.useState)(null),[j,S]=(0,react_1.useState)(0),w=(0,react_1.useCallback)(o=>{V((0,utils_1.getCenterOffset)(o.nativeEvent.layout))},[]),D=(0,react_1.useCallback)(o=>{T((0,utils_1.getCenterOffset)(o.nativeEvent.layout))},[]);return(0,react_1.useLayoutEffect)(()=>{y===null||h===null||S(y.y-h.y)},[h,y]),(0,jsx_runtime_1.jsxs)(react_native_1.Pressable,{style:[styles.fullCover,{zIndex:10},i],disabled:!v,onPress:A,...g,children:[(0,jsx_runtime_1.jsx)(react_native_1.View,{style:{flex:1,paddingTop:react_native_1.Platform.select({ios:103,android:56,default:56}),zIndex:1},children:(0,jsx_runtime_1.jsxs)(Animated_1.Animated.View,{style:[{flexDirection:"column",gap:16,paddingHorizontal:20,alignItems:"center"}],onLayout:w,children:[(0,jsx_runtime_1.jsx)(components_1.NestedShadow,{shadows:l?[{offset:{x:0,y:4},opacity:.03,radius:6,color:"#000"},{offset:{x:0,y:10},opacity:.18,radius:16,color:e.bridge.contentLogoShadowColor},{offset:{x:0,y:12},opacity:.52,radius:64,color:e.bridge.contentLogoShadowColor}]:[],children:(0,jsx_runtime_1.jsx)(AnimatedIcon,{...d,style:[styles.iconBorder,t.style.contentLogo]})}),(0,jsx_runtime_1.jsx)(AnimatedText,{style:[{textAlign:"center"},t.style.contentTitle],children:G.map(({type:o,text:E},_)=>(0,jsx_runtime_1.jsx)(txt_1.Text,{typography:"t3",fontWeight:"bold",color:l?o==="strong"?e.bridge.contentTitleStrongColor:e.bridge.contentTitleDefaultColor:o==="strong"?e.bridge.contentTitleStrongInvertedColor:e.bridge.contentTitleDefaultInvertedColor,textAlign:"center",children:E},_))})]})}),(0,jsx_runtime_1.jsx)(react_native_1.View,{style:[styles.fullCover,{height:DeviceHeight}],children:(0,jsx_runtime_1.jsxs)(Animated_1.Animated.View,{style:[styles.center,styles.fullCover,t.style.backgroundGroup],onLayout:D,children:[(0,jsx_runtime_1.jsx)(react_native_1.View,{style:styles.fullCover,children:(0,jsx_runtime_1.jsx)(gradient_1.LinearGradient,{opacity:1,degree:180,colors:l?[e.bridge.baseGradientStartColor,e.bridge.baseGradientStartColor,e.bridge.baseGradientMiddleColor,e.bridge.baseGradientEndColor]:[e.bridge.baseGradientStartInvertedColor,e.bridge.baseGradientStartInvertedColor,e.bridge.baseGradientMiddleInvertedColor,e.bridge.baseGradientEndInvertedColor],positions:[0,.25,.31,1],easing:"linear"})}),(0,jsx_runtime_1.jsx)(react_native_1.View,{style:{width:m.large+135,height:m.large,position:"relative",transform:[{translateY:j}]},children:l&&(0,jsx_runtime_1.jsxs)(Animated_1.Animated.View,{style:[styles.fullCover,{opacity:.02},t.style.radialGradientGroup],children:[(0,jsx_runtime_1.jsx)(Animated_1.Animated.View,{style:[styles.rightCover,{width:m.small,height:m.small},t.style.rightRadialGradient],children:(0,jsx_runtime_1.jsx)(gradient_1.RadialGradient,{colors:[{value:e.bridge.rightRadialGradientColor,opacity:1},{value:e.bridge.rightRadialGradientColor,opacity:0}]})}),(0,jsx_runtime_1.jsx)(Animated_1.Animated.View,{style:[styles.leftCover,{width:m.large,height:m.large},t.style.leftRadialGradient],children:(0,jsx_runtime_1.jsx)(gradient_1.RadialGradient,{colors:[{value:e.bridge.leftRadialGradientColor,opacity:1},{value:e.bridge.leftRadialGradientColor,opacity:0}]})})]})})]})})]})}const styles=react_native_1.StyleSheet.create({fullCover:{position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%"},halfCover:{position:"absolute",top:0,left:0,width:"100%",height:"50%"},leftCover:{position:"absolute",bottom:0,left:0},rightCover:{position:"absolute",bottom:0,right:0},center:{display:"flex",justifyContent:"center",alignItems:"center"},iconBorder:{width:56,height:56,borderWidth:react_native_1.StyleSheet.hairlineWidth,borderRadius:14,borderColor:"rgba(25, 66, 142, 0.12)",borderStyle:"solid",overflow:"hidden"}}),noop=()=>{},DeviceHeight=react_native_1.Dimensions.get("window").height,AnimatedIcon=Animated_1.Animated.createAnimatedComponent(components_1.Icon),AnimatedText=Animated_1.Animated.createAnimatedComponent(txt_1.Text);function useBridgeAnimation(){const i=(0,react_native_1.useAnimatedValue)(0),d=(0,react_native_1.useAnimatedValue)(.5),a=(0,react_native_1.useAnimatedValue)(0),c=(0,react_native_1.useAnimatedValue)(0),r=(0,react_native_1.useAnimatedValue)(0),u=(0,react_native_1.useAnimatedValue)(.6),p=(0,react_native_1.useAnimatedValue)(0),s=(0,react_native_1.useAnimatedValue)(0),n=(0,react_native_1.useAnimatedValue)(0),g=(0,react_native_1.useAnimatedValue)(.7),e=(0,react_1.useCallback)(()=>Animated_1.Animated.parallel([Animated_1.Animated.spring(i,{toValue:1,...tds_easings_1.spring.small,useNativeDriver:!1}),Animated_1.Animated.timing(d,{toValue:1,easing:react_native_1.Easing.bezier(...tds_easings_1.bezier.out),duration:800,useNativeDriver:!1}),Animated_1.Animated.spring(a,{toValue:1,...tds_easings_1.spring.basic,useNativeDriver:!1}),Animated_1.Animated.spring(c,{toValue:1,delay:40,...tds_easings_1.spring.basic,useNativeDriver:!1}),Animated_1.Animated.timing(r,{toValue:1,easing:react_native_1.Easing.bezier(...tds_easings_1.bezier.out),duration:600,useNativeDriver:!1,delay:40}),Animated_1.Animated.spring(u,{toValue:1,stiffness:120,friction:11,useNativeDriver:!1,delay:40}),Animated_1.Animated.timing(n,{toValue:1,easing:react_native_1.Easing.bezier(...tds_easings_1.bezier.out),duration:600,useNativeDriver:!1,delay:80}),Animated_1.Animated.spring(g,{toValue:1,stiffness:120,friction:11,useNativeDriver:!1,delay:80})]),[i,d,a,c,r,u,n,g]),l=(0,react_1.useCallback)(()=>Animated_1.Animated.parallel([Animated_1.Animated.timing(r,{toValue:0,easing:react_native_1.Easing.bezier(...tds_easings_1.bezier.out),duration:500,useNativeDriver:!1}),Animated_1.Animated.timing(n,{toValue:0,easing:react_native_1.Easing.bezier(...tds_easings_1.bezier.out),duration:500,useNativeDriver:!1}),Animated_1.Animated.timing(i,{toValue:0,easing:react_native_1.Easing.bezier(...tds_easings_1.bezier.out),duration:500,useNativeDriver:!1})]),[i,r,n]);return(0,react_1.useMemo)(()=>({style:{backgroundGroup:{opacity:i},radialGradientGroup:{transform:[{scale:d}]},leftRadialGradient:{opacity:a},rightRadialGradient:{opacity:c},contentLogo:{opacity:r,transform:[{translateY:p},{scale:u}]},contentTitle:{opacity:n,transform:[{translateY:s},{scale:g}]}},controller:{open:e,close:l}}),[i,l,r,u,p,n,g,s,a,e,d,c])}
