"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.useRally=useRally;const react_1=require("react"),usePresence_1=require("../contexts/usePresence"),useAnimationController_1=require("./useAnimationController"),useRallyAnimation_1=require("./useRallyAnimation"),usePreservedReference_1=require("./utils/usePreservedReference");function useRally({playOnRender:c,exit:o,motion:u,defaultDuration:l,defaultEasing:f,applyBeforeMountedStyle:y=!0,...R}){const w=(0,usePreservedReference_1.usePreservedReference)(Array.isArray(u)?u:[u]),h=(0,usePreservedReference_1.usePreservedReference)(o??{}),[e,p]=(0,react_1.useState)({width:0,height:0,x:0,y:0}),t=e.width!==0||e.height!==0||e.x!==0||e.y!==0,m=(0,react_1.useCallback)(s=>{t||p(s.nativeEvent.layout)},[t]),{forward:v,backward:P,style:r}=(0,useRallyAnimation_1.useRallyAnimation)({motionInputs:w.map(s=>({easing:f,duration:l,...s})),layout:e}),i=(0,useRallyAnimation_1.useRallyAnimation)({motionInputs:[{easing:f,duration:l,...h}],layout:e}),n=(0,useAnimationController_1.useAnimationController)({forwardAnimation:v,backwardAnimation:P,mounted:t,...R}),{present:a,safeToRemove:d}=(0,usePresence_1.usePresence)({presence:o!==void 0});(0,react_1.useEffect)(()=>{async function s(){!a&&o&&await i.forward.start()&&d?.()}s()},[a,i.forward,d,o]),(0,react_1.useEffect)(()=>{c&&n.play()},[c,n.play,n]);const A=(0,react_1.useMemo)(()=>({...r,opacity:0,transform:[]}),[r]);return(0,react_1.useMemo)(()=>({...n,onLayout:m,style:t||!y?a?r:i.style:A}),[n,m,t,y,a,r,i.style,A])}
