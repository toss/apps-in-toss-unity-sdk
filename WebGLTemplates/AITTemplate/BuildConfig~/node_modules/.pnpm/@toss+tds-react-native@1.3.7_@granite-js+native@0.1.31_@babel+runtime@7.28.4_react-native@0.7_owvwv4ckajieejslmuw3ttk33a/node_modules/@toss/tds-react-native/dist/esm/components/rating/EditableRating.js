"use strict";import{jsx as s,jsxs as G}from"react/jsx-runtime";import{Circle as W,Defs as Y,RadialGradient as T,Stop as $,Svg as ee}from"@granite-js/native/react-native-svg";import{spring as a}from"@toss/tds-easings";import{forwardRef as B,useCallback as u,useEffect as z,useImperativeHandle as te,useRef as v}from"react";import{AccessibilityInfo as ne,PanResponder as re,StyleSheet as j,View as L}from"react-native";import{useAdaptive as oe}from"../../core";import{Animated as t}from"../../interactions/animated";import{generateHapticFeedback as ie}from"../../native/generateHapticFeedback";import{SvgIcon as K}from"../icon/private";import{useScreenReaderMode as ae}from"./useA11yMode";const O=t.createAnimatedComponent(K),se=B(function({size:i,name:R,active:V,disabledColor:o,idleColor:D,activeColor:d,disabled:k,forwardedRef:E,style:g,...S},x){const c=v(new t.Value(1)).current,p=v(new t.Value(0)).current,h=v(new t.Value(1)).current,f=v(new t.Value(0)).current,m=v(new t.Value(V?1:0)).current,C=m.interpolate({inputRange:[0,1],outputRange:[D,d]});z(()=>{t.spring(m,{toValue:V?1:0,useNativeDriver:!1,...a.rapid}).start()},[V,m]);const y=u(()=>{c.setValue(1),t.sequence([t.spring(c,{toValue:1.1,useNativeDriver:!1,...a.rapid}),t.spring(c,{toValue:1,useNativeDriver:!1,...a.quick})]).start()},[c]),b=u(()=>{c.setValue(1),t.spring(c,{toValue:.9,useNativeDriver:!1,...a.rapid}).start()},[c]),N=u(()=>{t.spring(m,{toValue:0,useNativeDriver:!1,...a.rapid}).start(),t.spring(f,{toValue:0,useNativeDriver:!1,...a.quick}).start()},[m,f]),I=u(()=>{t.spring(f,{toValue:1,useNativeDriver:!1,...a.rapid}).start(),t.spring(m,{toValue:1,useNativeDriver:!1,...a.rapid}).start()},[m,f]),A=u(()=>{t.spring(p,{toValue:0,useNativeDriver:!1,...a.quick}).start()},[p]),M=u(()=>{h.setValue(1),t.sequence([t.spring(h,{toValue:1.1,useNativeDriver:!1,...a.rapid}),t.spring(h,{toValue:1,useNativeDriver:!1,...a.quick})]).start(),t.sequence([t.spring(p,{toValue:.5,useNativeDriver:!1,...a.rapid}),t.spring(p,{toValue:0,useNativeDriver:!1,...a.quick})]).start(),t.spring(f,{toValue:0,useNativeDriver:!1,...a.quick}).start()},[h,p,f]);return te(x,()=>({expandMotion:y,shrinkMotion:b,activeMotion:I,inactiveMotion:N,touchDownMotion:A,touchUpMotion:M}),[I,y,N,b,A,M]),V&&k?s(L,{ref:E,pointerEvents:"none",style:[{opacity:.3},g],...S,children:s(O,{name:R,size:i,color:d})}):k?s(L,{ref:E,pointerEvents:"none",style:g,...S,children:s(K,{name:R,size:i,color:o})}):G(t.View,{ref:E,pointerEvents:"none",style:[F.relative,{transform:[{scale:c}]},g],...S,children:[s(t.View,{style:[H[1],F.overlap,{opacity:p,width:i,height:i,transform:[{scale:h}]}],children:G(ee,{height:i,width:i,children:[s(Y,{children:G(T,{id:"grad",cx:"50%",cy:"50%",rx:"50%",ry:"50%",fx:"50%",fy:"50%",children:[s($,{offset:"0%",stopColor:d,stopOpacity:"1"}),s($,{offset:"100%",stopColor:d,stopOpacity:"0"})]})}),s(W,{cx:i/2,cy:i/2,r:i/2,fill:"url(#grad)"})]})}),s(O,{name:R,size:i,color:C,style:H[2]}),s(O,{name:R,size:i,color:"rgba(0,0,0,0.1)",style:[H[3],F.overlap,{opacity:f}]})]})}),ce={medium:8,large:6,big:4},le={medium:24,large:32,big:40};export const EditableRating=B(function({max:w=5,size:i="large",gap:R=ce[i],activeColor:V,value:o,onValueChange:D,disabled:d=!1,style:k,accessibilityLabel:E="\uBCC4\uC810\uD3C9\uAC00",accessibilityValueText:g=`${w}\uC810 \uB9CC\uC810 \uC911 ${o}\uC810`,...S},x){const c=ae(),p=oe(),h=V??p.yellow400,f=p.greyOpacity200,m=p.greyOpacity100,C="icon-star-mono",y=v([]),b=v([]).current,N=le[i],I=v(o);I.current=o;const A=(n,e)=>{const{x:r,width:l}=n.nativeEvent.layout;b[e]={x:r,width:l}},M=u(n=>{const{locationX:e}=n.nativeEvent;let r=0;for(let l=0;l<b.length;l++){const{x:q,width:_}=b[l];if(e>=q&&e<=q+_){r=l+1;break}else e>q+_?r=l+1:e<0&&(r=0)}return r},[b]),P=u(n=>{const e=M(n);D?.(e),y.current.forEach((r,l)=>{l<e?r.activeMotion():r.inactiveMotion()})},[M,D]),X=u(n=>{P(n),ie({type:"tickMedium"});const e=M(n);y.current.forEach((r,l)=>{r.shrinkMotion(),l<e&&r.touchDownMotion()})},[M,P]),U=u(()=>{y.current.forEach((n,e)=>{n.expandMotion(),e<I.current&&n.touchUpMotion()})},[]),Z=v(re.create({onStartShouldSetPanResponder:()=>!0,onPanResponderGrant:X,onPanResponderMove:P,onPanResponderRelease:U,onPanResponderTerminate:U})).current,J={accessibilityRole:"text","aria-disabled":d,accessibilityHint:"\uBCC0\uACBD\uD560 \uC218 \uC5C6\uC5B4\uC694"},Q={accessibilityRole:"adjustable",accessibilityActions:[{name:"increment",label:"\uBCC4\uC810 \uC62C\uB9AC\uAE30"},{name:"decrement",label:"\uBCC4\uC810 \uB0B4\uB9AC\uAE30"}],onAccessibilityAction:n=>{let e;switch(n.nativeEvent.actionName){case"increment":e=o!==w?o+1:o;break;case"decrement":e=o!==0?o-1:o;break;default:e=o;break}ne.announceForAccessibility?.(`${e}\uC810\uC774 \uC120\uD0DD\uB418\uC5C8\uC2B5\uB2C8\uB2E4`),D?.(e)}};return z(()=>{c&&y.current.forEach((n,e)=>{e<o?(n.activeMotion(),n.touchUpMotion()):n.inactiveMotion()})},[c,o]),s(L,{ref:x,accessible:!0,accessibilityLabel:E,accessibilityValue:{text:typeof g=="function"?g(w,o):g},...d?J:Q,...d||c?{}:Z.panHandlers,style:[pe.rowCenter,{gap:R},k],testID:"rating",...S,children:Array.from({length:w},(n,e)=>s(se,{ref:r=>{r&&(y.current[e]=r)},forwardedRef:x,size:N,onLayout:r=>A(r,e),active:e<o,activeColor:h,idleColor:f,disabledColor:m,disabled:d,name:C},e))})});const F=j.create({relative:{position:"relative"},overlap:{position:"absolute",top:0,left:0}}),H=j.create({1:{zIndex:1},2:{zIndex:2},3:{zIndex:3}}),pe=j.create({rowCenter:{flexDirection:"row",alignItems:"center"}});
