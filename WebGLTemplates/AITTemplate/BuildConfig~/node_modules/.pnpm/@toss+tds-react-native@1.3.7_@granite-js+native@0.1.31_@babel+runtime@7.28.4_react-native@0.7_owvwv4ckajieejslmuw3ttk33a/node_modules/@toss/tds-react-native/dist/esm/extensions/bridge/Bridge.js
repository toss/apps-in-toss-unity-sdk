"use strict";import{jsx as o,jsxs as T}from"react/jsx-runtime";import{bezier as C,spring as R}from"@toss/tds-easings";import{josa as A}from"es-hangul";import{useCallback as G,useEffect as E,useLayoutEffect as Q,useMemo as X,useRef as Z,useState as w}from"react";import{Dimensions as ee,Easing as v,Platform as te,Pressable as oe,StyleSheet as O,useAnimatedValue as r,View as L}from"react-native";import{usePreservedCallback as k}from"../../components/bottom-sheet/utils/usePreservedCallback";import{LinearGradient as re,RadialGradient as B}from"../../components/gradient";import{Text as z}from"../../components/txt";import{useTheme as ie}from"../../core/theme/ThemeProvider";import{Animated as t}from"../../interactions/animated/Animated";import{Icon as ne,NestedShadow as ae}from"./components";import{getCenterOffset as N}from"./utils";const le=600,se=400;export function Bridge({style:a,icon:f,open:c,colorMode:p="basic",onClose:l,onExited:y,variant:x,serviceName:u,amount:s,...m}){const{token:e}=ie(),g=p==="basic",D=k(l??Y),I=k(y??Y),[j,P]=w(!1),b=Z(null),_=G(()=>{b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{D?.(),b.current=null},se)},[D]);E(()=>()=>{b.current&&clearTimeout(b.current)},[]),E(()=>{const d=setTimeout(()=>{P(!0)},le);return()=>{clearTimeout(d)}},[]);const h={large:412.5,small:375},i=ge();E(()=>{if(c)return i.controller.open().start(),()=>{D?.(),i.controller.close().start(()=>{I?.()})}},[i.controller,D,I,c]);const M=x==="point"?[{type:"strong",text:u},{type:"default",text:A.pick(u,"\uC73C\uB85C/\uB85C")+` \uC774\uB3D9\uD558\uACE0
`},{type:"strong",text:`${s.toLocaleString()}\uC6D0`},{type:"default",text:" \uBC1B\uC558\uC5B4\uC694"}]:[{type:"strong",text:u},{type:"default",text:A.pick(u,"\uC73C\uB85C/\uB85C")+" \uC774\uB3D9\uD588\uC5B4\uC694"}],[S,H]=w(null),[V,W]=w(null),[U,$]=w(0),q=G(d=>{H(N(d.nativeEvent.layout))},[]),F=G(d=>{W(N(d.nativeEvent.layout))},[]);return Q(()=>{S===null||V===null||$(S.y-V.y)},[V,S]),T(oe,{style:[n.fullCover,{zIndex:10},a],disabled:!j,onPress:_,...m,children:[o(L,{style:{flex:1,paddingTop:te.select({ios:103,android:56,default:56}),zIndex:1},children:T(t.View,{style:[{flexDirection:"column",gap:16,paddingHorizontal:20,alignItems:"center"}],onLayout:q,children:[o(ae,{shadows:g?[{offset:{x:0,y:4},opacity:.03,radius:6,color:"#000"},{offset:{x:0,y:10},opacity:.18,radius:16,color:e.bridge.contentLogoShadowColor},{offset:{x:0,y:12},opacity:.52,radius:64,color:e.bridge.contentLogoShadowColor}]:[],children:o(ce,{...f,style:[n.iconBorder,i.style.contentLogo]})}),o(ue,{style:[{textAlign:"center"},i.style.contentTitle],children:M.map(({type:d,text:J},K)=>o(z,{typography:"t3",fontWeight:"bold",color:g?d==="strong"?e.bridge.contentTitleStrongColor:e.bridge.contentTitleDefaultColor:d==="strong"?e.bridge.contentTitleStrongInvertedColor:e.bridge.contentTitleDefaultInvertedColor,textAlign:"center",children:J},K))})]})}),o(L,{style:[n.fullCover,{height:de}],children:T(t.View,{style:[n.center,n.fullCover,i.style.backgroundGroup],onLayout:F,children:[o(L,{style:n.fullCover,children:o(re,{opacity:1,degree:180,colors:g?[e.bridge.baseGradientStartColor,e.bridge.baseGradientStartColor,e.bridge.baseGradientMiddleColor,e.bridge.baseGradientEndColor]:[e.bridge.baseGradientStartInvertedColor,e.bridge.baseGradientStartInvertedColor,e.bridge.baseGradientMiddleInvertedColor,e.bridge.baseGradientEndInvertedColor],positions:[0,.25,.31,1],easing:"linear"})}),o(L,{style:{width:h.large+135,height:h.large,position:"relative",transform:[{translateY:U}]},children:g&&T(t.View,{style:[n.fullCover,{opacity:.02},i.style.radialGradientGroup],children:[o(t.View,{style:[n.rightCover,{width:h.small,height:h.small},i.style.rightRadialGradient],children:o(B,{colors:[{value:e.bridge.rightRadialGradientColor,opacity:1},{value:e.bridge.rightRadialGradientColor,opacity:0}]})}),o(t.View,{style:[n.leftCover,{width:h.large,height:h.large},i.style.leftRadialGradient],children:o(B,{colors:[{value:e.bridge.leftRadialGradientColor,opacity:1},{value:e.bridge.leftRadialGradientColor,opacity:0}]})})]})})]})})]})}const n=O.create({fullCover:{position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%"},halfCover:{position:"absolute",top:0,left:0,width:"100%",height:"50%"},leftCover:{position:"absolute",bottom:0,left:0},rightCover:{position:"absolute",bottom:0,right:0},center:{display:"flex",justifyContent:"center",alignItems:"center"},iconBorder:{width:56,height:56,borderWidth:O.hairlineWidth,borderRadius:14,borderColor:"rgba(25, 66, 142, 0.12)",borderStyle:"solid",overflow:"hidden"}}),Y=()=>{},de=ee.get("window").height,ce=t.createAnimatedComponent(ne),ue=t.createAnimatedComponent(z);function ge(){const a=r(0),f=r(.5),c=r(0),p=r(0),l=r(0),y=r(.6),x=r(0),u=r(0),s=r(0),m=r(.7),e=G(()=>t.parallel([t.spring(a,{toValue:1,...R.small,useNativeDriver:!1}),t.timing(f,{toValue:1,easing:v.bezier(...C.out),duration:800,useNativeDriver:!1}),t.spring(c,{toValue:1,...R.basic,useNativeDriver:!1}),t.spring(p,{toValue:1,delay:40,...R.basic,useNativeDriver:!1}),t.timing(l,{toValue:1,easing:v.bezier(...C.out),duration:600,useNativeDriver:!1,delay:40}),t.spring(y,{toValue:1,stiffness:120,friction:11,useNativeDriver:!1,delay:40}),t.timing(s,{toValue:1,easing:v.bezier(...C.out),duration:600,useNativeDriver:!1,delay:80}),t.spring(m,{toValue:1,stiffness:120,friction:11,useNativeDriver:!1,delay:80})]),[a,f,c,p,l,y,s,m]),g=G(()=>t.parallel([t.timing(l,{toValue:0,easing:v.bezier(...C.out),duration:500,useNativeDriver:!1}),t.timing(s,{toValue:0,easing:v.bezier(...C.out),duration:500,useNativeDriver:!1}),t.timing(a,{toValue:0,easing:v.bezier(...C.out),duration:500,useNativeDriver:!1})]),[a,l,s]);return X(()=>({style:{backgroundGroup:{opacity:a},radialGradientGroup:{transform:[{scale:f}]},leftRadialGradient:{opacity:c},rightRadialGradient:{opacity:p},contentLogo:{opacity:l,transform:[{translateY:x},{scale:y}]},contentTitle:{opacity:s,transform:[{translateY:u},{scale:m}]}},controller:{open:e,close:g}}),[a,g,l,y,x,s,m,u,c,e,f,p])}
