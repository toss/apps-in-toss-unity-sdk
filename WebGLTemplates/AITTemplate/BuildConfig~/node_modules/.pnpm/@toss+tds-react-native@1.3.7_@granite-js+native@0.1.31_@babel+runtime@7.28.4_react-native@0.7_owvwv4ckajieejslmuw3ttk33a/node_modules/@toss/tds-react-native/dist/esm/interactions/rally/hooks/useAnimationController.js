"use strict";import{delay as F}from"@toss/utils";import{useCallback as a,useEffect as E,useMemo as b,useRef as P}from"react";import{AppState as I}from"react-native";import{repeat as O,repeatCycle as x}from"../utils";import{useWaitFor as L}from"./utils/useWaitFor";export function useAnimationController({forwardAnimation:e,backwardAnimation:n,playCount:f=1,loopDelay:u=0,loopMode:c="alternate",mounted:y,delay:o=0}){const{waitFor:r}=L(y),t=P(!1),g=P(0),i=f==="infinite"?1/0:f,p=e,h=a(async()=>{if(await r(),t.current===!0)return!1;t.current=!0;try{await F(o);for(const s of x([e,n],i,{gutter:B(u)}))if(s==null||!await s.start())return!1;return!0}finally{t.current=!1}},[e,n,i,o,u,r]),m=a(async()=>{if(await r(),t.current===!0)return!1;t.current=!0;try{await F(o);for(const s of O(e,i,{gutter:B(u)}))if(s==null||(s.seekProgress(0),!await s.start()))return!1;return!0}finally{t.current=!1}},[o,e,i,u,r]),C=a(s=>{t.current=!1,e.seekProgress(s)},[e]),l=b(()=>c==="normal"?m:h,[c,m,h]),d=a(async()=>(await r(),t.current=!1,g.current=0,e.seekProgress(0),await l()),[e,l,r]),v=a(async()=>(await r(),t.current=!1,g.current=0,e.seekProgress(1),await n.start()),[e,n,r]),w=a(()=>{t.current=!1,g.current=0,p.reset()},[p]),k=a(()=>{p.stop(),t.current=!1},[p]);return N({play:l,pause:k,isPlaying:t,condition:i===1/0}),b(()=>({startForward:d,startBackward:v,play:l,seekProgress:C,reset:w,pause:k}),[d,v,l,C,w,k])}function B(e){return{start:async()=>(await F(e),!0),seekProgress:()=>{},stop:()=>{},reset:()=>{}}}function N({play:e,pause:n,condition:f,isPlaying:u}){const c=P(!1);E(()=>{if(!f)return;function y(r){switch(r){case"active":{c.current===!0&&(c.current=!1,e());break}case"background":case"inactive":{u.current===!0&&(c.current=!0,n());break}default:break}}const o=I.addEventListener("change",y);return()=>{o.remove()}},[f,u,n,e])}
