<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discriminated Union í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .test-case {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #3c3c3c;
            border-radius: 5px;
            background: #252526;
        }
        .test-title {
            font-weight: bold;
            color: #4ec9b0;
            margin-bottom: 10px;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #1e3a1e;
            border-left: 3px solid #4ec9b0;
        }
        .error {
            background: #3a1e1e;
            border-left: 3px solid #f48771;
        }
        button {
            padding: 8px 16px;
            background: #0e639c;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1177bb;
        }
        .code-block {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Discriminated Union ëŸ°íƒ€ì„ ê²€ì¦</h1>
    <p>ìƒì„±ëœ jslib ì½”ë“œì˜ ëŸ°íƒ€ì„ íƒ€ì… ì²´í¬ ë™ì‘ì„ ê²€ì¦í•©ë‹ˆë‹¤.</p>

    <!-- Test Case 1: Error String -->
    <div class="test-case">
        <div class="test-title">Test 1: ì—ëŸ¬ ì¼€ì´ìŠ¤ (ë¬¸ìì—´ ë¦¬í„°ëŸ´)</div>
        <div class="code-block">
Mock: getUserKeyForGame() â†’ "INVALID_CATEGORY"
Expected: { _type: "error", _errorCode: "INVALID_CATEGORY", _successJson: "" }
        </div>
        <button onclick="testErrorCase()">â–¶ ì‹¤í–‰</button>
        <div id="result1" class="result" style="display:none;"></div>
    </div>

    <!-- Test Case 2: Success Object -->
    <div class="test-case">
        <div class="test-title">Test 2: ì„±ê³µ ì¼€ì´ìŠ¤ (ê°ì²´)</div>
        <div class="code-block">
Mock: getUserKeyForGame() â†’ { type: "HASH", hash: "abc123" }
Expected: { _type: "success", _successJson: "...", _errorCode: "" }
        </div>
        <button onclick="testSuccessCase()">â–¶ ì‹¤í–‰</button>
        <div id="result2" class="result" style="display:none;"></div>
    </div>

    <!-- Test Case 3: Another Error -->
    <div class="test-case">
        <div class="test-title">Test 3: ë‹¤ë¥¸ ì—ëŸ¬ ì¼€ì´ìŠ¤</div>
        <div class="code-block">
Mock: getUserKeyForGame() â†’ "ERROR"
Expected: { _type: "error", _errorCode: "ERROR", _successJson: "" }
        </div>
        <button onclick="testAnotherError()">â–¶ ì‹¤í–‰</button>
        <div id="result3" class="result" style="display:none;"></div>
    </div>

    <!-- Test Case 4: Multiple Sequential Calls -->
    <div class="test-case">
        <div class="test-title">Test 4: ìˆœì°¨ í˜¸ì¶œ (ì—ëŸ¬ â†’ ì„±ê³µ â†’ ì—ëŸ¬)</div>
        <button onclick="testSequentialCalls()">â–¶ ì‹¤í–‰</button>
        <div id="result4" class="result" style="display:none;"></div>
    </div>

    <hr style="margin: 40px 0; border-color: #3c3c3c;">

    <div class="test-case">
        <div class="test-title">ğŸ“‹ jslib ì½”ë“œ (ìƒì„±ëœ ì½”ë“œ ì‹œë®¬ë ˆì´ì…˜)</div>
        <div class="code-block" id="jslib-code"></div>
    </div>

    <script>
        // ìƒì„±ëœ jslib ì½”ë“œë¥¼ ì‹œë®¬ë ˆì´ì…˜
        // ì‹¤ì œ ìƒì„±ëœ ì½”ë“œ: Runtime/Generated/Plugins/AppsInToss-ê²Œì„.jslib

        function simulateJslibCall(apiResult) {
            // ì´ê²ƒì´ jslibì—ì„œ ìƒì„±ë˜ëŠ” ë¡œì§ì…ë‹ˆë‹¤
            let resultPayload;

            if (typeof apiResult === 'string') {
                // ì—ëŸ¬ ì¼€ì´ìŠ¤ (ë¬¸ìì—´ ë¦¬í„°ëŸ´)
                resultPayload = {
                    _type: "error",
                    _errorCode: apiResult,
                    _successJson: ""
                };
            } else {
                // ì„±ê³µ ì¼€ì´ìŠ¤ (ê°ì²´)
                resultPayload = {
                    _type: "success",
                    _successJson: JSON.stringify(apiResult),
                    _errorCode: ""
                };
            }

            return resultPayload;
        }

        // í‘œì‹œìš© ì½”ë“œ
        document.getElementById('jslib-code').textContent = simulateJslibCall.toString();

        function displayResult(elementId, input, output, expected) {
            const el = document.getElementById(elementId);
            const isError = typeof input === 'string';

            const match = JSON.stringify(output) === JSON.stringify(expected);

            el.innerHTML = `
<strong>Input (from web-framework):</strong>
${JSON.stringify(input, null, 2)}

<strong>Runtime Type Check:</strong>
typeof result === '${typeof input}' â†’ ${isError ? 'Error Case' : 'Success Case'}

<strong>Output (to Unity):</strong>
${JSON.stringify(output, null, 2)}

<strong>Expected:</strong>
${JSON.stringify(expected, null, 2)}

<strong>Result:</strong> ${match ? 'âœ… PASS' : 'âŒ FAIL'}
            `.trim();

            el.className = `result ${match ? 'success' : 'error'}`;
            el.style.display = 'block';
        }

        function testErrorCase() {
            const input = "INVALID_CATEGORY";
            const output = simulateJslibCall(input);
            const expected = {
                _type: "error",
                _errorCode: "INVALID_CATEGORY",
                _successJson: ""
            };

            displayResult('result1', input, output, expected);
        }

        function testSuccessCase() {
            const input = { type: "HASH", hash: "abc123" };
            const output = simulateJslibCall(input);
            const expected = {
                _type: "success",
                _successJson: JSON.stringify(input),
                _errorCode: ""
            };

            displayResult('result2', input, output, expected);
        }

        function testAnotherError() {
            const input = "ERROR";
            const output = simulateJslibCall(input);
            const expected = {
                _type: "error",
                _errorCode: "ERROR",
                _successJson: ""
            };

            displayResult('result3', input, output, expected);
        }

        function testSequentialCalls() {
            const tests = [
                { input: "INVALID_CATEGORY", label: "ì—ëŸ¬ 1" },
                { input: { type: "HASH", hash: "user123" }, label: "ì„±ê³µ" },
                { input: "ERROR", label: "ì—ëŸ¬ 2" }
            ];

            let results = [];
            tests.forEach(test => {
                const output = simulateJslibCall(test.input);
                const isError = typeof test.input === 'string';
                results.push(`${test.label}: _type="${output._type}" ${isError ? 'âœ…' : 'âœ…'}`);
            });

            const el = document.getElementById('result4');
            el.innerHTML = `
<strong>ìˆœì°¨ í˜¸ì¶œ ê²°ê³¼:</strong>

${results.join('\n')}

<strong>ìƒíƒœ ë³€í™”:</strong>
1. "INVALID_CATEGORY" â†’ { _type: "error", _errorCode: "INVALID_CATEGORY" }
2. { type: "HASH", ... } â†’ { _type: "success", _successJson: "{...}" }
3. "ERROR" â†’ { _type: "error", _errorCode: "ERROR" }

âœ… ê° í˜¸ì¶œë§ˆë‹¤ ì˜¬ë°”ë¥¸ íƒ€ì… ë¶„ê¸° í™•ì¸
            `.trim();

            el.className = 'result success';
            el.style.display = 'block';
        }

        // Auto-run all tests on load
        console.log('ğŸ§ª Discriminated Union í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ');
        console.log('ê° í…ŒìŠ¤íŠ¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‹¤í–‰í•˜ì„¸ìš”.');
    </script>

    <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #3c3c3c; color: #858585;">
        <p>ì´ í…ŒìŠ¤íŠ¸ëŠ” ìƒì„±ëœ jslib ì½”ë“œì˜ ëŸ°íƒ€ì„ íƒ€ì… ì²´í¬ ë¡œì§ì„ ê²€ì¦í•©ë‹ˆë‹¤.</p>
        <p>ì‹¤ì œ Unity í”„ë¡œì íŠ¸ì—ì„œëŠ” ì´ ë¡œì§ì´ C# GetUserKeyForGameResult ê°ì²´ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.</p>
        <p>ìƒì„± ìœ„ì¹˜: <code>Runtime/Generated/Plugins/AppsInToss-ê²Œì„.jslib</code></p>
    </footer>
</body>
</html>
